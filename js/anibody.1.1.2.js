function Anibody(html_id){Anibody.ECMAScriptExtension();this.Info={Engine:"AniBody",Project:"Dev",Version:"1.1.2",Author:"Daniel Meurer",LastUpdated:"2017_11_30_h21"};this.CurrentFrame=0;if($&&$.fn){if(!$.AnibodyArray)$.AnibodyArray=[];this.EI=$.AnibodyArray.length;$.AnibodyArray.push(this);$.Anibody=this}else{this.Info.Error="jQuery is probably not set up";return false}this.Flags={};this.Flags.ConstantLoop=true;this.Flags.PreventKeyboardStrokesToBubbleUp=true;this.Flags.PreventContextClickBubbleToUp=
true;this.Flags.MediaManager=true;this.Flags.MouseInput=true;this.Flags.KeyboardInput=true;this.Flags.TouchHandler=true;this.Flags.Touch2FakeMouseClick=true;this.Flags.DebugWindow=false;this.Flags.Storage=true;this.Flags.IntervalHandler=true;this.Paused=false;this.Objects={Queue:null,SelectedObject:null};this.CanvasID=html_id;this.Canvas={};this.Canvas.ScreenRatio=0;this.IsTouchDevice=false;this.IsCanvasFitToScreen=false;this.Context=null;this.Input=null;this.Camera={SelectedCamera:null,Cameras:[]};
this.IntervalHandler=null;this.Log=[];this.ProcessInputFunctionObjects=null;this.UpdateFunctionObjects=null;this.ForegroundDrawFunctionObjects=null;this.FPS=25;this.Timer=null;this.MediaManager=null;this.Terrain=null;this.DebugWindow=null;this.Consolero=null;this.OverlayImages=[];this.OutsideElement=[];this.TopWindow=window;if(window.top!==window.self)try{this.TopWindow=window.parent}catch(e){console.log("top window can't be found;")}this.Initialize()}Anibody.prototype.GetEngine=function(){return this};
Object.defineProperty(Anibody.prototype,"Engine",{get:function(){return $.AnibodyArray[this.EI]}});
Anibody.prototype.Initialize=function(){if(this.Flags.MediaManager){this.MediaManager=new Anibody.util.MediaManager;this.MediaManager.EI=this.EI}var pseudo=$("#"+this.CanvasID)[0];var width=$("#"+this.CanvasID).width();var height=$("#"+this.CanvasID).height();if(pseudo.nodeName=="DIV"){$("#"+this.CanvasID).html("<canvas width='"+width+"' height='"+height+"' id='"+this.CanvasID+"_Canvas'></canvas>");this.CanvasID=this.CanvasID+"_Canvas"}this.Canvas=$("#"+this.CanvasID)[0];this.Canvas.PosNew={x:0,y:0};
this.Canvas.PosOld={x:0,y:0};this.Canvas.ScreenRatio=parseInt(this.Canvas.width/this.Canvas.height*1E3)/1E3;this.Context=this.Canvas.getContext("2d");this.Input=new Anibody.input.Input;this.Objects.Queue=new Anibody.util.PriorityQueue;this.ProcessInputFunctionObjects=new Anibody.util.PriorityQueue;this.UpdateFunctionObjects=new Anibody.util.PriorityQueue;this.ForegroundDrawFunctionObjects=new Anibody.util.PriorityQueue;if(this.Flags.IntervalHandler){this.IntervalHandler=new Anibody.util.IntervalHandler;
this.AddUpdateFunctionObject({"function":this.IntervalHandler.Update,that:this.IntervalHandler})}if(this.Flags.ConstantLoop)this.Timer=new Anibody.util.Timer(this,this.Frame,this.FPS);if(this.Flags.Storage)this.Storage=new Anibody.util.Storage;if(this.Flags.DebugWindow)this.DebugWindow=new DebugWindow;this.Consolero=new Anibody.debug.Consolero};
Anibody.prototype.Start=function(){if(!this.Terrain)this.SetTerrain(new Anibody.DefaultTerrain);if(!this.Camera.SelectedCamera){this.Camera.SelectedCamera=new Anibody.DefaultCamera;this.Camera.Cameras.push(this.Camera.SelectedCamera)}this.Objects.Queue.Sort();if(this.Flags.ConstantLoop)this.Timer.Start()};Anibody.prototype.Stop=function(){this.Timer.Stop()};Anibody.prototype.Continue=function(){this.Paused=false};Anibody.prototype.Pause=function(){this.Paused=true};
Anibody.prototype.Frame=function(){this.CurrentFrame++;var e=arguments[0];e.ProcessInput();if(!e.Paused)e.Update();e.Draw()};Anibody.prototype.AddProcessInputFunctionObject=function(pio,prio){var ref=this.ProcessInputFunctionObjects.Enqueue(pio,prio);this.ProcessInputFunctionObjects.Sort();return ref};Anibody.prototype.RemoveProcessInputFunctionObject=function(ref){this.ProcessInputFunctionObjects.DeleteByReferenceNumber(ref)};
Anibody.prototype.ProcessInput=function(){this.Input.Mouse.Cursor["default"]();this.Input.Update();for(var i=0;i<this.Objects.Queue.heap.length;i++){o=this.GetObject(i);if(o&&o.ProcessInput)o.ProcessInput()}var pif;for(var i=0;i<this.ProcessInputFunctionObjects.heap.length;i++){pif=this.ProcessInputFunctionObjects.heap[i].data;pif["function"].call(pif.that,pif.parameter)}if(this.Input.MouseHandler&&this.Input.MouseHandler.ResolveHoverRequest)this.Input.MouseHandler.ResolveHoverRequest();if(this.Input.MouseHandler&&
this.Input.MouseHandler.MouseClickHandler)this.Input.MouseHandler.MouseClickHandler()};Anibody.prototype.AddUpdateFunctionObject=function(ufo,prior){return this.UpdateFunctionObjects.Enqueue(ufo,prior)};Anibody.prototype.RemoveUpdateFunctionObject=function(ref){this.UpdateFunctionObjects.DeleteByReferenceNumber(ref)};
Anibody.prototype.Update=function(){this.Input.CalculateCanvasPosition();if(!this.Objects.Queue.Sorted)this.Objects.Queue.Sort();if(this.Terrain&&this.Terrain.Update)this.Terrain.Update();var o;for(var i=0;i<this.UpdateFunctionObjects.heap.length;i++){o=this.UpdateFunctionObjects.heap[i].data;o["function"].call(o.that,o.parameter)}for(var i=0;i<this.Objects.Queue.heap.length;i++){o=this.GetObject(i);if(o&&o.Update)o.Update()}if(this.Flags.MediaManager)this.MediaManager.Update();if(this.DebugWindow)this.DebugWindow.Update();
if(this.Flags.AntiHoverEffect)if(this.Input.Canvas.MouseOn)this.AHEStart();else if(typeof this.AHE.Canvas!=="undefined"&&this.AHE.Canvas)this.AHEStop();this.Camera.SelectedCamera.Update()};
Anibody.prototype.Draw=function(){var c=this.Context;c.save();c.clearRect(0,0,this.Canvas.width,this.Canvas.height);var o;this.Terrain.Draw(c);for(var i=0;i<this.Objects.Queue.heap.length;i++){o=this.GetObject(i);if(o&&o.Draw)o.Draw(c)}if(this.Flags.MediaManager)this.MediaManager.Draw(c);if(this.DebugWindow)this.DebugWindow.Draw();for(var i=0;i<this.ForegroundDrawFunctionObjects.heap.length;i++){o=this.ForegroundDrawFunctionObjects.heap[i].data;o["function"].call(o.that,c,o.parameter)}if(this.OverlayImages.length>
0){var arr=[];var tmp;for(var i=0;i<this.OverlayImages.length;i++){tmp=this.OverlayImages[i];c.drawImage(tmp.image,tmp.pos.x,tmp.pos.y,tmp.pos.width,tmp.pos.height);tmp.frames--;if(tmp.frames>0)arr.push(tmp)}this.OverlayImages=arr}c.restore()};Anibody.prototype.AddForegroundDrawFunctionObject=function(fdfo,prior){return this.ForegroundDrawFunctionObjects.Enqueue(fdfo,prior)};Anibody.prototype.RemoveForegroundDrawFunctionObject=function(ref){this.ForegroundDrawFunctionObjects.DeleteByReferenceNumber(ref)};
Anibody.prototype.Download=function(name,data){if(typeof data==="undefined")data=this.Canvas.toDataURL();var fileName=name||"download_"+Date.now()+".png";var saveData=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";return function(data,fileName){var url=data;a.href=url;a.download=fileName;a.click();window.URL.revokeObjectURL(url)}}();saveData(data,fileName)};
Anibody.prototype.RequestFullscreen=function(){var can=this.Canvas;var done=false;if(!done&&can.requestFullscreen){can.requestFullscreen();done=true}if(!done&&can.webkitRequestFullscreen){can.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);done=true}if(!done&&can.mozRequestFullScreen){can.mozRequestFullScreen();done=true}if(!done&&can.msRequestFullscreen){can.msRequestFullscreen();done=true}return done};
Anibody.prototype.ExitFullscreen=function(){var done=false;if(!done&&document.exitFullscreen){document.exitFullscreen();done=true}if(!done&&document.webkitExitFullscreen){document.webkitExitFullscreen();done=true}if(!done&&document.mozCancelFullScreen){document.mozCancelFullScreen();done=true}if(!done&&document.msExitFullscreen){document.msExitFullscreen();done=true}};Anibody.prototype.GetObject=function(i){if(i<this.Objects.Queue.heap.length)return this.Objects.Queue.heap[i].data;else return false};
Anibody.prototype.AddObject=function(obj,pr){obj.EI=this.EI;return this.Objects.Queue.Enqueue(obj,pr)};Anibody.prototype.RemoveObject=function(ref){return this.Objects.Queue.DeleteByReferenceNumber(ref)};Anibody.prototype.SetSelectedObject=function(ob){this.Objects.SelectedObject=ob};Anibody.prototype.GetSelectedObject=function(){return this.Objects.SelectedObject};
Anibody.prototype.AddOutsideElement=function(id,codename){var el={element:$("#"+id),id:id,codename:codename};if(el.element.length>0){this.OutsideElement.push(el);return el}return false};Anibody.prototype.GetOutsideElement=function(codename){for(var i=0;i<this.OutsideElement.length;i++)if(this.OutsideElement[i].codename===codename)return this.OutsideElement[i].element;return false};Anibody.prototype.FlushQueue=function(){this.Objects.Queue.Flush();this.SelectedObject="undefined"};
Anibody.prototype.SetTerrain=function(t){t.EI=this.EI;this.Terrain=t};Anibody.prototype.FlushScene=function(){this.Objects.Queue.Flush();this.MediaManager.Flush()};Anibody.prototype.HandleError=function(err){this.Log.push(err)};Anibody.prototype.GetCamera=function(){return this.Camera.SelectedCamera};Anibody.prototype.SetCamera=function(cam){this.Camera.SelectedCamera=cam};
Anibody.prototype.ActivateFullScreen_yetTODO=function(){var elem=this.Canvas;var w=$(window).width();var h=$(window).height();elem.width=w;elem.height=h;this.Canvas.ScreenRatio=w/h;this.IsCanvasFitToScreen=true};Anibody.prototype.AddOverlayImage=function(img,x,y,w,h,nof){nof=nof||1;w=w||img.width;h=h||img.height;this.OverlayImages.push({image:img,pos:{x:x,y:y,width:w,height:h},frames:nof})};
Anibody.prototype.LockUnload=function(f){var onbeforeunload=function(e){return false};if(typeof f==="function")onbeforeunload=f;$(window).bind("beforeunload",onbeforeunload);if(window.top!=window.self)try{$(window.parent.document).bind("beforeunload",onbeforeunload)}catch(e){}};Anibody.prototype.UnlockUnload=function(){$(window).unbind("beforeunload");if(window.top!=window.self)try{$(window.parent.document).unbind("beforeunload")}catch(e){}};
Anibody.prototype.Print=function(url){if(typeof url==="undefined")url=this.Canvas.toDataURL();var html="<iframe style='display:none' name='testing__AniBody.Print' id='testing__AniBody__Print'><!DOCTYPE HTML><html><body></body></html></iframe>";$("body").append(html);var newWin=window.frames["testing__AniBody__Print"];var doc=newWin.contentDocument;doc.write("<body><img src='{0}' onload='window.print()'</body>".format(url));window.setTimeout(function(){var ifr=$("#testing__AniBody__Print");ifr.remove()},
1E3)};Anibody.SetPackage=function(){var i=0;var pp="";for(i=0;i<arguments.length;i++)if(typeof arguments[i]!=="string"){this.log("Cannot create package","ArgumentException");return}var el=window;var newel;for(i=0;i<arguments.length;i++){newel=el[arguments[i]];if(typeof newel==="undefined")el[arguments[i]]={};el=el[arguments[i]]}};
Anibody.CallObject=function(obj,useApply){if(typeof obj!=="object"||obj===null)return;useApply=obj.useApply;if(typeof useApply==="undefined")useApply=false;if(typeof obj==="object"&&typeof obj["function"]==="function")if(useApply)obj["function"].apply(obj.that,obj.parameter);else obj["function"].call(obj.that,obj.parameter)};
Anibody["import"]=function(packagePath,alias){if(arguments.length<=0)return;if(typeof alias!=="string")if(packagePath&&packagePath.name)alias=packagePath.name;else{alias=packagePath.constructor.toString();var ifunc=alias.indexOf("function ");var ibracket=alias.indexOf("(");if(ifunc===0)alias=alias.substr(9,ibracket-9)}if(alias.length<=0){console.log("Cannot import "+packagePath.toString(),"EmptyStringException");return}if(alias==="Function"){console.log("Cannot import "+alias,"AnonymousFunctionException");
return}if(typeof window[alias]!=="undefined")return;window[alias]=packagePath};Anibody.importAll=function(packagePath){if(arguments.length<=0)return;for(var name in packagePath)Anibody["import"](packagePath[name])};Anibody.EngineObject=function EngineObject(){this.EI=0;this.UniqueID=this._getUniqueID()};Anibody.EngineObject.prototype.ProcessInput=function(){return false};Anibody.EngineObject.prototype.Update=function(){return false};Anibody.EngineObject.prototype.UniqueIDState=0;
Anibody.EngineObject.prototype._getUniqueID=function(){return Anibody.EngineObject.prototype.UniqueIDState++};Object.defineProperty(Anibody.EngineObject.prototype,"Engine",{get:function(){return $.AnibodyArray[this.EI]}});Anibody.ABO=function ABO(){Anibody.EngineObject.call(this);this.Name="";this.X=0;this.Y=0;this.Width=0;this.Height=0};Anibody.ABO.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.ABO.prototype.constructor=Anibody.ABO;Anibody.ABO.prototype.Draw=function(){return false};
Anibody.ABO.prototype.GetArea=function(off,rounding){if(typeof off==="undefined")off=0;if(typeof rounding==="undefined"||rounding<0)rounding=0;var area;if(rounding!=="circle")if(rounding===0)area={x:this.X-off,y:this.Y-off,width:this.Width+2*off,height:this.Height+2*off,type:"rect"};else area={x:this.X-off,y:this.Y-off,width:this.Width+2*off,height:this.Height+2*off,rounding:rounding,type:"rrect"};else area={x:this.X,y:this.Y,radius:this.Radius+off,type:"circle"};area.background=false;return area};
Anibody.ABO.prototype.Delete=function(){};Anibody.Widget=function Widget(){Anibody.ABO.call(this);this._refIP=null;this._ipPriority=1;this._refU=null;this._uPriority=1;this._refD=null;this._dPriority=1};Anibody.Widget.prototype=Object.create(Anibody.ABO.prototype);Anibody.Widget.prototype.constructor=Anibody.Widget;
Anibody.Widget.prototype.Register=function(){if(this._refIP===null)this._refIP=this.Engine.AddProcessInputFunctionObject({"function":function(){this.ProcessInput()},that:this},this._ipPriority);if(this._refU===null)this._refU=this.Engine.AddUpdateFunctionObject({"function":function(){this.Update()},that:this},this._uPriority);if(this._refD===null)this._refD=this.Engine.AddForegroundDrawFunctionObject({"function":function(c){this.Draw(c)},that:this},this._dPriority)};
Anibody.Widget.prototype.Deregister=function(){if(this._refIP!==null){this.Engine.RemoveProcessInputFunctionObject(this._refIP);this._refIP=null}if(this._refU!==null){this.Engine.RemoveUpdateFunctionObject(this._refU);this._refU=null}if(this._refD!==null){this.Engine.RemoveForegroundDrawFunctionObject(this._refD);this._refD=null}};Anibody.Widget.prototype.ProcessInput=function(){return false};Anibody.Widget.prototype.Update=function(){return false};Anibody.Widget.prototype.Draw=function(c){return false};
Anibody.DefaultCamera=function DefaultCamera(){Anibody.ABO.call(this)};Anibody.DefaultCamera.prototype=Object.create(Anibody.ABO.prototype);Anibody.DefaultCamera.prototype.constructor=Anibody.DefaultCamera;Anibody.DefaultTerrain=function DefaultTerrain(img_code){Anibody.ABO.call(this);this.Codename=img_code;this.NoImage=false;this.Initialize()};Anibody.DefaultTerrain.prototype=Object.create(Anibody.ABO.prototype);Anibody.DefaultTerrain.prototype.constructor=Anibody.DefaultTerrain;
Anibody.DefaultTerrain.prototype.Initialize=function(){if(this.Codename){this.Image=this.Engine.MediaManager.GetImage(this.Codename);this.Width=this.Image.width;this.Height=this.Image.height}else{this.NoImage=true;this.Width=this.Engine.Canvas.width;this.Height=this.Engine.Canvas.height}};Anibody.DefaultTerrain.prototype.Draw=function(c){if(!this.NoImage){var cam=this.Engine.Camera.SelectedCamera;c.drawImage(this.Image,this.X-cam.X,this.Y-cam.Y)}};Anibody.SetPackage("Anibody","debug");
Anibody.debug.ObjectDumb=function ObjectDumb(obj,name){this.Object=obj;this._already=[];this._maxDepth=5;if(typeof name==="undefined")name="root";this._name=name;this.Image=null;this._root={};this.Width=0;this.Height=0;this._tabulator=40;this._fh=30;this._margin=2;this._dataURL=0;this.Initialize()};
Anibody.debug.ObjectDumb.prototype.Initialize=function(){this._root={type:this._getType(this.Object),name:this._name,element:this.Object,children:[],depth:0};this._analyze(this._root,this._root.depth);this._createImage()};
Anibody.debug.ObjectDumb.prototype._analyze=function(){var rec=function(obj,depth){var el=obj.element;var type;if(depth>this._maxDepth)obj.children.push({name:"max depth reached",element:null});for(var attr in el)if(this._already.indexOf(el[attr])<0){this._already.push(el[attr]);type=this._getType(el[attr]);var child={type:type,element:el[attr],name:attr,children:[],depth:depth+1};obj.children.push(child);if(["number","boolean","string","null"].indexOf(type)<0)rec.call(this,child,depth+1)}else type=
"already"};rec.call(this,this._root,0)};Anibody.debug.ObjectDumb.prototype._getType=function(el){if(el===null)return"null";var type=typeof el;if(type!=="object")return type;if(el.push)return"array";var con=el.constructor.toString();var ifunc=con.indexOf("function ");var ibracket=con.indexOf("(");if(ifunc===0)con=con.substr(9,ibracket-9);return con};
Anibody.debug.ObjectDumb.prototype._createImage=function(el){var off=document.createElement("CANVAS");off.width=10;off.height=10;var c=off.getContext("2d");c.setFontHeight(this._fh);c.textAlign="left";c.textBaseline="top";var rowheight=this._fh+this._margin;var allheight=this._margin*2;var allwidth=this._margin*2;var i;var drawOrder=[];var colWidth=[];var tab=this._tabulator;var rec=function(el){drawOrder.push(el);if(typeof colWidth[el.depth]==="undefined")colWidth[el.depth]=[];colWidth[el.depth].push(c.measureText(el.name+
" ("+el.type+")").width+tab);for(var i=0;i<el.children.length;i++)rec(el.children[i])};rec(this._root);for(var i=0;i<colWidth.length;i++){colWidth[i]=Math.max.apply({},colWidth[i]);allwidth+=colWidth[i]}allheight+=drawOrder.length*rowheight;console.log("width: "+allwidth+"\nheight: "+allheight);var off=document.createElement("CANVAS");off.width=allwidth;off.height=allheight;var c=off.getContext("2d");c.setFontHeight(this._fh);c.textAlign="left";c.textBaseline="top";var getWidthForDepth=function(j){var w=
0;for(var i=0;i<j&&i<colWidth.length;i++)w+=colWidth[i];return w};var x=this._margin;var y=this._margin;var w;var txt;var el;for(var i=0;i<drawOrder.length;i++){el=drawOrder[i];w=getWidthForDepth(el.depth);txt=el.name+" ("+el.type+")";c.fillText(txt,x+w,y);y+=rowheight}this._dataURL=off.toDataURL()};Anibody.debug.ObjectDumb.prototype.Download=function(){Anibody.prototype.Download("dump_"+this._name+".png",this._dataURL)};
Anibody.debug.Consolero=function Consolero(){if(Anibody.debug.Consolero.Instance!==null)return Anibody.debug.Consolero.Instance;Anibody.debug.Consolero.Instance=this;this._savelogf=console.log;this._intref=null;this.MonitorArr=[];this._cancel=function(){console.log=function(){return false}};this._activate=function(){console.log=this._savelogf};this.Start=function(){if(this.MonitorArr.length<=0){console.log("Consolero is empty");return}var f=function(that){that._activate();console.clear();var m;for(var i=
0;i<that.MonitorArr.length;i++){m=that.MonitorArr[i];console.log(m.label+" : "+m.object[m.attr])}that._cancel()};this._intref=window.setInterval(f,250,this)};this.Stop=function(){window.clearTimeout(this._intref);this._activate()};this.AddAttribute=function(obj,attr,label){if(typeof label!=="string")label=attr;this.MonitorArr.push({object:obj,attr:attr,label:label})}};Anibody.debug.Consolero.Instance=null;
Anibody.debug.DebugWindow=function DebugWindow(){this.FontHeight=14;this.Timestamp=Date.now();this.Window=null;this.Document;this.Variables=[];this.FormatStrings=[];this.Hide=false;this.MaxDepth=2;this.Initialize()};Anibody.debug.DebugWindow.prototype.Initialize=function(){};
Anibody.debug.DebugWindow.prototype.Draw=function(){if(!this.Window)return;$(this.Body).html("");var str="<p>last refresh: "+Date.now()+"</p>";var v;for(var i=0;i<this.Variables.length;i++){v=this.Variables[i];str+=this._getHTML(v.object,v.keys,i,v.name)}$(this.Body).html(str)};Anibody.debug.DebugWindow.prototype.Add=function(obj,attr,name){if(!attr){attr=[];for(var key in obj)attr.push(key)}this.Variables.push({object:obj,keys:attr,name:name})};
Anibody.debug.DebugWindow.prototype.RecursiveAdd=function(obj,name,depth){this.Add(obj,false,name);if(depth<=0)return true;for(var key in obj)if(typeof obj[key]=="object")this.RecursiveAdd(obj[key],name+"."+key,--depth)};Anibody.debug.DebugWindow.prototype.Open=function(){if(this.IsOpen)return false;this.Window=window.open("","Debug Winow","width=460,height=650");this.Document=this.Window.document;this.Body=this.Document.body;this.IsOpen=true;this._setCSS()};
Anibody.debug.DebugWindow.prototype.Update=function(){if(!this.Window)return false;this.IsOpen=!this.Window.closed};
Anibody.debug.DebugWindow.prototype._getHTML=function(obj,keys,nr,name){var str="<div class='objects' id='Object_"+nr+"'><p>"+name+"</p>\n                <table width=440>\n                    <tr>\n                        <th>Attr</th><th>Wert</th><th>Class</th>\n                    </tr>";for(var i=0;i<keys.length;i++)str+="<tr>\n                    <td>"+keys[i]+"</td><td>"+this._what(obj,keys[i])+"</td><td>"+this._getClass(obj,keys[i])+"</td>\n                </tr>";return str+"</table></div>"};
Anibody.debug.DebugWindow.prototype._setCSS=function(){var head=this.Document.head;var rule_body="body { font-size : 16px }";var rule_objects=" .objects {margin: 5px; width:440px;} ";var rule_p=" p {width:100%; text-align: center; font-size : 20px}";var rule_table=" table { border-collapse: collapse;  } table, th, td {border: 1px solid black;} ";var css="<style> "+rule_body+" "+rule_objects+" "+rule_p+" "+rule_table+" </style>";$(head).append(css)};
Anibody.debug.DebugWindow.prototype._what=function(obj,key){var handeled=false;var str="";if(key=="Engine"&&!handeled){str+="reference to Engine";handeled=true}if(typeof obj[key]=="function"&&!handeled){str+="function( )";handeled=true}if(typeof obj[key]=="object"&&!handeled){str+="object";handeled=true}if(typeof obj[key]!="object"&&!handeled){str+=""+obj[key];handeled=true}return str};
Anibody.debug.DebugWindow.prototype._getClass=function(obj,key){var object=obj[key];if(typeof object==="undefined")return"undefined";if(object===null)return"null";var con=object.constructor.toString();var ifunc=con.indexOf("function ");var ibracket=con.indexOf("(");if(ifunc==0){con=con.substr(9,ibracket-9);return"CLASS::"+con}};
Anibody.debug.Monitor=function Monitor(obj,attr,cbo,name){Anibody.EngineObject.call(this);if(typeof name!=="undefined"&&name!==false&&name!==null)this.Name=name;else this.Name="Monitor "+ ++Monitor.Counter;this.Object=obj;this.Attribute=attr;this.Class="";if(typeof cbo!=="undefined"&&cbo!==false&&cbo!==null)this.CallbackObject=cbo;else this.CallbackObject={that:this,"function":function(newv,oldv,startv,para){console.log("'{0}' changed from '{1}' to '{2}' and began with '{3}'".format(this.Name,oldv,
newv,startv))},parameter:"default"};this.StartValue;this.OldValue;this.CurrentValue;this.Initialize()};Anibody.debug.Monitor.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.debug.Monitor.prototype.constructor=Anibody.debug.Monitor;Anibody.debug.Monitor.Counter=0;Anibody.debug.Monitor.prototype.Initialize=function(){this.StartValue=this.Object[this.Attribute];this.OldValue=this.StartValue;this.CurrentValue=this.StartValue;this._getClass()};
Anibody.debug.Monitor.prototype.Update=function(){this.CurrentValue=this.Object[this.Attribute];if(this._didAttrChange()){var cbo=this.CallbackObject;cbo["function"].call(cbo.that,this.CurrentValue,this.OldValue,this.StartValue,cbo.para)}this.OldValue=this.CurrentValue};Anibody.debug.Monitor.prototype._getClass=function(){var con=this.Object.constructor.toString();var ifunc=con.indexOf("function ");var ibracket=con.indexOf("(");if(ifunc==0)con=con.substr(9,ibracket-9);this.Class=con};
Anibody.debug.Monitor.prototype._didAttrChange=function(){if(this.CurrentValue!==this.OldValue)return true;else return false};Anibody.ECMAScriptExtended=false;
Anibody.ECMAScriptExtension=function(){if(Anibody.ECMAScriptExtended)return false;String.prototype.format=function(){var str=this;var regEx;for(var i=0;i<arguments.length;i++){regEx=new RegExp("\\{"+i+"\\}","gm");str=str.replace(regEx,arguments[i])}return str};String.prototype.decodeURI=function(){var str=this;var regEx=new RegExp("\\{"+"ae"+"\\}","gm");str=str.replace(regEx,"%C3%A4");regEx=new RegExp("\\{"+"oe"+"\\}","gm");str=str.replace(regEx,"%C3%B6");regEx=new RegExp("\\{"+"ue"+"\\}","gm");str=
str.replace(regEx,"%C3%BC");regEx=new RegExp("\\{"+"Ae"+"\\}","gm");str=str.replace(regEx,"%C3%84");regEx=new RegExp("\\{"+"Oe"+"\\}","gm");str=str.replace(regEx,"%C3%96");regEx=new RegExp("\\{"+"Ue"+"\\}","gm");str=str.replace(regEx,"%C3%9C");regEx=new RegExp("\\{"+"ss"+"\\}","gm");str=str.replace(regEx,"%C3%9F");regEx=new RegExp("\\{"+"grad"+"\\}","gm");str=str.replace(regEx,"%C2%B0");return decodeURI(str)};String.UTF8={Greek:{alpha:decodeURI("%CE%B1"),beta:decodeURI("%CE%B2"),gamma:decodeURI("%CE%B3"),
delta:decodeURI("%CE%B4"),epsilon:decodeURI("%CE%B5"),theta:decodeURI("%CE%B8"),lamda:decodeURI("%CE%BB"),mu:decodeURI("%CE%BC"),pi:decodeURI("%CF%80"),rho:decodeURI("%CF%81"),sigma:decodeURI("%CF%83"),phi:decodeURI("%CF%86"),chi:decodeURI("%CF%87"),psi:decodeURI("%CF%88"),omega:decodeURI("%CF%89"),Gamma:decodeURI("%CE%93"),Delta:decodeURI("%CE%94"),Epsilon:decodeURI("%CE%95"),Theta:decodeURI("%CE%98"),Lamda:decodeURI("%CE%9B"),Pi:decodeURI("%CE%A0"),Sigma:decodeURI("%CE%A3"),Phi:decodeURI("%CE%A6"),
Psi:decodeURI("%CE%A8"),Omega:decodeURI("%CE%A9")},German:{ae:decodeURI("%C3%A4"),oe:decodeURI("%C3%B6"),ue:decodeURI("%C3%BC"),Ae:decodeURI("%C3%84"),Oe:decodeURI("%C3%96"),Ue:decodeURI("%C3%9C"),ss:decodeURI("%C3%9F")},Math:{Division:decodeURI("%C3%B7"),PlusMinus:decodeURI("%C2%B1"),Degree:decodeURI("%C2%B0"),Not:decodeURI("%C2%AC")},Subscript:{Zero:decodeURI("%E2%82%80"),One:decodeURI("%E2%82%81"),Two:decodeURI("%E2%82%82"),Three:decodeURI("%E2%82%83"),Four:decodeURI("%E2%82%84"),Five:decodeURI("%E2%82%85"),
Six:decodeURI("%E2%82%86"),Seven:decodeURI("%E2%82%87"),Eight:decodeURI("%E2%82%88"),Nine:decodeURI("%E2%82%89")},List:{CheckedBallot:decodeURI("%E2%98%91"),UncheckedBallot:decodeURI("%E2%98%90"),CancellationX:decodeURI("%F0%9F%97%99")},Random:{Unicorn:decodeURI("%F0%9F%A6%84")}};String._downloadUTF8Table=function(){var noa=0;var ah=18;var apad=4;var noe=0;var eh=16;var epad=2;var attr,entry;for(attr in String.UTF8){noa++;for(entry in String.UTF8[attr])noe++}var height=noe*eh+noe*epad+noa*ah+noa*
apad+20;var can=document.createElement("CANVAS");can.width=300;can.height=height;var c=can.getContext("2d");var x=5;var y=0;var attrFont="16px sans-serif";var entryFont="14px sans-serif";c.textBaseline="top";c.fillStyle="white";c.fillRect(0,0,c.canvas.width,c.canvas.height);c.fillStyle="black";c.font="18px bold sans-serif";c.fillText("(object) String.UTF8",x,y);y+=24;for(attr in String.UTF8){c.font=attrFont;c.fillText(attr,x,y);y+=ah;c.font=entryFont;for(entry in String.UTF8[attr]){c.fillText(entry+
" : "+String.UTF8[attr][entry],x+20,y);y+=eh+epad}y+=apad}var data=can.toDataURL();var fileName="String_UTF8.png";var saveImg=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";return function(data,fileName){var url=data;a.href=url;a.download=fileName;a.click();window.URL.revokeObjectURL(url)}}();saveImg(data,fileName)};String.prototype.decodeHTML=function(){var str=this;var regEx=new RegExp("\\{"+"ae"+"\\}","gm");str=str.replace(regEx,"&auml;");regEx=
new RegExp("\\{"+"oe"+"\\}","gm");str=str.replace(regEx,"&ouml;");regEx=new RegExp("\\{"+"ue"+"\\}","gm");str=str.replace(regEx,"&uuml;");regEx=new RegExp("\\{"+"Ae"+"\\}","gm");str=str.replace(regEx,"&Auml;");regEx=new RegExp("\\{"+"Oe"+"\\}","gm");str=str.replace(regEx,"&Ouml;");regEx=new RegExp("\\{"+"Ue"+"\\}","gm");str=str.replace(regEx,"&Uuml;");regEx=new RegExp("\\{"+"ss"+"\\}","gm");str=str.replace(regEx,"&szlig;");return str};String.prototype.getKeyByEvent=String.getKeyByEvent=function(e){var code=
e.charCode||e.keyCode;if(16<=code&&code<=18)return;var str="";var alt=e.altKey;var control=e.ctrlKey;var shift=e.shiftKey;var other=true;var lowercase=true;var number=false;var letter=false;if(48<=code&&code<=57){number=true;letter=false;other=false}if(65<=code&&code<=90){number=false;letter=true;other=false}if(97<=code&&code<=122){number=false;lowercase=true;other=false;letter=true}if(!shift){lowercase=true;if(letter)code+=32}if(alt||control)other=true;if(!other)str=String.fromCharCode(code);console.log("code: "+
code,"alt: "+alt,"shift: "+shift,"control: "+control,"result: '"+str+"'","letter: "+letter,"lowercase: "+lowercase,"number: "+number,"other: "+other);return str};Array.prototype.shuffle=function shuffle(rounds){var tmp,in1,in2;var self=this;rounds=rounds||this.length*5;var swap=function(a,b){tmp=self[a];self[a]=self[b];self[b]=tmp};var getRandomIndex=function(){return Math.round(Math.random()*(self.length-1))%self.length};for(var i=0;i<rounds;i++){in1=getRandomIndex();in2=getRandomIndex();swap(in1,
in2)}};Array.prototype["delete"]=function deleteElement(index){var ret;if(index>=this.length||index<0||isNaN(index))return;index=Math.floor(index);if(index+1===this.length)return this.pop();var ret=this[index];for(var i=index;i<this.length-1;i++)this[i]=this[i+1];this.pop();return ret};Array.prototype.isElement=function isElement(el){for(var i=0;i<this.length;i++)if(this[i]===el)return true;return false};Array.prototype.getIndex=function getIndex(el){for(var i=0;i<this.length;i++)if(this[i]===el)return i;
return-1};Function.prototype.getCallbackObject=function(that,parameter,useApply){return{that:that,"function":this,parameter:parameter,useApply:useApply}};window.ImageData.prototype.getPixel=function(x,y){return{red:this.data[4*(x+this.width*y)+0],green:this.data[4*(x+this.width*y)+1],blue:this.data[4*(x+this.width*y)+2],alpha:this.data[4*(x+this.width*y)+3]}};window.ImageData.prototype.setPixel=function(x,y,r,g,b,a){var p=4*(x+this.width*y);this.data[p+0]=r;this.data[p+1]=g;this.data[p+2]=b;this.data[p+
3]=a};HTMLImageElement.prototype.ImageData="undefined";HTMLImageElement.prototype.getVerticallyFlippedImage=function(){var can=document.createElement("canvas");can.width=this.width;can.height=this.height;var con=can.getContext("2d");con.translate(0,this.height);con.scale(1,-1);con.drawImage(this,0,0);var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;return img};HTMLImageElement.prototype.getHorizontallyFlippedImage=function(){var can=document.createElement("canvas");can.width=
this.width;can.height=this.height;var con=can.getContext("2d");con.translate(can.width,0);con.scale(-1,1);con.drawImage(this,0,0);var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;return img};HTMLImageElement.prototype.getImageData=function(){var can=document.createElement("canvas");can.width=this.width;can.height=this.height;var con=can.getContext("2d");con.drawImage(this,0,0);this.ImageData=con.getImageData(0,0,can.width,can.height);return this.ImageData};HTMLImageElement.prototype.getDataURL=
function(){var can=document.createElement("canvas");can.width=this.width;can.height=this.height;var con=can.getContext("2d");con.drawImage(this,0,0);this.DataURL=can.toDataURL();return this.DataURL};window.CanvasRenderingContext2D.prototype.circle=function(x,y,r,centroid,clockwise){if(typeof centroid==="undefined"||centroid==null)centroid=true;if(typeof clockwise==="undefined"||clockwise==null)clockwise=true;if(!centroid){x+=r;y+=r}this.moveTo(x+r,y);if(clockwise){this.arcTo(x+r,y+r,x,y+r,r);this.arcTo(x-
r,y+r,x-r,y,r);this.arcTo(x-r,y-r,x,y-r,r);this.arcTo(x+r,y-r,x+r,y,r)}else{this.arcTo(x+r,y-r,x,y-r,r);this.arcTo(x-r,y-r,x-r,y,r);this.arcTo(x-r,y+r,x,y+r,r);this.arcTo(x+r,y+r,x+r,y,r)}};window.CanvasRenderingContext2D.prototype.arrow2=function(x1,y1,x2,y2,th,hlr,btr,clockwise){if(typeof hlr==="undefined"||hlr===null)hlr=.2;if(typeof btr==="undefined"||btr===null)btr=.5;if(typeof clockwise==="undefined"||clockwise===null)clockwise=true;var b=x2-x1;var a=y2-y1;var len=Math.pow(Math.pow(a,2)+Math.pow(b,
2),.5);if(typeof th==="undefined"||th===null)th=len*.25;else th/=2;var bth=th*btr;var hth=th;var blen=len*(1-hlr);var rad=Math.atan2(a,b);if(rad<0)rad=(rad+2*Math.PI)%(2*Math.PI);var leftAngle=rad-Math.PI/2;var rightAngle=rad+Math.PI/2;var p=[];p[0]={x:x1,y:y1};p[1]={x:Math.cos(leftAngle)*bth+p[0].x,y:Math.sin(leftAngle)*bth+p[0].y};p[2]={x:p[1].x+Math.cos(rad)*blen,y:p[1].y+Math.sin(rad)*blen};p[3]={x:p[2].x+Math.cos(leftAngle)*hth,y:p[2].y+Math.sin(leftAngle)*hth};p[4]={x:x2,y:y2};p[7]={x:Math.cos(rightAngle)*
bth+p[0].x,y:Math.sin(rightAngle)*bth+p[0].y};p[6]={x:p[7].x+Math.cos(rad)*blen,y:p[7].y+Math.sin(rad)*blen};p[5]={x:p[6].x+Math.cos(rightAngle)*hth,y:p[6].y+Math.sin(rightAngle)*hth};this.moveTo(p[0].x,p[0].y);if(clockwise)for(var i=1;i<p.length;i++)this.lineTo(p[i].x,p[i].y);else for(var i=p.length-1;i>0;i--)this.lineTo(p[i].x,p[i].y);this.lineTo(p[0].x,p[0].y)};window.CanvasRenderingContext2D.prototype.arrow3=function(x1,y1,x2,y2,th,hlr,btr,clockwise){if(typeof hlr==="undefined"||hlr===null)hlr=
.2;if(typeof btr==="undefined"||btr===null)btr=.5;if(typeof clockwise==="undefined"||clockwise===null)clockwise=true;var b=x2-x1;var a=y2-y1;var len=Math.pow(Math.pow(a,2)+Math.pow(b,2),.5);if(typeof th==="undefined"||th===null)th=len*.15;var bth=th*btr;var hth=th-bth;var blen=len*(1-hlr);var rad=Math.atan2(a,b);if(rad<0)rad=(rad+2*Math.PI)%(2*Math.PI);var leftAngle=rad-Math.PI/2;var rightAngle=rad+Math.PI/2;var p=[];p[0]={x:x1,y:y1};p[1]={x:Math.cos(leftAngle)*bth+p[0].x,y:Math.sin(leftAngle)*bth+
p[0].y};p[2]={x:p[1].x+Math.cos(rad)*blen,y:p[1].y+Math.sin(rad)*blen};p[3]={x:p[2].x+Math.cos(leftAngle)*hth,y:p[2].y+Math.sin(leftAngle)*hth};p[4]={x:x2,y:y2};p[7]={x:Math.cos(rightAngle)*bth+p[0].x,y:Math.sin(rightAngle)*bth+p[0].y};p[6]={x:p[7].x+Math.cos(rad)*blen,y:p[7].y+Math.sin(rad)*blen};p[5]={x:p[6].x+Math.cos(rightAngle)*hth,y:p[6].y+Math.sin(rightAngle)*hth};this.moveTo(p[0].x,p[0].y);if(clockwise)for(var i=1;i<p.length;i++)this.lineTo(p[i].x,p[i].y);else for(var i=p.length-1;i>0;i--)this.lineTo(p[i].x,
p[i].y);this.lineTo(p[0].x,p[0].y)};window.CanvasRenderingContext2D.prototype.fillArrow2=function(x1,y1,x2,y2,th,hlr,btr){this.beginPath();this.arrow2(x1,y1,x2,y2,th,hlr,btr);this.fill()};window.CanvasRenderingContext2D.prototype.arrow=function(x,y,th,len,degree,hlr,bhr,clockwise){if(typeof hlr==="undefined"||hlr==null)hlr=.2;if(typeof bhr==="undefined"||bhr==null)bhr=.5;if(typeof clockwise==="undefined"||clockwise==null)clockwise=true;var rad=degree*Math.PI/180;var bth=th*bhr;this.save();this.translate(x,
y);this.rotate(rad);this.moveTo(0,0);if(clockwise){this.lineTo(0,-bth/2);this.lineTo(len-len*hlr,-bth/2);this.lineTo(len-len*hlr,-th/2);this.lineTo(len,0);this.lineTo(len-len*hlr,th/2);this.lineTo(len-len*hlr,bth/2);this.lineTo(0,bth/2)}else{this.lineTo(0,bth/2);this.lineTo(len-len*hlr,bth/2);this.lineTo(len-len*hlr,th/2);this.lineTo(len,0);this.lineTo(len-len*hlr,-th/2);this.lineTo(len-len*hlr,-bth/2);this.lineTo(0,-bth/2)}this.lineTo(0,0);this.restore()};window.CanvasRenderingContext2D.prototype.fillArrow=
function(x,y,th,len,degree,hlr,bhr){this.beginPath();this.arrow(x,y,th,len,degree,hlr,bhr);this.fill()};window.CanvasRenderingContext2D.prototype.strokeArrow=function(x,y,th,len,degree,hlr,bhr){this.beginPath();this.arrow(x,y,th,len,degree,hlr,bhr);this.stroke()};window.CanvasRenderingContext2D.prototype.fillCircle=function(x,y,r,centroid){this.beginPath();this.circle(x,y,r,centroid);this.fill();this.closePath()};window.CanvasRenderingContext2D.prototype.strokeCircle=function(x,y,r,centroid){this.beginPath();
this.circle(x,y,r,centroid);this.stroke();this.closePath()};window.CanvasRenderingContext2D.prototype.variousRoundedRect=function(x,y,width,height,rtl,rtr,rbr,rbl){if(arguments.length<6)rtr=rtl;if(arguments.length<7)rbr=rtl;if(arguments.length<8)rbl=rtl;this.moveTo(x+rtl,y);this.lineTo(x+width-rtr,y);this.bezierCurveTo(x+width,y,x+width,y+rtr,x+width,y+rtr);this.lineTo(x+width,y+height-rbr);this.bezierCurveTo(x+width,y+height,x+width-rbr,y+height,x+width-rbr,y+height);this.lineTo(x+rbl,y+height);
this.bezierCurveTo(x,y+height,x,y+height-rbl,x,y+height-rbl);this.lineTo(x,y+rtl);this.bezierCurveTo(x,y,x+rtl,y,x+rtl,y)};window.CanvasRenderingContext2D.prototype.fillVariousRoundedRect=function(x,y,width,height,rtl,rtr,rbr,rbl){if(arguments.length<6)rtr=rtl;if(arguments.length<7)rbr=rtl;if(arguments.length<8)rbl=rtl;this.beginPath();this.variousRoundedRect(x,y,width,height,rtl,rtr,rbr,rbl);this.fill();this.closePath()};window.CanvasRenderingContext2D.prototype.strokeVariousRoundedRect=function(x,
y,width,height,rtl,rtr,rbr,rbl){if(arguments.length<6)rtr=rtl;if(arguments.length<7)rbr=rtl;if(arguments.length<8)rbl=rtl;this.beginPath();this.variousRoundedRect(x,y,width,height,rtl,rtr,rbr,rbl);this.stroke();this.closePath()};window.CanvasRenderingContext2D.prototype.drawRoundedImage=function(img,x,y,w,h,r){this.save();this.beginPath();this.moveTo(x+r,y);this.lineTo(x+img.width-r,y);this.bezierCurveTo(x+w,y,x+w,y+r,x+w,y+r);this.lineTo(x+w,y+w-r);this.bezierCurveTo(x+w,y+h,x+h-r,y+h,x+w-r,y+h);
this.lineTo(x+r,y+h);this.bezierCurveTo(x,y+h,x,y+h-r,x,y+h-r);this.lineTo(x,y+r);this.bezierCurveTo(x,y,x+r,y,x+r,y);this.closePath();this.clip();this.drawImage(img,x,y,w,h);this.restore();return{x:x,y:y,width:w,height:h}};window.CanvasRenderingContext2D.prototype.fillSpinnedText=function(mx,my,text,degree){this.save();var rad=degree*Math.PI/180;this.textAlign="center";this.textBaseline="middle";this.translate(mx,my);this.rotate(rad);this.fillText(text,0,0);this.restore()};window.CanvasRenderingContext2D.prototype.strokeSpinnedText=
function(mx,my,text,degree){this.save();var rad=degree*Math.PI/180;this.textAlign="center";this.textBaseline="middle";this.translate(mx,my);this.rotate(rad);this.strokeText(text,0,0);this.restore()};window.CanvasRenderingContext2D.prototype.drawCross=function(x,y,size){this.save();var s=size/2;this.beginPath();this.moveTo(x-s,y+s);this.lineTo(x+s,y-s);this.moveTo(x-s,y-s);this.lineTo(x+s,y+s);this.stroke();this.restore()};window.CanvasRenderingContext2D.prototype.cross=function(x,y,size,th){this.save();
if(typeof th==="undefined")th=Math.round(size/5);var rad1=45*Math.PI/180;var rad2=(90+180)*Math.PI/180;this.translate(x,y);this.rotate(rad1);this.rect(-size/2,-th/2,size,th);this.rotate(rad2);this.rect(-size/2,-th/2,size,th);this.restore()};window.CanvasRenderingContext2D.prototype.setFontHeight=function(val,unit){if(typeof unit!=="string")unit="px";this.font=this.font.replace(new RegExp("[0-9]+[a-z]{2}"),val+unit)};window.CanvasRenderingContext2D.prototype.getColor=function(color,alpha){var rgbaCode;
if(typeof color!=="string")return"rgba(0,0,0,0)";if(typeof alpha==="undefined"||alpha<0&&alpha>1)alpha=1;var can=document.createElement("CANVAS");can.width=1;can.height=1;var c=can.getContext("2d");c.fillStyle=color;c.fillRect(0,0,1,1);var imageData=c.getImageData(0,0,1,1).data;rgbaCode="rgba("+imageData[0]+","+imageData[1]+","+imageData[2]+","+alpha+")";return rgbaCode};window.CanvasRenderingContext2D.prototype.setStyle=function(color,alpha,fill,stroke){if(typeof fill==="undefined")fill=true;if(typeof stroke===
"undefined")stroke=true;if(!color||color==null)if(fill)color=this.fillStyle;else color=this.strokeStyle;var rgbaCode=this.getColor(color,alpha);if(fill)this.fillStyle=rgbaCode;if(stroke)this.strokeStyle=rgbaCode;return rgbaCode};Anibody.ECMAScriptExtended=true};Anibody.SetPackage("Anibody","input");
Anibody.input.Input=function Input(){Anibody.EngineObject.call(this);this.ResizeEvent=null;this.MouseHandler=null;this.TouchHandler=null;this.Mouse=null;this.Keys=null;this.Canvas={X:0,Y:0,Width:0,Height:0,MouseOn:false};this.Initialize()};Anibody.input.Input.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.input.Input.prototype.constructor=Anibody.input.Input;
Anibody.input.Input.prototype.Initialize=function(){this.CalculateCanvasPosition();if(this.Engine.Flags.KeyboardInput)this.Keys=new Anibody.input.Input.Keys;if(this.Engine.Flags.MouseInput){this.Mouse=new Anibody.input.Input.Mouse;this.MouseHandler=new Anibody.input.Input.MouseHandler}this.RegisterResizeEvent();if(this.Engine.Flags.TouchHandler)this.TouchHandler=new Anibody.input.Input.TouchHandler};
Anibody.input.Input.prototype.Update=function(){this.Canvas.MouseOn=false;if(this.Engine.Flags.MouseInput){this.Mouse.Update();this.Canvas.MouseOn=this.Mouse.IsMouseOnCanvas()}if(this.Engine.Flags.KeyboardInput)this.Keys.Update();if(this.Engine.Flags.TouchHandler)this.TouchHandler.Update()};
Anibody.input.Input.prototype.CalculateCanvasPosition=function(){var ele=this.Engine.Canvas;var x=0,y=0;this.Canvas.Width=ele.width;this.Canvas.Height=ele.height;var i=200;x+=ele.offsetLeft;y+=ele.offsetTop;while(ele.offsetParent&&ele.offsetParent.nodeName!="BODY"&&i>0){i--;x+=ele.offsetLeft;y+=ele.offsetTop;ele=ele.parentNode}this.Canvas.X=x;this.Canvas.Y=y};
Anibody.input.Input.prototype.RegisterResizeEvent=function(){this.ResizeEvent=$(window).resize(this.Engine,function(d){d.data.Input.CalculateCanvasPosition();d.data.Engine.IsCanvasFitToScreen=false})};Anibody.input.Input.prototype.UnregisterResizeEvent=function(){if(this.ResizeEvent){$(window).unbind(this.ResizeEvent);this.ResizeEvent="undefined"}};Anibody.SetPackage("Anibody","input","Input");
Anibody.input.Input.Keys=function Keys(){Anibody.EngineObject.call(this);this.KeyDownEvent=null;this.ParentKeyDownEvent=null;this.KeyUpEvent=null;this.ParentKeyUpEvent=null;this.Event={},this.Symbol="",this.KeyNotFound={Pressed:false,FramesPressed:0},this.AnyKey={Pressed:false,FramesPressed:0},this.A={Pressed:false,FramesPressed:0},this.B={Pressed:false,FramesPressed:0},this.C={Pressed:false,FramesPressed:0},this.D={Pressed:false,FramesPressed:0},this.E={Pressed:false,FramesPressed:0},this.F={Pressed:false,
FramesPressed:0},this.G={Pressed:false,FramesPressed:0},this.H={Pressed:false,FramesPressed:0},this.I={Pressed:false,FramesPressed:0},this.J={Pressed:false,FramesPressed:0},this.K={Pressed:false,FramesPressed:0},this.L={Pressed:false,FramesPressed:0},this.M={Pressed:false,FramesPressed:0},this.N={Pressed:false,FramesPressed:0},this.O={Pressed:false,FramesPressed:0},this.P={Pressed:false,FramesPressed:0},this.Q={Pressed:false,FramesPressed:0},this.R={Pressed:false,FramesPressed:0},this.S={Pressed:false,
FramesPressed:0},this.T={Pressed:false,FramesPressed:0},this.U={Pressed:false,FramesPressed:0},this.V={Pressed:false,FramesPressed:0},this.W={Pressed:false,FramesPressed:0},this.X={Pressed:false,FramesPressed:0},this.Y={Pressed:false,FramesPressed:0},this.Z={Pressed:false,FramesPressed:0},this.Control={Pressed:false,FramesPressed:0},this.Shift={Pressed:false,FramesPressed:0},this.Alt={Pressed:false,FramesPressed:0},this.Tab={Pressed:false,FramesPressed:0},this.Num0={Pressed:false,FramesPressed:0},
this.Num1={Pressed:false,FramesPressed:0},this.Num2={Pressed:false,FramesPressed:0},this.Num3={Pressed:false,FramesPressed:0},this.Num4={Pressed:false,FramesPressed:0},this.Num5={Pressed:false,FramesPressed:0},this.Num6={Pressed:false,FramesPressed:0},this.Num7={Pressed:false,FramesPressed:0},this.Num8={Pressed:false,FramesPressed:0},this.Num9={Pressed:false,FramesPressed:0},this.Up={Pressed:false,FramesPressed:0},this.Right={Pressed:false,FramesPressed:0},this.Down={Pressed:false,FramesPressed:0},
this.Left={Pressed:false,FramesPressed:0},this.Backspace={Pressed:false,FramesPressed:0},this.Space={Pressed:false,FramesPressed:0},this.Enter={Pressed:false,FramesPressed:0},this.Esc={Pressed:false,FramesPressed:0};this.Initialize()};Anibody.input.Input.Keys.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.input.Input.Keys.prototype.constructor=Anibody.input.Input.Keys;Anibody.input.Input.Keys.prototype.Initialize=function(){if(this.Engine.Flags.KeyboardInput)this.RegisterKeyEvents(this.Engine.Flags.PreventKeyboardStrokesToBubbleUp)};
Anibody.input.Input.Keys.prototype.Update=function(){if(this.AnyKey.Pressed)this.AnyKey.FramesPressed++;if(this.A.Pressed)this.A.FramesPressed++;if(this.B.Pressed)this.B.FramesPressed++;if(this.C.Pressed)this.C.FramesPressed++;if(this.D.Pressed)this.D.FramesPressed++;if(this.E.Pressed)this.E.FramesPressed++;if(this.F.Pressed)this.F.FramesPressed++;if(this.G.Pressed)this.G.FramesPressed++;if(this.H.Pressed)this.H.FramesPressed++;if(this.I.Pressed)this.I.FramesPressed++;if(this.J.Pressed)this.J.FramesPressed++;
if(this.K.Pressed)this.K.FramesPressed++;if(this.L.Pressed)this.L.FramesPressed++;if(this.M.Pressed)this.M.FramesPressed++;if(this.N.Pressed)this.N.FramesPressed++;if(this.O.Pressed)this.O.FramesPressed++;if(this.P.Pressed)this.P.FramesPressed++;if(this.Q.Pressed)this.Q.FramesPressed++;if(this.R.Pressed)this.R.FramesPressed++;if(this.S.Pressed)this.S.FramesPressed++;if(this.T.Pressed)this.T.FramesPressed++;if(this.U.Pressed)this.U.FramesPressed++;if(this.V.Pressed)this.V.FramesPressed++;if(this.W.Pressed)this.W.FramesPressed++;
if(this.X.Pressed)this.X.FramesPressed++;if(this.Y.Pressed)this.Y.FramesPressed++;if(this.Z.Pressed)this.Z.FramesPressed++;if(this.Control.Pressed)this.Control.FramesPressed++;if(this.Shift.Pressed)this.Shift.FramesPressed++;if(this.Alt.Pressed)this.Alt.FramesPressed++;if(this.Tab.Pressed)this.Tab.FramesPressed++;if(this.Num0.Pressed)this.Num0.FramesPressed++;if(this.Num1.Pressed)this.Num1.FramesPressed++;if(this.Num2.Pressed)this.Num2.FramesPressed++;if(this.Num3.Pressed)this.Num3.FramesPressed++;
if(this.Num4.Pressed)this.Num4.FramesPressed++;if(this.Num5.Pressed)this.Num5.FramesPressed++;if(this.Num6.Pressed)this.Num6.FramesPressed++;if(this.Num7.Pressed)this.Num7.FramesPressed++;if(this.Num8.Pressed)this.Num8.FramesPressed++;if(this.Num9.Pressed)this.Num9.FramesPressed++;if(this.Up.Pressed)this.Up.FramesPressed++;if(this.Right.Pressed)this.Right.FramesPressed++;if(this.Down.Pressed)this.Down.FramesPressed++;if(this.Left.Pressed)this.Left.FramesPressed++;if(this.Backspace.Pressed)this.Backspace.FramesPressed++;
if(this.Space.Pressed)this.Space.FramesPressed++;if(this.Enter.Pressed)this.Enter.FramesPressed++;if(this.Esc.Pressed)this.Esc.FramesPressed++};
Anibody.input.Input.Keys.prototype.RegisterKeyEvents=function(lockKeys){var onkeydown=function(e){var keys=e.data;keys.Event=e;if(e.key)keys.Symbol=e.key;else keys.Symbol=String.getKeyByEvent(e);keys.AnyKey.Pressed=true;switch(e.which){case 65:{keys.A.Pressed=true}break;case 66:{keys.B.Pressed=true}break;case 67:{keys.C.Pressed=true}break;case 68:{keys.D.Pressed=true}break;case 69:{keys.E.Pressed=true}break;case 70:{keys.F.Pressed=true}break;case 71:{keys.G.Pressed=true}break;case 72:{keys.H.Pressed=
true}break;case 73:{keys.I.Pressed=true}break;case 74:{keys.J.Pressed=true}break;case 75:{keys.K.Pressed=true}break;case 76:{keys.L.Pressed=true}break;case 77:{keys.M.Pressed=true}break;case 78:{keys.N.Pressed=true}break;case 79:{keys.O.Pressed=true}break;case 80:{keys.P.Pressed=true}break;case 81:{keys.Q.Pressed=true}break;case 82:{keys.R.Pressed=true}break;case 83:{keys.S.Pressed=true}break;case 84:{keys.T.Pressed=true}break;case 85:{keys.U.Pressed=true}break;case 86:{keys.V.Pressed=true}break;
case 87:{keys.W.Pressed=true}break;case 88:{keys.X.Pressed=true}break;case 89:{keys.Y.Pressed=true}break;case 90:{keys.Z.Pressed=true}break;case 17:{keys.Control.Pressed=true}break;case 16:{keys.Shift.Pressed=true}break;case 18:{keys.Alt.Pressed=true}break;case 9:{keys.Tab.Pressed=true}break;case 48:{keys.Num0.Pressed=true}break;case 49:{keys.Num1.Pressed=true}break;case 50:{keys.Num2.Pressed=true}break;case 51:{keys.Num3.Pressed=true}break;case 52:{keys.Num4.Pressed=true}break;case 53:{keys.Num5.Pressed=
true}break;case 54:{keys.Num6.Pressed=true}break;case 55:{keys.Num7.Pressed=true}break;case 56:{keys.Num8.Pressed=true}break;case 57:{keys.Num9.Pressed=true}break;case 38:{keys.Up.Pressed=true}break;case 39:{keys.Right.Pressed=true}break;case 40:{keys.Down.Pressed=true}break;case 37:{keys.Left.Pressed=true}break;case 8:{keys.Backspace.Pressed=true}break;case 32:{keys.Space.Pressed=true}break;case 13:{keys.Enter.Pressed=true}break;case 27:{keys.Esc.Pressed=true}break;default:{keys.KeyNotFound.Pressed=
true}break}if(!lockKeys){e.preventDefault();e.stopPropagation();return false}};var onkeyup=function(e){var keys=e.data;keys.Event=e;if(e.key)keys.Symbol=e.key;else keys.Symbol=String.fromCharCode(e.which).toLowerCase();keys.AnyKey.Pressed=false;keys.AnyKey.FramesPressed=0;switch(e.which){case 65:{keys.A.Pressed=false;keys.A.FramesPressed=0}break;case 66:{keys.B.Pressed=false;keys.B.FramesPressed=0}break;case 67:{keys.C.Pressed=false;keys.C.FramesPressed=0}break;case 68:{keys.D.Pressed=false;keys.D.FramesPressed=
0}break;case 69:{keys.E.Pressed=false;keys.E.FramesPressed=0}break;case 70:{keys.F.Pressed=false;keys.F.FramesPressed=0}break;case 71:{keys.G.Pressed=false;keys.G.FramesPressed=0}break;case 72:{keys.H.Pressed=false;keys.H.FramesPressed=0}break;case 73:{keys.I.Pressed=false;keys.I.FramesPressed=0}break;case 74:{keys.J.Pressed=false;keys.J.FramesPressed=0}break;case 75:{keys.K.Pressed=false;keys.K.FramesPressed=0}break;case 76:{keys.L.Pressed=false;keys.L.FramesPressed=0}break;case 77:{keys.M.Pressed=
false;keys.M.FramesPressed=0}break;case 78:{keys.N.Pressed=false;keys.N.FramesPressed=0}break;case 79:{keys.O.Pressed=false;keys.O.FramesPressed=0}break;case 80:{keys.P.Pressed=false;keys.P.FramesPressed=0}break;case 81:{keys.Q.Pressed=false;keys.Q.FramesPressed=0}break;case 82:{keys.R.Pressed=false;keys.R.FramesPressed=0}break;case 83:{keys.S.Pressed=false;keys.S.FramesPressed=0}break;case 84:{keys.T.Pressed=false;keys.T.FramesPressed=0}break;case 85:{keys.U.Pressed=false;keys.U.FramesPressed=0}break;
case 86:{keys.V.Pressed=false;keys.V.FramesPressed=0}break;case 87:{keys.W.Pressed=false;keys.W.FramesPressed=0}break;case 88:{keys.X.Pressed=false;keys.X.FramesPressed=0}break;case 89:{keys.Y.Pressed=false;keys.Y.FramesPressed=0}break;case 90:{keys.Z.Pressed=false;keys.Z.FramesPressed=0}break;case 48:{keys.Num0.Pressed=false;keys.Num0.FramesPressed=0}break;case 49:{keys.Num1.Pressed=false;keys.Num1.FramesPressed=0}break;case 50:{keys.Num2.Pressed=false;keys.Num2.FramesPressed=0}break;case 51:{keys.Num3.Pressed=
false;keys.Num3.FramesPressed=0}break;case 52:{keys.Num4.Pressed=false;keys.Num4.FramesPressed=0}break;case 53:{keys.Num5.Pressed=false;keys.Num5.FramesPressed=0}break;case 54:{keys.Num6.Pressed=false;keys.Num6.FramesPressed=0}break;case 55:{keys.Num7.Pressed=false;keys.Num7.FramesPressed=0}break;case 56:{keys.Num8.Pressed=false;keys.Num8.FramesPressed=0}break;case 57:{keys.Num9.Pressed=false;keys.Num9.FramesPressed=0}break;case 17:{keys.Control.Pressed=false;keys.Control.FramesPressed=0}break;case 16:{keys.Shift.Pressed=
false;keys.Shift.FramesPressed=0}break;case 18:{keys.Alt.Pressed=false;keys.Alt.FramesPressed=0}break;case 9:{keys.Tab.Pressed=false;keys.Tab.FramesPressed=0}break;case 8:{keys.Backspace.Pressed=false;keys.Backspace.FramesPressed=0}break;case 38:{keys.Up.Pressed=false;keys.Up.FramesPressed=0}break;case 39:{keys.Right.Pressed=false;keys.Right.FramesPressed=0}break;case 40:{keys.Down.Pressed=false;keys.Down.FramesPressed=0}break;case 37:{keys.Left.Pressed=false;keys.Left.FramesPressed=0}break;case 32:{keys.Space.Pressed=
false;keys.Space.FramesPressed=0}break;case 13:{keys.Enter.Pressed=false;keys.Enter.FramesPressed=0}break;case 27:{keys.Esc.Pressed=false;keys.Esc.FramesPressed=0}break;default:{keys.KeyNotFound.Pressed=false;keys.KeyNotFound.FramesPressed=0}break}if(!lockKeys){e.preventDefault();e.stopPropagation();return false}};this.KeyDownEvent=$(document).keydown(this,onkeydown);this.KeyUpEvent=$(document).keyup(this,onkeyup);if(window.top!=window.self)try{this.ParentKeyDownEvent=$(window.parent.document).keydown(this,
onkeydown);this.ParentKeyUpEvent=$(window.parent.document).keyup(this,onkeyup)}catch(e){}};Anibody.input.Input.Keys.prototype.UnregisterKeyEvents=function(){if(this.KeyUpEvent){$(document).unbind(this.KeyUpEvent);this.KeyUpEvent="undefined"}if(this.KeyDownEvent){$(document).unbind(this.KeyDownEvent);this.KeyDownEvent="undefined"}};Anibody.SetPackage("Anibody","input","Input");
Anibody.input.Input.Mouse=function Mouse(){Anibody.EngineObject.call(this);this.MouseDownEvent=null;this.MouseUpEvent=null;this.MouseMoveEvent=null;this.MouseScrollEvent=null;this.EventObject=0;this.DownEvent=0;this.UpEvent=0;this.Left={Up:true,Down:false,FramesDown:0,FramesUp:0,BusyFrames:0};this.Right={Up:true,Down:false,FramesDown:0,FramesUp:0,BusyFrames:0};this.Position={X:0,Y:0,Xold:0,Yold:0,Relative:{X:0,Y:0},Camera:{X:0,Y:0},Delta:{X:0,Y:0}};this.Cursor=null;this.Initialize()};
Anibody.input.Input.Mouse.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.input.Input.Mouse.prototype.constructor=Anibody.input.Input.Mouse;Anibody.input.Input.Mouse.prototype.Initialize=function(){this.Cursor=new Anibody.input.Input.Mouse.Cursor;this.RegisterMouseEvents(this.Engine.Flags.PreventContextClickBubbleToUp)};
Anibody.input.Input.Mouse.prototype.Update=function(){var e=this.EventObject;if(this.Left.BusyFrames>0)this.Left.BusyFrames--;if(this.Right.BusyFrames>0)this.Right.BusyFrames--;var pos=this.Position;pos.Xold=pos.X;pos.Yold=pos.Y;if(e&&e.pageX){pos.X=e.pageX;pos.Y=e.pageY}else{pos.X=0;pos.Y=0}pos.Relative.X=pos.X-this.Engine.Input.Canvas.X;pos.Relative.Y=pos.Y-this.Engine.Input.Canvas.Y;pos.Camera.X=pos.X-this.Engine.Input.Canvas.X+this.Engine.Camera.SelectedCamera.X;pos.Camera.Y=pos.Y-this.Engine.Input.Canvas.Y+
this.Engine.Camera.SelectedCamera.Y;pos.Delta.X=pos.X-pos.Xold;pos.Delta.Y=pos.Y-pos.Yold;if(this.Left.Down)this.Left.FramesDown++;if(this.Right.Down)this.Right.FramesDown++;if(this.Left.Up)this.Left.FramesUp++;if(this.Right.Up)this.Right.FramesUp++;this.Cursor.Update()};
Anibody.input.Input.Mouse.prototype.RegisterMouseEvents=function(lockContextMenu){this.MouseMoveEvent=$(document).mousemove(this.Engine,function(e){e.data.Input.Mouse.EventObject=e});this.MouseDownEvent=$(document).mousedown(this.Engine,function(e){e.data.Input.Mouse.DownEvent=e;var input=e.data.Input.Mouse;if(e.which==1){input.Left.Down=true;input.Left.Up=false;input.Left.FramesUp=0}if(e.which==3){input.Right.Down=true;input.Right.Up=false;input.Right.FramesUp=0}e.preventDefault();e.stopPropagation();
e.cancelBubble=true});this.MouseUpEvent=$(document).mouseup(this.Engine,function(e){e.data.Input.Mouse.UpEvent=e;var input=e.data.Input.Mouse;if(e.which==1){input.Left.Down=false;input.Left.Up=true;input.Left.FramesDown=0}if(e.which==3){input.Right.Down=false;input.Right.Up=true;input.Right.FramesDown=0}e.preventDefault();e.stopPropagation();e.cancelBubble=true});this.MouseWheelEvent=$(window).bind("wheel",this.Engine,function(e){var that=e.data;if(that.Canvas.MouseOn){var dy=e.originalEvent.deltaY;
var dx=e.originalEvent.deltaX;if(that&&that.Input&&that.Input.MouseHandler)that.Input.MouseHandler.WheelHandler(dx,dy);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}});if(lockContextMenu)this.Engine.Canvas.oncontextmenu=function(e){e.preventDefault();e.stopPropagation();e.cancelBubble=true;return false}};
Anibody.input.Input.Mouse.prototype.UnregisterMouseEvents=function(){if(this.MouseUpEvent!==null){$(document).unbind(this.MouseUpEvent);this.MouseUpEvent=null}if(this.MouseDownEvent!==null){$(document).unbind(this.MouseDownEvent);this.MouseDownEvent=null}};
Anibody.input.Input.Mouse.prototype.FakeMouseClick=function(x,y){console.log("fake mouse down at {0},{1}".format(x,y));var releaseLength=300;var fe={pageX:x,pageY:y,clientX:x,clientY:y,which:1};this.EventObject=fe;this.Left.Down=true;this.Up=false;this.Left.FramesUp=0;var upf=function(){var fe={pageX:x,pageY:y,clientX:x,clientY:y,which:1};this.EventObject=fe;this.Left.Down=false;this.Left.Up=true;this.Left.FramesDown=0};window.setTimeout(upf.bind(this),releaseLength)};
Anibody.input.Input.Mouse.prototype.IsMouseOnCanvas=function(){var mx=this.Position.X;var my=this.Position.Y;var can=this.Engine.Input.Canvas;if(can.X<=mx&&mx<can.X+can.Width&&can.Y<=my&&my<can.Y+can.Height){can.MouseOn=true;this.Engine.Canvas.MouseOn=true}else{can.MouseOn=false;this.Engine.Canvas.MouseOn=true}return can.MouseOn};Anibody.SetPackage("Anibody","classes","Input","Mouse");
Anibody.input.Input.Mouse.Cursor=function Cursor(){Anibody.EngineObject.call(this);this.Current="auto";this.OnlyCanvas=true};Anibody.input.Input.Mouse.Cursor.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.input.Input.Mouse.Cursor.prototype.constructor=Anibody.input.Input.Mouse.Cursor;Anibody.input.Input.Mouse.Cursor.prototype.Set=function(css){$(this.Engine.Canvas).css("cursor",css)};Anibody.input.Input.Mouse.Cursor.prototype.alias=function(){this.Current="alias";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype.cell=function(){this.Current="cell";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.col_resize=function(){this.Current="col-resize";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.copy=function(){this.Current="copy";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.crosshair=function(){this.Current="crosshair";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype["default"]=function(){this.Current="default";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.ew_resize=function(){this.Current="ew-resize";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.grab=function(){this.Current="grab";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.grabbing=function(){this.Current="grabbing";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype.help=function(){this.Current="help";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.move=function(){this.Current="move";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.nesw_resize=function(){this.Current="move";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.ns_resize=function(){this.Current="ns-resize";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype.nwse_resize=function(){this.Current="ns-resize"};Anibody.input.Input.Mouse.Cursor.prototype.no_drop=function(){this.Current="no-drop";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.none=function(){this.Current="none";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.not_allowed=function(){this.Current="not-allowed";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype.pointer=function(){this.Current="pointer";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.progress=function(){this.Current="progress";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.row_resize=function(){this.Current="row-resize";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.text=function(){this.Current="text";this.Set(this.Current)};
Anibody.input.Input.Mouse.Cursor.prototype.vertical_text=function(){this.Current="vertical-text";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.wait=function(){this.Current="wait";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.zoom_in=function(){this.Current="zoom-in";this.Set(this.Current)};Anibody.input.Input.Mouse.Cursor.prototype.zoom_out=function(){this.Current="zoom-out";this.Set(this.Current)};Anibody.SetPackage("Anibody","input","Input");
Anibody.input.Input.MouseHandler=function MouseHandler(){Anibody.EngineObject.call(this);this.LeftMouseClickHandlerCBOs=new Anibody.util.PriorityQueue;this.RightMouseClickHandlerCBOs=new Anibody.util.PriorityQueue;this.WheelHandlerCBOs=new Anibody.util.PriorityQueue;this.WheelLimiter=.1;this.HoverRequests=[];this._yesPool=[];this._oldLeftFramesDown=0;this._oldRightFramesDown=0;this.Initialize()};Anibody.input.Input.MouseHandler.prototype=Object.create(Anibody.EngineObject.prototype);
Anibody.input.Input.MouseHandler.prototype.constructor=Anibody.input.Input.MouseHandler;Anibody.input.Input.MouseHandler.prototype.Initialize=function(){if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1)this.WheelLimiter=1.5};
Anibody.input.Input.MouseHandler.prototype.WheelHandler=function(dx,dy){var arr=this.WheelHandlerCBOs.heap;var d;var event={Handled:false,Timestamp:Date.now(),Frame:this.Engine.CurrentFrames,Delta:{X:dx*this.WheelLimiter,Y:dy*this.WheelLimiter},Type:"wheel"};for(var i=0;!event.Handled&&i<arr.length;i++){d=arr[i].data;d["function"].call(d.that,event,d.parameter)}};
Anibody.input.Input.MouseHandler.prototype.AddMouseHandler=function(type,cbo,prio){var ref;if(type==="leftclick"){ref=this.LeftMouseClickHandlerCBOs.Enqueue(cbo,prio);this.LeftMouseClickHandlerCBOs.Sort()}if(type==="rightclick"){ref=this.RightMouseClickHandlerCBOs.Enqueue(cbo,prio);this.RightMouseClickHandlerCBOs.Sort()}if(type==="wheel"){ref=this.WheelHandlerCBOs.Enqueue(cbo,prio);this.WheelHandlerCBOs.Sort()}return ref};
Anibody.input.Input.MouseHandler.prototype.RemoveMouseHandler=function(type,ref){var tmp;if(type==="leftclick")tmp=this.LeftMouseClickHandlerCBOs.DeleteByReferenceNumber(ref);if(type==="rightclick")tmp=this.RightMouseClickHandlerCBOs.DeleteByReferenceNumber(ref);if(type==="wheel")tmp=this.WheelHandlerCBOs.DeleteByReferenceNumber(ref);return tmp};Anibody.input.Input.MouseHandler.prototype.Flush=function(){this.LeftMouseClickHandlerCBOs.Flush();this.RightMouseClickHandlerCBOs.Flush();this.WheelHandlerCBOs.Flush()};
Anibody.input.Input.MouseHandler.prototype.AddHoverRequest=function(area,object,attr,successvalue,failvalue){if(arguments.length<=2)return;if(!area)area={type:"rect",x:object.X,y:object.Y,width:object.Width,height:object.Height};if(typeof successvalue==="undefined")successvalue=true;if(typeof failvalue==="undefined")failvalue=false;this.HoverRequests.push({area:area,object:object,attr:attr,success:successvalue,failure:failvalue})};
Anibody.input.Input.MouseHandler.prototype.MouseClickHandler=function(){var mouse=this.Engine.Input.Mouse;var newfrdown=mouse.Left.FramesDown;if(this._oldLeftFramesDown>0&&newfrdown==0&&mouse.Left.BusyFrames<=0){var arr=this.LeftMouseClickHandlerCBOs.heap;var d;var event={Handled:false,Timestamp:Date.now(),Frame:this.Engine.CurrentFrame,Type:"leftclick",Mouse:this.Engine.Input.Mouse};for(var i=0;!event.Handled&&i<arr.length;i++){d=arr[i].data;d["function"].call(d.that,event,d.parameter)}mouse.Left.BusyFrames=
5}this._oldLeftFramesDown=this.Engine.Input.Mouse.Left.FramesDown;var newfrdown=mouse.Right.FramesDown;if(this._oldRightFramesDown>0&&newfrdown==0&&mouse.Right.BusyFrames<=0){var arr=this.RightMouseClickHandlerCBOs.heap;var d;var event={Handled:false,Timestamp:Date.now(),Frame:this.Engine.CurrentFrame,Type:"rightclick"};for(var i=0;!event.Handled&&i<arr.length;i++){d=arr[i].data;d["function"].call(d.that,event,d.parameter)}mouse.Right.BusyFrames=5}this._oldRightFramesDown=this.Engine.Input.Mouse.Right.FramesDown};
Anibody.input.Input.MouseHandler.prototype.ResolveHoverRequest=function(){var c=this.Engine.Context;var yes=[];var req;var a;var res;var found;var mpos=this.Engine.Input.Mouse.Position.Relative;for(var i=0;i<this.HoverRequests.length;i++){req=this.HoverRequests[i];a=req.area;found=false;c.save();c.beginPath();if(!found&&req.area.type==="rect"){c.rect(a.x,a.y,a.width,a.height);found=true}if(!found&&req.area.type==="rrect"){c.variousRoundedRect(a.x,a.y,a.width,a.height,a.rounding);found=true}if(!found&&
req.area.type==="vrrect"){var r=a.roundings;c.variousRoundedRect(a.x,a.y,a.width,a.height,r[0],r[1]||0,r[2]||0,r[3]||0);found=true}if(!found&&req.area.type==="circle"){c.circle(a.x,a.y,a.radius,a.centroid||true);found=true}if(!found&&req.area.type==="function"){if(typeof a["function"]==="function")a["function"](c);if(a["function"]&&typeof a["function"]["function"]==="function")Anibody.CallObject(a["function"]);found=true}res=c.isPointInPath(mpos.X,mpos.Y);if(res)if(a.background)req.object[req.attr]=
req.success;else yes.push(req);else req.object[req.attr]=req.failure;c.closePath();c.restore()}for(var i=0;i<yes.length;i++){req=yes[i];if(i!==yes.length-1)req.object[req.attr]=req.failure;else req.object[req.attr]=req.success}this.HoverRequests=[]};Anibody.SetPackage("Anibody","input","Input");
Anibody.input.Input.TouchHandler=function TouchHandler(){Anibody.EngineObject.call(this);this.PreventDefault=true;this.PreventScrolling=true;this.FakeMouseClick=this.Engine.Flags.Touch2FakeMouseClick;this.DEFINEDVALUES={TapLimit:300,VarianceLimit:50,SwipeTrackLimit:150,SwipeTimeLimit:600},this.EventObjects={TouchStartEvent:false,TouchMoveEvent:false,TouchEndEvent:false};this.EventListener={TouchStartEvent:false,TouchMoveEvent:false,TouchEndEvent:false};this.DeviceIsTouchDevice=false;this.TouchDeviceRecognization=
[];this.ExpectTouch=false;this.Finger1={X:0,Y:0,Detected:false,TapListener:[],LongTapListener:[],SwipeListener:[]};this.Finger2={X:0,Y:0,Detected:false,TapListener:[],LongTapListener:[],SwipeListener:[]};this.Initialize()};Anibody.input.Input.TouchHandler.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.input.Input.TouchHandler.prototype.constructor=Anibody.input.Input.TouchHandler;
Anibody.input.Input.TouchHandler.prototype.Initialize=function(){this.EventListener.TouchStartEvent=this.Engine.Canvas.addEventListener("touchstart",this.TouchStartHandler.bind(this),false);this.EventListener.TouchMoveEvent=this.Engine.Canvas.addEventListener("touchmove",this.TouchMoveHandler.bind(this),false);this.EventListener.TouchEndEvent=this.Engine.Canvas.addEventListener("touchend",this.TouchEndHandler.bind(this),false)};
Anibody.input.Input.TouchHandler.prototype.TouchStartHandler=function(e){this.EventObjects.TouchStartEvent=e;this.ExpectTouch=true;this.Finger1.Detected=true;this.Finger1.X=e.touches[0].clientX;this.Finger1.Y=e.touches[0].clientY;this.Finger2.Detected=false;if(e.touches.length>=2){this.Finger2.X=e.touches[1].clientX;this.Finger2.Y=e.touches[1].clientY;this.Finger2.Detected=true}if(this.PreventDefault)e.preventDefault()};
Anibody.input.Input.TouchHandler.prototype.TouchMoveHandler=function(e){this.EventObjects.TouchMoveEvent=e;this.Finger2.Detected=false;this.Finger1.X=e.touches[0].clientX;this.Finger1.Y=e.touches[0].clientY;if(e.touches.length>=2){this.Finger2.Detected=true;this.Finger2.X=e.touches[1].clientX;this.Finger2.Y=e.touches[1].clientY}if(this.PreventScrolling)e.preventDefault()};
Anibody.input.Input.TouchHandler.prototype.TouchEndHandler=function(e){this.EventObjects.TouchEndEvent=e;var starte=this.EventObjects.TouchStartEvent;var laste=this.EventObjects.TouchMoveEvent||this.EventObjects.TouchStartEvent;var timedelta=e.timeStamp-this.EventObjects.TouchStartEvent.timeStamp;var xdelta=laste.touches[0].clientX-starte.touches[0].clientX;var ydelta=laste.touches[0].clientY-starte.touches[0].clientY;this.Finger2.Detected=false;if(laste.touches.length>=2){this.Finger2.Detected=true;
xdelta=laste.touches[1].clientX-starte.touches[1].clientX;ydelta=laste.touches[1].clientY-starte.touches[1].clientY}if(timedelta<=this.DEFINEDVALUES.TapLimit&&this._movementWithin(xdelta,ydelta,this.DEFINEDVALUES.VarianceLimit)){this.ExpectTouch=false;if(!this.Finger2.Detected)this.OnTapFinger1();else this.OnTapFinger2()}if(this.ExpectTouch&&timedelta>this.DEFINEDVALUES.TapLimit&&this._movementWithin(xdelta,ydelta,this.DEFINEDVALUES.VarianceLimit)){this.ExpectTouch=false;if(!this.Finger2.Detected)this.OnLongTapFinger1();
else this.OnLongTapFinger2()}if(this.ExpectTouch&&timedelta<=this.DEFINEDVALUES.SwipeTimeLimit&&!this._movementWithin(xdelta,ydelta,this.DEFINEDVALUES.SwipeTrackLimit)){this.ExpectTouch=false;var dir=this._getDirectionObject(xdelta,ydelta);if(!this.Finger2.Detected)this.OnSwipeFinger1(dir);else this.OnSwipeFinger2(dir)}if(this.ExpectTouch)console.log("No guesture matched: timedelta: {0}, xdelta: {1}, ydelta: {2}".format(timedelta,xdelta,ydelta));this.EventObjects.TouchMoveEvent=false;this.Finger1.Detected=
false;this.Finger2.Detected=false;this.ExpectTouch=false;if(this.PreventDefault)e.preventDefault()};Anibody.input.Input.TouchHandler.prototype.Update=function(){if(!this.ExpectTouch)return false};Anibody.input.Input.TouchHandler.prototype._movementWithin=function(x,y,limit){if(Math.abs(x)<=limit&&Math.abs(y)<=limit)return true;else false};
Anibody.input.Input.TouchHandler.prototype._getDirectionObject=function(x,y){var dir;if(arguments.length>=2){if(Math.abs(x)>Math.abs(y))if(x>0)dir={X:1,Y:0};else dir={X:-1,Y:0};else if(y>0)dir={X:0,Y:1};else dir={X:0,Y:-1};return dir}return false};Anibody.input.Input.TouchHandler.prototype._getSwipeDirection=function(dir){if(arguments.length===1)if(dir.Y===0)return dir.X===1?"right":"left";else return dir.Y===1?"down":"up";return false};
Anibody.input.Input.TouchHandler.prototype.OnTapFinger1=function(){console.log("Finger1 Tap");if(this.FakeMouseClick)this.Engine.Input.Mouse.FakeMouseClick(this.Finger1.X,this.Finger1.Y);var cbo;for(var i=0;this.Finger1.TapListener.length;i++){cbo=this.Finger1.TapListener[i];Anibody.CallObject(cbo)}};Anibody.input.Input.TouchHandler.prototype.OnTapFinger2=function(){console.log("Finger2 Tap");var cbo;for(var i=0;this.Finger2.TapListener.length;i++){cbo=this.Finger2.TapListener[i];Anibody.CallObject(cbo)}};
Anibody.input.Input.TouchHandler.prototype.OnLongTapFinger1=function(){console.log("Finger1 LongTap");var cbo;for(var i=0;this.Finger1.LongTapListener.length;i++){cbo=this.Finger1.LongTapListener[i];Anibody.CallObject(cbo)}};Anibody.input.Input.TouchHandler.prototype.OnLongTapFinger2=function(){console.log("Finger2 LongTap");var cbo;for(var i=0;this.Finger2.LongTapListener.length;i++){cbo=this.Finger2.LongTapListener[i];Anibody.CallObject(cbo)}};
Anibody.input.Input.TouchHandler.prototype.OnSwipeFinger1=function(dir){console.log("Finger1 "+this._getSwipeDirection(dir)+" swipe - "+JSON.stringify(dir));var cbo;for(var i=0;this.Finger1.SwipeListener.length;i++){cbo=this.Finger1.SwipeListener[i];Anibody.CallObject(cbo,dir)}};
Anibody.input.Input.TouchHandler.prototype.OnSwipeFinger2=function(dir){console.log("Finger2 "+this._getSwipeDirection(dir)+" swipe - "+JSON.stringify(dir));var cbo;for(var i=0;this.Finger2.SwipeListener.length;i++){cbo=this.Finger2.SwipeListener[i];Anibody.CallObject(cbo,dir)}};
Anibody.input.Input.TouchHandler.prototype.AddEventListener=function(eventtype,cbo){switch(eventtype){case "tapfinger1":this.Finger1.TapListener.push(cbo);break;case "tapfinger2":this.Finger2.TapListener.push(cbo);break;case "longtapfinger1":this.Finger1.LongTapListener.push(cbo);break;case "longtapfinger2":this.Finger2.LongTapListener.push(cbo);break;case "swipefinger1":this.Finger1.SwipeListener.push(cbo);break;case "swipefinger2":this.Finger2.SwipeListener.push(cbo);break;default:console.log("could not add event listener with type "+
eventtype)}};Anibody.input.Input.TouchHandler.prototype.Types={TapFinger1:"tapfinger1",TapFinger2:"tapfinger2",LongTapFinger1:"longtapfinger1",LongTapFinger2:"longtapfinger2",SwipeFinger1:"swipefinger1",SwipeFinger2:"swipefinger2"};Anibody.SetPackage("Anibody","input","Input");
Anibody.input.Input.TouchPie=function TouchPie(){Anibody.ABO.call(this);this.Color="#bbb";this.ColorSelected="#999";this.SelectedPiePiece=-1;this.Offset=2.5;this.StartAngles=false;this.EndAngles=false;this.CenterRepositionValue=false;this.Value=this.Offset*2;this.Enabled=false;var stdcbo=function(where){return{that:this,parameter:where,"function":function(where){console.log("Trigger: "+where)}}};this.COArray=[stdcbo("right"),stdcbo("bottom"),stdcbo("left"),stdcbo("top")];this.Labels=["Right","Bottom",
"Left","Top"];this.CanvasWidth=800;this.CanvasHeight=600;this.Radius=this.CanvasHeight/6;this.BottomMargin=20;this.Initialize()};Anibody.input.Input.TouchPie.prototype=Object.create(Anibody.ABO.prototype);Anibody.input.Input.TouchPie.prototype.constructor=Anibody.input.Input.TouchPie;
Anibody.input.Input.TouchPie.prototype.Initialize=function(){var offset=this.Offset;var _toRadians=function(deg){return deg*Math.PI/180};this.StartAngles=[_toRadians(315+offset),_toRadians(45+offset),_toRadians(135+offset),_toRadians(225+offset)];this.EndAngles=[_toRadians(45-offset),_toRadians(135-offset),_toRadians(225-offset),_toRadians(315-offset)];var v=this.Value;this.CenterRepositionValue=[{x:v*1,y:v*0},{x:v*0,y:v*1},{x:v*-1,y:v*0},{x:v*0,y:v*-1}]};
Anibody.input.Input.TouchPie.prototype.Draw=function(c){if(!this.Enabled)return;var piewidth=this.Value*2+this.Radius*2;var x=this.Engine.Canvas.width/2-piewidth/2;var y=this.Engine.Canvas.height-this.Radius*2-this.BottomMargin;c.save();var can=document.createElement("CANVAS");can.width=can.height=piewidth;var con=can.getContext("2d");var crp=this.CenterRepositionValue;var center=this.Radius+this.Value;for(var i=0;i<4;i++){con.fillStyle=this.Color;if(this.SelectedPiePiece==i)con.fillStyle=this.ColorSelected;
con.beginPath();con.moveTo(center+crp[i].x,center+crp[i].y);con.arc(center,center,this.Radius,this.StartAngles[i],this.EndAngles[i]);con.lineTo(center+crp[i].x,center+crp[i].y);con.fill();con.closePath()}con.globalCompositeOperation="destination-out";con.beginPath();con.moveTo(center,center);con.arc(center,center,this.Radius*.3,0,2*Math.PI,false);con.lineTo(center,center);con.fill();con.closePath();con.globalCompositeOperation="source-over";con.textAlign="center";con.textBaseline="middle";con.fillStyle=
"black";con.fillText(this.Labels[0],center+this.Radius*2/3,center);con.fillText(this.Labels[1],center,center+this.Radius*2/3);con.fillText(this.Labels[2],center-this.Radius*2/3,center);con.fillText(this.Labels[3],center,center-this.Radius*2/3);c.drawImage(can,x,y);c.restore()};
Anibody.input.Input.TouchPie.prototype.Update=function(){var curcan=this.Engine.Canvas;if(curcan.width!=this.CanvasWidth||curcan.height!=this.CanvasHeight){this.CanvasWidth=curcan.width;this.CanvasHeight=curcan.height;var relval=Math.min(this.CanvasHeight,this.CanvasWidth);this.Radius=relval/6}};Anibody.input.Input.TouchPie.prototype.SelectPiece=function(pp){if(pp!=Anibody.input.Input.TouchPie.prototype.Pieces.None){this.SelectedPiePiece=pp;return this.SelectedPiePiece}return this.DeselectPieces()};
Anibody.input.Input.TouchPie.prototype.DeselectPieces=function(){return this.SelectedPiePiece=Anibody.input.Input.TouchPie.prototype.Pieces.None};Anibody.input.Input.TouchPie.prototype.SetPiece=function(dir,label,co){if(dir==Anibody.input.Input.TouchPie.prototype.Pieces.None)return-1;this.COArray[dir]=co;this.Labels[dir]=label;return dir};
Anibody.input.Input.TouchPie.prototype.GetPiece=function(dir){dir=dir.toLowerCase();if(dir==="right")return Anibody.input.Input.TouchPie.prototype.Pieces.Right;if(dir==="bottom")return Anibody.input.Input.TouchPie.prototype.Pieces.Bottom;if(dir==="left")return Anibody.input.Input.TouchPie.prototype.Pieces.Left;if(dir==="top")return Anibody.input.Input.TouchPie.prototype.Pieces.Top;return-1};
Anibody.input.Input.TouchPie.prototype.Trigger=function(){if(this.SelectedPiePiece===Anibody.input.Input.TouchPie.prototype.Pieces.None)return;var cbo=this.COArray[this.SelectedPiePiece];Anibody.CallObject(cbo);this.Enabled=false};Anibody.input.Input.TouchPie.prototype.Pieces={Right:0,Bottom:1,Left:2,Top:3,None:-1};Anibody.SetPackage("Anibody","nav");
Anibody.nav.BoxMenu=function BoxMenu(x,y,w,h,t,th){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=w;this.Height=h;this.TitleHeight=th||20;this.TitleRounding=this.TitleHeight/4;this.DisplayHeight=this.Height-this.TitleHeight;this.ItemsHeight=0;this.OffsetY=0;this.Title=t||"Men{ue}".decodeURI();this._minimized=false;this.PreItemUpdateCBO={that:this,"function":function(item,index,parameter){return},parameter:{}};this.Items=[];this.PostItemUpdateCBO={that:this,"function":function(item,index,parameter){return},
parameter:{}};this.HandleWidth=20;this.Fac=0;this.Handle={x:this.X+this.Width-this.HandleWidth,y:this.Y+this.TitleHeight,width:this.HandleWidth,height:this.Height-this.TitleHeight};this.HandleRounding=4;this._framesAfterDragging=0;this._dragging=false;this._scrolling=false;this.IsMouseOver=false;this.IsMouseOverTitle=false;this.IsMouseOverHandle=false;this.IsMouseOverClose=false;this.IsMouseOverMinimize=false;this.IsMouseOverDisplay=false;this.TrueClosing=true;this.Closed=false;this.TrulyClosed=false;
this.PositionBeforeClosing={x:0,y:0};this._ref=null;this._ref_PIF=null;this._ref_W=null;this.Initialize()};Anibody.nav.BoxMenu.prototype=Object.create(Anibody.ABO.prototype);Anibody.nav.BoxMenu.prototype.constructor=Anibody.nav.BoxMenu;Anibody.nav.BoxMenu.prototype.TitleColor="#ddd";Anibody.nav.BoxMenu.prototype.Color="#eee";Anibody.nav.BoxMenu.prototype.HandleColor="#999";Anibody.nav.BoxMenu.prototype.Initialize=function(){this.AddProcessInputFunctionObject();this.AddMouseHandler()};
Anibody.nav.BoxMenu.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOverMinimize){if(this._framesAfterDragging>1)this.ClickOnMinimize();e.Handled=true}if(this.IsMouseOverClose){if(this._framesAfterDragging>1)this.ClickOnClose();e.Handled=true}}},100);this._ref_W=this.Engine.Input.MouseHandler.AddMouseHandler("wheel",{parameter:this.Engine,that:this,"function":function(e,
engine){if(this.IsMouseOver){var d=e.Delta;this._scrolling=true;this.UpdateHandle(d);e.Handled=true}}},100)};
Anibody.nav.BoxMenu.prototype.AddProcessInputFunctionObject=function(){this._ref_PIF=this.Engine.AddProcessInputFunctionObject({parameter:this.Engine,that:this,"function":function(engine){var mouse=engine.Input.Mouse;if(this.IsMouseOverHandle&&mouse.Left.Down)this._scrolling=true;if(this.IsMouseOverTitle&&mouse.Left.Down)this._dragging=true;if(mouse.Left.Up){this._scrolling=false;this._dragging=false}}},5)};
Anibody.nav.BoxMenu.prototype.RemoveMouseHandler=function(){if(this._ref!=null){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref);this._ref=null}};Anibody.nav.BoxMenu.prototype.RemoveProcessInputFunctionObject=function(){if(this._ref_PIF!=null){this.Engine.RemoveProcessInputFunctionObject(this._ref_PIF);this._ref_PIF=null}};
Anibody.nav.BoxMenu.prototype.Draw=function(c){c.save();c.fillStyle=this.TitleColor;c.fillVariousRoundedRect(this.X,this.Y,this.Width,this.TitleHeight,this.TitleRounding,this.TitleRounding,0,0);if(this.IsMouseOverTitle){c.fillStyle="rgba(0,0,0,0.2)";c.fillVariousRoundedRect(this.X,this.Y,this.Width-10-2*this.TitleHeight,this.TitleHeight,5,0,0,0)}var off=this.TitleHeight/5;var box={x:this.X+this.Width-5-this.TitleHeight+off,y:this.Y+off,width:this.TitleHeight-2*off,height:this.TitleHeight-off*2};c.strokeStyle=
"black";c.beginPath();c.moveTo(box.x,box.y);c.lineTo(box.x+box.width,box.y+box.height);c.moveTo(box.x,box.y+box.height);c.lineTo(box.x+box.width,box.y);c.stroke();c.closePath();if(this.IsMouseOverClose){c.fillStyle="rgba(0,0,0,0.2)";c.fillRect(box.x-off,box.y-off,box.width+2*off,box.height+2*off)}box.x-=this.TitleHeight+5;if(this._minimized)c.strokeRect(box.x,box.y,box.width,box.height);else{c.beginPath();c.moveTo(box.x,box.y+box.height-this.TitleHeight*.15);c.lineTo(box.x+box.width,box.y+box.height-
this.TitleHeight*.15);c.stroke();c.closePath()}if(this.IsMouseOverMinimize){c.fillStyle="rgba(0,0,0,0.2)";c.fillRect(box.x-off,box.y-off,box.width+2*off,box.height+2*off)}c.textAlign="left";c.textBaseline="top";c.fillStyle="black";c.setFontHeight(this.TitleHeight-off);c.fillText(this.Title,this.X+10,this.Y+off);if(!this._minimized){c.fillStyle=this.Color;c.fillRect(this.X,this.Y+this.TitleHeight,this.Width,this.Height-this.TitleHeight);c.strokeStyle="black";c.beginPath();c.moveTo(this.X+this.Width-
this.TitleHeight,this.Y+this.TitleHeight);c.lineTo(this.X+this.Width-this.TitleHeight,this.Y+this.Height);c.stroke();c.closePath();c.fillStyle=this.HandleColor;c.fillVariousRoundedRect(this.Handle.x,this.Handle.y,this.Handle.width,this.Handle.height,this.HandleRounding);if(this.IsMouseOverHandle){c.fillStyle="rgba(0,0,0,0.2)";c.fillVariousRoundedRect(this.Handle.x,this.Handle.y,this.Handle.width,this.Handle.height,4)}c.beginPath();c.rect(this.X,this.Y+this.TitleHeight,this.Width-this.TitleHeight,
this.DisplayHeight);c.clip();for(var i=0;i<this.Items.length;i++)this.Items[i].item.Draw(c)}c.restore()};Anibody.nav.BoxMenu.prototype.GetItemsHeight=function(){var max=0;for(var i=0;i<this.Items.length;i++)max+=this.Items[i].item.Height+this.Items[i].offset.y;if(max>this.DisplayHeight)return max;else return this.DisplayHeight};
Anibody.nav.BoxMenu.prototype.ProcessInput=function(){var area=this.GetArea();area.type="vrrect";area.roundings=[this.TitleRounding,this.TitleRounding,0,0];area.background=true;this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver");area={x:this.X,y:this.Y,width:this.Width,height:this.TitleHeight,type:"vrrect",roundings:[this.TitleRounding,this.TitleRounding,0,0]};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverTitle");area={x:this.X+this.Width-5-this.TitleHeight,
y:this.Y,width:this.TitleHeight,height:this.TitleHeight,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverClose");area={x:this.X+this.Width-10-2*this.TitleHeight,y:this.Y,width:this.TitleHeight,height:this.TitleHeight,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverMinimize");area={x:this.X,y:this.Y+this.TitleHeight,width:this.Width-this.TitleHeight,height:this.DisplayHeight,type:"rect"};area.background=true;this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverDisplay");area={x:this.Handle.x,y:this.Handle.y,width:this.Handle.width,height:this.Handle.height,rounding:this.HandleRounding,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverHandle");if(!this._minimized){var item;for(var i=0;this.IsMouseOverDisplay&&i<this.Items.length;i++){item=this.Items[i].item;item.ProcessInput()}}};
Anibody.nav.BoxMenu.prototype.Update=function(){var item;this._framesAfterDragging++;if(this._dragging||this._scrolling)this._framesAfterDragging=0;var m=this.Engine.Input.Mouse.Position;this.UpdateBox(m.Delta);if(!this._minimized){for(var i=0;this.IsMouseOverDisplay&&this._framesAfterDragging>1&&i<this.Items.length;i++){item=this.Items[i].item;item.Update()}this.UpdateHandle(m.Delta)}this.AdjustItemsPosition();if(this.IsMouseOverTitle||this.IsMouseOverHandle||this.IsMouseOverMinimize||this.IsMouseOverClose)this.Engine.Input.Mouse.Cursor.Set("pointer")};
Anibody.nav.BoxMenu.prototype.UpdateHandle=function(d){var refresh=false;if(arguments.length<=0||!d){d={Y:0};refresh=true}this.ItemsHeight=this.GetItemsHeight();this.Fac=this.DisplayHeight/this.ItemsHeight;this.Handle.height=this.DisplayHeight*this.Fac;if(refresh||this._scrolling&&!isNaN(d.Y)){this.Handle.y+=d.Y;this.OffsetY-=d.Y/this.Fac;this.AdjustHandle()}};
Anibody.nav.BoxMenu.prototype.UpdateBox=function(d){if(this._dragging&&!isNaN(d.Y)){var reldistance={x:this.Handle.x-this.X,y:this.Handle.y-this.Y};this.X+=d.X;this.Handle.x+=d.X;this.Y+=d.Y;this.Handle.y+=d.Y;var can=this.Engine.Canvas;if(this.X<0)this.X=0;if(this.X+this.Width>can.width)this.X=can.width-this.Width;if(this.Y<0)this.Y=0;if(this.Y+this.TitleHeight>can.height)this.Y=can.height-this.TitleHeight;this.Handle.x=this.X+reldistance.x;this.Handle.y=this.Y+reldistance.y}};
Anibody.nav.BoxMenu.prototype.AdjustHandle=function(){if(this.Handle.y<this.Y+this.TitleHeight)this.Handle.y=this.Y+this.TitleHeight;if(this.Handle.y>this.Y+this.TitleHeight+this.DisplayHeight-this.Handle.height)this.Handle.y=this.Y+this.TitleHeight+this.DisplayHeight-this.Handle.height;if(this.OffsetY>0)this.OffsetY=0;if(this.OffsetY<this.DisplayHeight-this.ItemsHeight)this.OffsetY=this.DisplayHeight-this.ItemsHeight};
Anibody.nav.BoxMenu.prototype.AddItem=function(item,offsetx,offsety){if(arguments.length<=1)offsetx=0;if(arguments.length<=2)offsety=0;if(item instanceof Anibody.ABO){this.Items.push({item:item,offset:{x:offsetx,y:offsety}});this.AdjustItemsPosition()}};
Anibody.nav.BoxMenu.prototype.DeleteItems=function(itemDeleteFunc){var item;if(typeof itemDeleteFunc==="undefined")itemDeleteFunc=function(item,engine){return};for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;itemDeleteFunc(item,this.Engine)}this.Items=[]};
Anibody.nav.BoxMenu.prototype.AdjustItemsPosition=function(){var item,off;var cury=0;for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;off=this.Items[i].offset;item.X=this.X+off.x;item.Y=this.Y+off.y+this.TitleHeight+this.OffsetY+cury;cury+=item.Height+off.y;if(this._minimized)item.X+=2*this.Engine.Canvas.width}};Anibody.nav.BoxMenu.prototype.ClickOnMinimize=function(){this._minimized=!this._minimized;if(this._minimized)this.Height=this.TitleHeight;else this.Height=this.TitleHeight+this.DisplayHeight};
Anibody.nav.BoxMenu.prototype.ClickOnClose=function(){console.log("Close Box");if(this.TrueClosing){if(confirm("M{oe}chtest du dieses Men{ue} schlie{ss}en?".decodeURI()))this.Close()}else{var can=this.Engine.Canvas;if(this.Closed)this.MoveTo(this.PositionBeforeClosing.x,this.PositionBeforeClosing.y);else{this.PositionBeforeClosing.x=this.X;this.PositionBeforeClosing.y=this.Y;this.MoveTo(can.width-this.Width-50,can.height-this.TitleHeight)}}};
Anibody.nav.BoxMenu.prototype.MoveTo=function(x,y){var reldistance={x:this.Handle.x-this.X,y:this.Handle.y-this.Y};var mf=new Anibody.util.MultiFlow([this,this],["X","Y"],[x,y],500,{that:this,"function":function(p){this.Closed=!this.Closed;this._minimized=true;if(this.Y+this.TitleHeight<this.Engine.Canvas.height)this._minimized=false},parameter:true},{that:this,"function":function(p){this.Handle.x=this.X+reldistance.x;this.Handle.y=this.Y+reldistance.y},parameter:true});mf.Start()};
Anibody.nav.BoxMenu.prototype.Close=function(){this.RemoveMouseHandler();this.RemoveProcessInputFunctionObject();this.Closed=true;this.TrulyClosed=true;this._minimized=true};Anibody.SetPackage("Anibody","nav");
Anibody.nav.Gallery=function Gallery(x,y,w,h,t,th){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=w;this.Height=h;this.TitleHeight=th||20;this.TitleRounding=this.TitleHeight/4;this.DisplayHeight=this.Height-2*this.TitleHeight;this.ItemsWidth=0;this.OffsetX=0;this.Title=t||"Galerie";this._minimized=false;this.PreItemUpdateCBO={that:this,"function":function(item,index,parameter){return},parameter:{}};this.Items=[];this.PostItemUpdateCBO={that:this,"function":function(item,index,parameter){return},
parameter:{}};this.HandleHeight=20;this.Fac=0;this.Handle={x:this.X,y:this.Y+this.Height-this.TitleHeight,width:this.Width,height:this.TitleHeight};this.HandleRounding=4;this._framesAfterDragging=0;this.Draggable=true;this._dragging=false;this._scrolling=false;this.IsMouseOver=false;this.IsMouseOverTitle=false;this.IsMouseOverHandle=false;this.IsMouseOverClose=false;this.IsMouseOverMinimize=false;this.IsMouseOverDisplay=false;this.TrueClosing=true;this.Closed=false;this.TrulyClosed=false;this.PositionBeforeClosing=
{x:0,y:0};this._ref=null;this._ref_PIF=null;this._ref_W=null;this.Initialize()};Anibody.nav.Gallery.prototype=Object.create(Anibody.ABO.prototype);Anibody.nav.Gallery.prototype.constructor=Anibody.nav.Gallery;Anibody.nav.Gallery.prototype.TitleColor="#ddd";Anibody.nav.Gallery.prototype.Color="#eee";Anibody.nav.Gallery.prototype.HandleColor="#999";Anibody.nav.Gallery.prototype.Initialize=function(){this.AddProcessInputFunctionObject();this.AddMouseHandler()};
Anibody.nav.Gallery.prototype.SetDraggable=function(val){if(this.Draggable!==val)if(this.Draggable)this.Draggable=false;else this.Draggable=true};
Anibody.nav.Gallery.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOverMinimize){if(this._framesAfterDragging>1)this.ClickOnMinimize();e.Handled=true}if(this.IsMouseOverClose){if(this._framesAfterDragging>1)this.ClickOnClose();e.Handled=true}}},100);this._ref_W=this.Engine.Input.MouseHandler.AddMouseHandler("wheel",{parameter:this.Engine,that:this,"function":function(e,
engine){if(this.IsMouseOver){var d={X:e.Delta.Y,Y:e.Delta.X};this._scrolling=true;this.UpdateHandle(d);e.Handled=true}}},100)};
Anibody.nav.Gallery.prototype.AddProcessInputFunctionObject=function(){this._ref_PIF=this.Engine.AddProcessInputFunctionObject({parameter:this.Engine,that:this,"function":function(engine){var mouse=engine.Input.Mouse;if(this.IsMouseOverHandle&&mouse.Left.Down)this._scrolling=true;if(this.Draggable&&this.IsMouseOverTitle&&mouse.Left.Down)this._dragging=true;if(mouse.Left.Up){this._scrolling=false;this._dragging=false}}},5)};
Anibody.nav.Gallery.prototype.RemoveMouseHandler=function(){if(this._ref!=null){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref);this._ref=null}};Anibody.nav.Gallery.prototype.RemoveProcessInputFunctionObject=function(){if(this._ref_PIF!=null){this.Engine.RemoveProcessInputFunctionObject(this._ref_PIF);this._ref_PIF=null}};
Anibody.nav.Gallery.prototype.Draw=function(c){c.save();c.fillStyle=this.TitleColor;c.fillVariousRoundedRect(this.X,this.Y,this.Width,this.TitleHeight,this.TitleRounding,this.TitleRounding,0,0);if(this.Draggable&&this.IsMouseOverTitle){c.fillStyle="rgba(0,0,0,0.2)";c.fillVariousRoundedRect(this.X,this.Y,this.Width-10-2*this.TitleHeight,this.TitleHeight,5,0,0,0)}var off=this.TitleHeight/5;var box={x:this.X+this.Width-5-this.TitleHeight+off,y:this.Y+off,width:this.TitleHeight-2*off,height:this.TitleHeight-
off*2};if(this.Draggable){c.strokeStyle="black";c.beginPath();c.moveTo(box.x,box.y);c.lineTo(box.x+box.width,box.y+box.height);c.moveTo(box.x,box.y+box.height);c.lineTo(box.x+box.width,box.y);c.stroke();c.closePath();if(this.IsMouseOverClose){c.fillStyle="rgba(0,0,0,0.2)";c.fillRect(box.x-off,box.y-off,box.width+2*off,box.height+2*off)}box.x-=this.TitleHeight+5;if(this._minimized)c.strokeRect(box.x,box.y,box.width,box.height);else{c.beginPath();c.moveTo(box.x,box.y+box.height-this.TitleHeight*.15);
c.lineTo(box.x+box.width,box.y+box.height-this.TitleHeight*.15);c.stroke();c.closePath()}if(this.IsMouseOverMinimize){c.fillStyle="rgba(0,0,0,0.2)";c.fillRect(box.x-off,box.y-off,box.width+2*off,box.height+2*off)}}c.textAlign="left";c.textBaseline="top";c.fillStyle="black";c.setFontHeight(this.TitleHeight-off);c.fillText(this.Title,this.X+10,this.Y+off);if(!this._minimized){c.fillStyle=this.Color;c.fillRect(this.X,this.Y+this.TitleHeight,this.Width,this.Height-this.TitleHeight);c.strokeStyle="rgba(0,0,0,0.6)";
c.beginPath();c.moveTo(this.X,this.Y+this.TitleHeight+this.DisplayHeight);c.lineTo(this.X+this.Width,this.Y+this.TitleHeight+this.DisplayHeight);c.stroke();c.closePath();c.fillStyle=this.HandleColor;c.fillVariousRoundedRect(this.Handle.x,this.Handle.y,this.Handle.width,this.Handle.height,this.HandleRounding);if(this.IsMouseOverHandle){c.fillStyle="rgba(0,0,0,0.2)";c.fillVariousRoundedRect(this.Handle.x,this.Handle.y,this.Handle.width,this.Handle.height,4)}c.beginPath();c.rect(this.X,this.Y+this.TitleHeight,
this.Width,this.DisplayHeight);c.clip();for(var i=0;i<this.Items.length;i++)this.Items[i].item.Draw(c)}c.restore()};Anibody.nav.Gallery.prototype.GetItemsWidth=function(){var max=0;for(var i=0;i<this.Items.length;i++)max+=this.Items[i].item.Width+this.Items[i].offset.x;if(max>this.Width)return max;else return this.Width};
Anibody.nav.Gallery.prototype.ProcessInput=function(){var area=this.GetArea();area.type="vrrect";area.roundings=[this.TitleRounding,this.TitleRounding,0,0];area.background=true;this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver");if(this.Draggable){area={x:this.X,y:this.Y,width:this.Width,height:this.TitleHeight,type:"vrrect",roundings:[this.TitleRounding,this.TitleRounding,0,0]};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverTitle")}if(this.Draggable){area=
{x:this.X+this.Width-5-this.TitleHeight,y:this.Y,width:this.TitleHeight,height:this.TitleHeight,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverClose")}if(this.Draggable){area={x:this.X+this.Width-10-2*this.TitleHeight,y:this.Y,width:this.TitleHeight,height:this.TitleHeight,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverMinimize")}area={x:this.X,y:this.Y+this.TitleHeight,width:this.Width,height:this.DisplayHeight,type:"rect"};area.background=
true;this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverDisplay");area={x:this.Handle.x,y:this.Handle.y,width:this.Handle.width,height:this.Handle.height,rounding:this.HandleRounding,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverHandle");if(!this._minimized){var item;for(var i=0;this.IsMouseOverDisplay&&i<this.Items.length;i++){item=this.Items[i].item;item.ProcessInput()}}};
Anibody.nav.Gallery.prototype.Update=function(){var item;this._framesAfterDragging++;if(this._dragging||this._scrolling)this._framesAfterDragging=0;var m=this.Engine.Input.Mouse.Position;this.UpdateBox(m.Delta);if(!this._minimized){for(var i=0;this.IsMouseOverDisplay&&this._framesAfterDragging>1&&i<this.Items.length;i++){item=this.Items[i].item;item.Update()}this.UpdateHandle(m.Delta)}this.AdjustItemsPosition();if(this.IsMouseOverTitle||this.IsMouseOverHandle||this.IsMouseOverMinimize||this.IsMouseOverClose)this.Engine.Input.Mouse.Cursor.Set("pointer")};
Anibody.nav.Gallery.prototype.UpdateHandle=function(d){var refresh=false;if(arguments.length<=0||!d){d={Y:0};refresh=true}this.ItemsWidth=this.GetItemsWidth();this.Fac=this.Width/this.ItemsWidth;this.Handle.width=this.Width*this.Fac;if(refresh||this._scrolling&&!isNaN(d.X)){this.Handle.x+=d.X;this.OffsetX-=d.X/this.Fac;this.AdjustHandle()}};
Anibody.nav.Gallery.prototype.UpdateBox=function(d){if(this._dragging&&!isNaN(d.Y)){var reldistance={x:this.Handle.x-this.X,y:this.Handle.y-this.Y};this.X+=d.X;this.Handle.x+=d.X;this.Y+=d.Y;this.Handle.y+=d.Y;var can=this.Engine.Canvas;if(this.X<0)this.X=0;if(this.X+this.Width>can.width)this.X=can.width-this.Width;if(this.Y<0)this.Y=0;if(this.Y+this.TitleHeight>can.height)this.Y=can.height-this.TitleHeight;this.Handle.x=this.X+reldistance.x;this.Handle.y=this.Y+reldistance.y}};
Anibody.nav.Gallery.prototype.AdjustHandle=function(){if(this.Handle.x<this.X)this.Handle.x=this.X;if(this.Handle.x>this.X+this.Width-this.Handle.width)this.Handle.x=this.X+this.Width-this.Handle.width;if(this.OffsetX>0)this.OffsetX=0;if(this.OffsetX<this.Width-this.ItemsWidth)this.OffsetX=this.Width-this.ItemsWidth};
Anibody.nav.Gallery.prototype.AddItem=function(item,offsetx,offsety){if(arguments.length<=1)offsetx=0;if(arguments.length<=2)offsety=offsetx;if(item instanceof Anibody.ABO){this.Items.push({item:item,offset:{x:offsetx,y:offsety}});this.AdjustItemsPosition()}};
Anibody.nav.Gallery.prototype.DeleteItems=function(itemDeleteFunc){var item;if(typeof itemDeleteFunc==="undefined")itemDeleteFunc=function(item,engine){return};for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;itemDeleteFunc(item,this.Engine)}this.Items=[]};
Anibody.nav.Gallery.prototype.AdjustItemsPosition=function(){var item,off;var curx=0;for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;off=this.Items[i].offset;item.X=this.X+off.x+curx+this.OffsetX;item.Y=this.Y+off.y+this.TitleHeight;curx+=item.Width+off.x;if(this._minimized)item.Y+=2*this.Engine.Canvas.height}};Anibody.nav.Gallery.prototype.ClickOnMinimize=function(){this._minimized=!this._minimized;if(this._minimized)this.Height=this.TitleHeight;else this.Height=this.TitleHeight+this.DisplayHeight};
Anibody.nav.Gallery.prototype.ClickOnClose=function(){console.log("Close Box");if(this.TrueClosing){if(confirm("M{oe}chtest du dieses Men{ue} schlie{ss}en?".decodeURI()))this.Close()}else{var can=this.Engine.Canvas;if(this.Closed)this.MoveTo(this.PositionBeforeClosing.x,this.PositionBeforeClosing.y);else{this.PositionBeforeClosing.x=this.X;this.PositionBeforeClosing.y=this.Y;this.MoveTo(can.width-this.Width-50,can.height-this.TitleHeight)}}};
Anibody.nav.Gallery.prototype.MoveTo=function(x,y){var reldistance={x:this.Handle.x-this.X,y:this.Handle.y-this.Y};var mf=new Anibody.util.MultiFlow([this,this],["X","Y"],[x,y],500,{that:this,"function":function(p){this.Closed=!this.Closed;this._minimized=true;if(this.Y+this.TitleHeight<this.Engine.Canvas.height)this._minimized=false},parameter:true},{that:this,"function":function(p){this.Handle.x=this.X+reldistance.x;this.Handle.y=this.Y+reldistance.y},parameter:true});mf.Start()};
Anibody.nav.Gallery.prototype.Close=function(x,y){this.RemoveMouseHandler();this.RemoveProcessInputFunctionObject();this.Closed=true;this.TrulyClosed=true;this._minimized=true};Anibody.SetPackage("Anibody","nav");Anibody.nav.SlideMenu=function SlideMenu(attto,dist){Anibody.ABO.call(this);this.Tabs=[];this.OpenTab=null;this.AttachedSide=attto;this.DistanceToCanvasNullpoint=dist;this.MarginBetweenTabs=5;this.NeededDepth=0};Anibody.nav.SlideMenu.prototype=Object.create(Anibody.ABO.prototype);
Anibody.nav.SlideMenu.prototype.constructor=Anibody.nav.SlideMenu;Anibody.nav.SlideMenu.prototype.Draw=function(c){c.save();for(var i=0;i<this.Tabs.length;i++)this.Tabs[i].Draw(c);c.restore()};Anibody.nav.SlideMenu.prototype.Update=function(){var mouse=this.Engine.Input.Mouse;for(var i=0;i<this.Tabs.length;i++)this.Tabs[i].Update(mouse)};Anibody.nav.SlideMenu.prototype.ProcessInput=function(){for(var i=0;i<this.Tabs.length;i++)this.Tabs[i].ProcessInput()};
Anibody.nav.SlideMenu.prototype.AddTab=function(label){var tab=new Tab(label,this);var p={x:0,y:0};if(this.AttachedSide=="left")p.y+=this.DistanceToCanvasNullpoint;for(var i=0;i<this.Tabs.length;i++)p.y+=this.Tabs[i].Height+this.MarginBetweenTabs;tab.Y=p.y;this.Tabs.push(tab);return tab};Anibody.nav.SlideMenu.prototype.CloseAllTabs=function(quick){if(this.OpenTab!==null)if(quick)this.OpenTab.QuickClose();else this.OpenTab.Close()};
Anibody.nav.SlideMenu.prototype.GetTabsByName=function(name){var arr=[];for(var i=0;i<this.Tabs.length;i++)if(this.Tabs[i].Label===name)arr.push(this.Tabs[i]);return arr};Anibody.nav.SlideMenu.prototype.Delete=function(){for(var i=0;i<this.Tabs.length;i++)this.Tabs[i].RemoveMouseHandler()};Anibody.SetPackage("Anibody","nav");
Anibody.nav.Tab=function Tab(label,owner){Anibody.ABO.call(this);this.TIN=this.UniqueID;this.Label=label;this.SlideMenu=owner;this.Items=[];this.X=0;this.Y=0;this.OldX=-1;this.Width=35;this.Height=90;this.IsMouseOver=false;this.IsMouseOverMenu=false;this.FontSize=18;this.LabelPadding=10;this.Rounding=4;this.Selected=false;this.Menu={Depth:100,X:0,Y:20,Width:0};this._stops=[{stop:0,color:"rgba(0,0,0,0.5)"},{stop:.5,color:"rgba(0,0,0,0.25)"},{stop:1,color:"rgba(0,0,0,0)"}];this._ling;this.IsOpen=false;
this._ref=null;this.Initialize()};Anibody.nav.Tab.prototype=Object.create(Anibody.ABO.prototype);Anibody.nav.Tab.prototype.constructor=Anibody.nav.Tab;Anibody.nav.Tab.prototype.FontColor="#000";Anibody.nav.Tab.prototype.BackgroundColor="#aaa";Anibody.nav.Tab.prototype.BackgroundColorSelected="#ccc";Anibody.nav.Tab.prototype.BreaklineColor="#666";
Anibody.nav.Tab.prototype.Initialize=function(){this.AddMouseHandler();var c=this.Engine.Context;c.save();c.setFontHeight(this.FontSize);var w=c.measureText(this.Label).width;c.restore();if(this.SlideMenu.AttachedSide=="left"){this.Menu.X=-1*this.Menu.Depth;this.Menu.Width=this.Engine.Canvas.height-this.Menu.Y*2;this.Height=w+2*this.LabelPadding}};
Anibody.nav.Tab.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOver){e.Handled=true;if(!this.IsOpen)this.Open();else this.Close()}if(this.IsMouseOverMenu)e.Handled=true}},1E3)};Anibody.nav.Tab.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref)};
Anibody.nav.Tab.prototype.Draw=function(c){var x=this.X;var y=this.Y;c.fillStyle=this.Selected?this.BackgroundColorSelected:this.BackgroundColor;c.fillVariousRoundedRect(x,y,this.Width,this.Height,0,this.Rounding,this.Rounding,0);c.fillStyle=this.FontColor;c.setFontHeight(this.FontSize,"px");c.fillSpinnedText(x+this.Width/2,y+this.Height/2,this.Label,270);if(this.IsOpen){c.fillStyle=this.BackgroundColorSelected;c.fillRect(0,this.Menu.Y,this.SlideMenu.NeededDepth,this.Menu.Width);for(var i=0;i<this.Items.length;i++)if(this.Items[i].item!=
"break")this.Items[i].item.Draw(c);else try{var pi=this.Items[i-1].item;if(this.Items.length>=i+1){var ni=this.Items[i+1].item;var halfdif=(ni.Y-(pi.Y+pi.Height))/2;var y=pi.Y+pi.Height+halfdif;c.beginPath();c.moveTo(this.Menu.X+10,y);c.lineWidth=3;c.strokeStyle=Anibody.nav.Tab.prototype.BreaklineColor;c.lineTo(this.Menu.X+this.Menu.Depth-10,y);c.stroke()}}catch(e){console.log("problem with the breakline in a tab")}}else{this._ling=this.Engine.Context.createLinearGradient(this.X,this.Y,this.X+5,this.Y);
for(var i=0;i<this._stops.length;i++)this._ling.addColorStop(this._stops[i].stop,this._stops[i].color);c.fillStyle=this._ling;c.fillRect(this.X,this.Y,5,this.Height)}};
Anibody.nav.Tab.prototype.Update=function(){if(this.IsMouseOver)this.Engine.Input.Mouse.Cursor.Set("pointer");this.X=this.SlideMenu.NeededDepth;this.Menu.X=this.X-this.Menu.Depth;if(this.X!==this.OldX)this.AdjustItemsPosition();this.OldX=this.X;if(this.SlideMenu.OpenTab===null||this.SlideMenu.OpenTab!==this){this.IsOpen=false;this.Selected=false}for(var i=0;i<this.Items.length;i++)if(this.Items[i].item!="break")this.Items[i].item.Update()};
Anibody.nav.Tab.prototype.ProcessInput=function(){var area={x:this.X,y:this.Y,width:this.Width,height:this.Height,roundings:[0,this.Rounding,this.Rounding,0],type:"vrrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver");if(this.IsOpen){area={x:this.Menu.X,y:this.Menu.Y,width:this.Menu.X+this.Menu.Depth,height:this.Menu.Y+this.Menu.Width,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverMenu")}if(this.IsOpen)for(var i=0;i<this.Items.length;i++)if(this.Items[i].item!=
"break")this.Items[i].item.ProcessInput()};Anibody.nav.Tab.prototype.Open=function(){this.IsOpen=true;this.Selected=true;this.SlideMenu.OpenTab=this;var aim=this.Menu.Depth;(new Anibody.util.Flow(this.SlideMenu,"NeededDepth",aim,700,{that:this,"function":function(){}})).Start()};
Anibody.nav.Tab.prototype.Close=function(){var aim=0;(new Anibody.util.Flow(this.SlideMenu,"NeededDepth",aim,700,{that:this,"function":function(){this.IsOpen=false;this.Selected=false;this.IsMouseOverMenu=false;this.SlideMenu.OpenTab=null}})).Start()};Anibody.nav.Tab.prototype.QuickClose=function(){this.SlideMenu.NeededDepth=0;this.IsOpen=false;this.Selected=false;this.IsMouseOverMenu=false;this.SlideMenu.OpenTab=null};
Anibody.nav.Tab.prototype.SetDepth=function(val){this.Menu.Depth=val;this.Menu.X=-1*this.Menu.Depth};Anibody.nav.Tab.prototype.SetNeededDepth=function(){var max=this.Menu.Depth;var item;if(this.SlideMenu.AttachedSide=="left")for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;if(item!=="break"&&max<item.Width)max=item.Width}this.SetDepth(max)};
Anibody.nav.Tab.prototype.AddItem=function(item,offsetx,offsety,depthcorrection){if(arguments.length<=1)offsetx=0;if(arguments.length<=2)offsety=offsetx;if(item==="break"&&this.Items.length>0)this.Items.push({item:item,offset:{x:offsetx,y:offsety}});if(item instanceof Anibody.ABO){if(item==="break"&&this.Items.length<=0)return;this.Items.push({item:item,offset:{x:offsetx,y:offsety}})}if(depthcorrection)this.SetNeededDepth()};
Anibody.nav.Tab.prototype.AdjustItemsPosition=function(){var item;var cury=0;var margin=5;if(this.SlideMenu.AttachedSide=="left")for(var i=0;i<this.Items.length;i++){item=this.Items[i].item;if(item!=="break"){item.X=this.Menu.X+this.Items[i].offset.x;item.Y=this.Menu.Y+cury+this.Items[i].offset.y+margin;cury+=margin+item.Height+this.Items[i].offset.y}}};Anibody.nav.Tab.prototype.Delete=function(){this.RemoveMouseHandler()};
Anibody.nav.Tab.prototype.DeleteItems=function(itemDeleteFunc,from,to){var item;if(typeof itemDeleteFunc==="undefined"||!itemDeleteFunc)itemDeleteFunc=function(item,engine){return};if(typeof from==="undefined")from=0;if(typeof to==="undefined")to=this.Items.length;var tmp=[];for(var i=0;i<from;i++)tmp.push(this.Items[i]);for(var i=from;i<to;i++){item=this.Items[i].item;itemDeleteFunc(item,this.Engine)}this.Items=tmp};Anibody.SetPackage("Anibody","shapes");
Anibody.shapes.Shape=function Shape(x,y){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Centroid={x:x,y:y};this.Points=[{x:x,y:y}];this.FillType="color";this.FillCode="#666";this._fillStyle=null;this.BorderWidth=0;this.BorderType="color";this.BorderCode="#000";this._rotation=0;this.Initialize()};Anibody.shapes.Shape.prototype=Object.create(Anibody.ABO.prototype);Anibody.shapes.Shape.prototype.constructor=Anibody.shapes.Shape;
Anibody.shapes.Shape.prototype.Initialize=function(){this._calculateCentroid();this._calculateSurroundingRectangle();this._updateFillStyle()};
Anibody.shapes.Shape.prototype._updateFillStyle=function(){if(this.FillType==="image"){if(typeof this.FillCode==="string"){this.FillCode=this.Engine.MediaManager.GetPicture(this.FillCode);this._fillStyle=this.FillCode}if(this.FillCode&&this.FillCode.complete){var repeat="repeat";this._fillStyle=c.createPattern(this.FillCode,repeat)}}if(this.FillType==="color")this._fillStyle=this.FillCode;if(this.FillType==="none")this._fillStyle="rgba(0,0,0,0)";if(this.FillType==="linearGradient"){var c=this.Engine.Context;
var lg=c.createLinearGradient(this.X,this.Y,this.X+this.Width,this.Y+this.Width);var stops=[{stop:0,color:"rgba(90,90,90,1)"},{stop:1,color:"rgba(30,30,30,1)"}];for(var i=0;i<stops.length;i++)lg.addColorStop(stops[i].stop,stops[i].color);this._fillStyle=lg}if(this.FillType==="radialGradient"){var c=this.Engine.Context;var rg=c.createRadialGradient(this.X+this.Width*.2,this.Y+this.Height*.2,Math.min(this.Width,this.Height)*.2,this.X+this.Width*.2,this.Y+this.Height*.2,Math.min(this.Width,this.Height)*
.4);var stops=[{stop:0,color:"rgba(90,90,90,1)"},{stop:1,color:"rgba(30,30,30,1)"}];for(var i=0;i<stops.length;i++)lg.addColorStop(stops[i].stop,stops[i].color);this._fillStyle=rg}};
Anibody.shapes.Shape.prototype.Draw=function(c){if(this.Points.length<2)return;c.save();c.beginPath();c.moveTo(this.Points[0].x,this.Points[0].y);for(var i=1;i<this.Points.length;i++)c.lineTo(this.Points[i].x,this.Points[i].y);if(this._fillStyle===null||!this._fillStyle)this._updateFillStyle();c.fillStyle=this._fillStyle;c.fill()};
Anibody.shapes.Shape.prototype._calculateCentroid=function(){var centroid={x:0,y:0};var signedArea=0;var x0=0;var y0=0;var x1=0;var y1=0;var a=0;var i=0;for(i=0;i<this.Points.length-1;++i){x0=this.Points[i].x;y0=this.Points[i].y;x1=this.Points[i+1].x;y1=this.Points[i+1].y;a=x0*y1-x1*y0;signedArea+=a;centroid.x+=(x0+x1)*a;centroid.y+=(y0+y1)*a}x0=this.Points[i].x;y0=this.Points[i].y;x1=this.Points[0].x;y1=this.Points[0].y;a=x0*y1-x1*y0;signedArea+=a;centroid.x+=(x0+x1)*a;centroid.y+=(y0+y1)*a;signedArea*=
.5;centroid.x/=6*signedArea;centroid.y/=6*signedArea;this.Centroid=centroid};Anibody.shapes.Shape.prototype._calculateSurroundingRectangle=function(){var x=this.Points[0].x;var max=this.Points[0].x;var y=this.Points[0].y;var maxy=this.Points[0].y;for(var i=1;i<this.Points.length;i++){x=Math.min(x,this.Points[i].x);y=Math.min(y,this.Points[i].y);max=Math.max(max,this.Points[i].x);maxy=Math.max(maxy,this.Points[i].y)}this.X=x;this.Y=y;this.Width=max-x;this.Height=maxy-y};
Anibody.shapes.Shape.prototype.AddPoint=function(x,y){this.Points.push({x:x,y:y});this._calculateCentroid();this._sortPoints();this._calculateSurroundingRectangle()};Anibody.shapes.Shape.prototype.Rotate=function(x,y){if(isNaN(x))x=this.Centroid.x;if(isNaN(y))y=this.Centroid.y};Anibody.shapes.Shape.prototype._getAngle=function(p){var dx,dy,val;dx=p.x-this.Centroid.x;dy=p.y-this.Centroid.y;val=Math.atan2(dy,dx);var atan2_correction=function(atan2){return atan2<0?Math.PI+(Math.PI+atan2):atan2};return atan2_correction(val)};
Anibody.shapes.Shape.prototype._sortPoints=function(){for(var i=0;i<this.Points.length;i++){this.Points[i]._angleRadian=this._getAngle(this.Points[i]);this.Points[i]._angleDegree=this.Points[i]._angle*180/Math.PI}this.Points.sort(function(a,b){return a._angleRadian>b._angleRadian?1:-1})};
Anibody.shapes.Rectangle=function Rectangle(x,y,width,height){Anibody.Shape.call(this);this.X=x;this.Y=y;this.Width=width;this.Height=height;this.Centroid={x:x+width/2,y:y+height/2};this.Points=[{x:x,y:y},{x:x+width,y:y},{x:x+width,y:y+height},{x:x,y:y+height}];this.Initialize()};Anibody.shapes.Rectangle.prototype=Object.create(Anibody.shapes.Shape.prototype);Anibody.shapes.Rectangle.prototype.constructor=Anibody.shapes.Rectangle;Anibody.shapes.Rectangle.prototype.Initialize=function(){this._calculateCentroid()};
Anibody.shapes.Rectangle.prototype._calculateCentroid=function(){this.Centroid={x:this.X+this.Width/2,y:this.Y+this.Height/2}};Anibody.SetPackage("Anibody","static");Anibody["static"].Random=function Random(){};
Anibody["static"].Random.GetNumberOld=function(min,max,decimals){if(isNaN(min))min=0;if(isNaN(max))if(Number&&Number.MAX_SAFE_INTEGER)max=Number.MAX_SAFE_INTEGER;else max=Math.pow(2,53)-1;if(isNaN(decimals))decimals=0;var ran=Math.random()*Math.pow(10,decimals+6);min*=Math.pow(10,decimals);max*=Math.pow(10,decimals);ran=ran%(max-min+1)+min;return Math.round(ran)/Math.pow(10,decimals)};
Anibody["static"].Random.GetNumber=function(min,max,decimals){if(window.crypto||window.crypto.getRandomValues)return Anibody["static"].Random.GetNumberOld(min,max,decimals);if(isNaN(min))min=0;if(isNaN(max))if(Number&&Number.MAX_SAFE_INTEGER)max=Number.MAX_SAFE_INTEGER;else max=Math.pow(2,53)-1;if(typeof decimals==="undefined"||isNaN(decimals))decimals=0;var array=new Uint32Array(3);window.crypto.getRandomValues(array);var num=array[0]+array[1]+array[2];max*=Math.pow(10,decimals);min*=Math.pow(10,
decimals);num=num%(max-min+1)+min;num/=Math.pow(10,decimals);return num};Anibody["static"].Random.GetTimestamp=function(min,max,unit){if(typeof unit==="undefined")unit="s";var num=Anibody["static"].Random.GetNumber(min,max);var lim=Date.now();if(unit==="ms"||unit==="mil")lim-=num;if(unit==="s")lim-=num*1E3;if(unit==="min")lim-=num*1E3*60;if(unit==="h")lim-=num*1E3*60*60;if(unit==="d")lim-=num*1E3*60*60*24;if(unit==="w")lim-=num*1E3*60*60*24*7;if(unit==="y")lim-=num*1E3*60*60*24*365;return lim};
Anibody["static"].Random.DrawLot=function(lots,lotsChances){if(arguments.length<1)throw"ArgumentException: Too less arguments";if(isNaN(lots.length)||isNaN(lotsChances.length))throw"ArgumentException: Arguments need to be arrays";if(lots.length!==lotsChances.length)throw"ArgumentException: Arrays need to be the same size";var i;var getDecimals=function(num){var str=num.toString();var i=str.indexOf(".");if(i<0)return 0;str=str.substr(i+1);return str.length};var decimals=0;for(i=0;i<lotsChances.length;i++)decimals=
Math.max(decimals,getDecimals(lotsChances[i]));var chanceSum=0;for(i=0;i<lotsChances.length;i++)chanceSum+=lotsChances[i];var rnd=Random.GetNumber(0,chanceSum,decimals);var classmin=0;var classmax=0;for(i=0;i<lots.length;i++){classmax+=lotsChances[i];if(rnd>=classmin&&rnd<classmax)return lots[i];classmin=classmax}return lots[lots.length-1]};
Anibody["static"].Random.SetRandomInterval=function(cbo,min,max){if(typeof cbo==="undefined"||isNaN(min)||isNaN(max))return false;var obj={ref:0,clearInterval:function(){return window.clearTimeout(this.ref)}};var f=function(){Anibody.CallObject(cbo);var rnd_inner=Anibody["static"].Random.GetNumber(min,max);obj.ref=window.setTimeout(f,rnd_inner)};var rnd_outer=Anibody["static"].Random.GetNumber(min,max);obj.ref=window.setTimeout(f,rnd_outer);return obj};
Anibody["static"].createImageWithNN=function createImageWithNN(ctx,by,w,h){by=by>0?by:2;var imgData=ctx.getImageData(0,0,w,h);var canoff=document.createElement("CANVAS");canoff.width=w*by;canoff.height=h*by;var off=canoff.getContext("2d");var offImgData=off.getImageData(0,0,w*by,h*by);var i,r,g,b,a,j;var x,xx,y,yy;var newx,newy;var neww=w*by;for(x=0;x<w;++x)for(y=0;y<h;++y){i=(y*w+x)*4;r=imgData.data[i+0];g=imgData.data[i+1];b=imgData.data[i+2];a=imgData.data[i+3];for(xx=0;xx<by;xx++)for(yy=0;yy<
by;yy++){newx=x*by+xx;newy=y*by+yy;j=(newy*neww+newx)*4;offImgData.data[j+0]=r;offImgData.data[j+1]=g;offImgData.data[j+2]=b;offImgData.data[j+3]=a}}off.putImageData(offImgData,0,0);var url=canoff.toDataURL();var newimg=document.createElement("IMG");newimg.src=url;return newimg};
Anibody["static"].createImageNN=function createImageNN(can,by){by=by>0?parseInt(by):2;var ctx=can.getContext("2d");var w=can.width;var h=can.height;var imgData=ctx.getImageData(0,0,w,h);var canoff=document.createElement("CANVAS");canoff.width=w*by;canoff.height=h*by;var off=canoff.getContext("2d");var offImgData=off.getImageData(0,0,w*by,h*by);var i,r,g,b,a,j;var x,xx,y,yy;var newx,newy;var neww=w*by;for(x=0;x<w;++x)for(y=0;y<h;++y){i=(y*w+x)*4;r=imgData.data[i+0];g=imgData.data[i+1];b=imgData.data[i+
2];a=imgData.data[i+3];for(xx=0;xx<by;xx++)for(yy=0;yy<by;yy++){newx=x*by+xx;newy=y*by+yy;j=(newy*neww+newx)*4;offImgData.data[j+0]=r;offImgData.data[j+1]=g;offImgData.data[j+2]=b;offImgData.data[j+3]=a}}off.putImageData(offImgData,0,0);var url=canoff.toDataURL();var newimg=document.createElement("IMG");newimg.src=url;return newimg};
Anibody["static"].createImageWithFittedText=function createImageWithFittedText(width,height,texts,startfontheight,padding,rowspace,color,cfont){if(typeof texts==="string")texts=[texts];color=color||"black";var fontheight=startfontheight+1||25;cfont=cfont||"10px sans-serif";if(typeof padding==="undefined")padding=5;if(typeof rowspace==="undefined")rowspace=3;var off=document.createElement("CANVAS");off.width=width;off.height=height;var c=off.getContext("2d");c.font=cfont;c.setFontHeight(fontheight);
var allwords=[];var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var neededheight=height+1;while(neededheight>height){fontheight--;c.setFontHeight(fontheight);var spacelen=c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");
rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<width-2*padding){rows[rows.length-1]+=allwords[i]+" ";rowlengths[rows.length-1]+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-
1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);neededheight=2*padding+fontheight*rows.length+rowspace*rows.length-1}var maxw=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>maxw)maxw=rowlengths[i];var off=document.createElement("CANVAS");off.width=maxw+2*padding;off.height=neededheight;var c=off.getContext("2d");c.setFontHeight(fontheight);c.textAlign="left";c.textBaseline="top";c.fillStyle=color;var x=padding;var y=padding;for(var i=0;i<rows.length;i++){c.fillText(rows[i],x,y);y+=
fontheight+rowspace}var url=off.toDataURL();var img=document.createElement("IMG");img.src=url;return img};Anibody["static"].getClass=function getClass(obj){var con=obj.constructor.toString();var ifunc=con.indexOf("function ");var ibracket=con.indexOf("(");if(ifunc==0)con=con.substr(9,ibracket-9);return"CLASS::"+con};
Anibody["static"].getRGBA=function getRGBA(color,alpha,inc_quot){var rgbaCode;if(typeof color!=="string")return false;if(typeof alpha==="undefined"||alpha<0&&alpha>1)alpha=1;if(typeof inc_quot==="undefined"&&isNaN(inc_quot))inc_quot=0;var can=document.createElement("CANVAS");can.width=1;can.height=1;var c=can.getContext("2d");c.fillStyle=color;c.fillRect(0,0,1,1);var imageData=c.getImageData(0,0,1,1).data;imageData[0]+=255*inc_quot;if(imageData[0]>255)imageData[0]=255;if(imageData[0]<0)imageData[0]=
0;imageData[1]+=255*inc_quot;if(imageData[1]>255)imageData[1]=255;if(imageData[1]<0)imageData[1]=0;imageData[2]+=255*inc_quot;if(imageData[2]>255)imageData[2]=255;if(imageData[2]<0)imageData[2]=0;rgbaCode="rgba("+imageData[0]+","+imageData[1]+","+imageData[2]+","+alpha+")";return rgbaCode};
Anibody["static"].buttonLayout=function buttonLayout(box,depth,stops){var r=box.rounding;if(typeof r==="undefined")r=0;var w=box.width;var h=box.height;if(typeof stops==="undefined"||stops.length<=0)stops=[{stop:1,color:"black"}];var y=0;var tl={x:0,y:0,width:depth+r,height:depth+r};var top={x:depth+r,y:0,width:w-2*(depth+r),height:depth};var tr={x:top.x+top.width,y:0,width:depth+r,height:depth+r};var left={x:0,y:depth+r,width:depth,height:h-2*(depth+r)};var m={x:depth+r,y:top.y+top.height,width:w-
2*(depth+r),height:h-2*top.height};var right={x:w-depth,y:depth+r,width:depth,height:h-2*(depth+r)};var bl={x:0,y:h-depth-r,width:depth+r,height:depth+r};var bottom={x:depth+r,y:h-depth,width:w-2*(depth+r),height:depth};var br={x:bottom.x+bottom.width,y:h-depth-r,width:depth+r,height:depth+r};var ratio=top.height/tl.height;stops=stops.sort(function(a,b){if(a.stop>b.stop)return 1;else return-1});var can=document.createElement("CANVAS");can.width=w;can.height=h;var c=can.getContext("2d");var lcolor=
stops[stops.length-1].color;c.fillStyle=lcolor;c.fillRect(m.x,m.y,m.width,m.height);c.fillRect(left.x+left.width,left.y,depth,depth);c.fillRect(m.x+m.width,left.y,depth,depth);var ling=c.createLinearGradient(top.x,top.y,top.x,top.height);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(top.x,top.y,top.width,top.height);ling=c.createLinearGradient(bottom.x,bottom.y+bottom.height,bottom.x,bottom.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,
stops[i].color);c.fillStyle=ling;c.fillRect(bottom.x,bottom.y,bottom.width,bottom.height);ling=c.createLinearGradient(left.x,left.y,left.x+left.width,left.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(left.x,left.y,left.width,left.height);ling=c.createLinearGradient(right.x+right.width,right.y,right.x,right.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(right.x,right.y,right.width,
right.height);var radg=c.createRadialGradient(tl.x+tl.width,tl.y+tl.height,depth+r,tl.x+tl.width,tl.y+tl.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(tl.x+tl.width,tl.y+tl.height);c.lineTo(tl.x,tl.y+tl.height);c.arcTo(tl.x,tl.y,tl.x+tl.width,tl.y,tl.width);c.closePath();c.fill();var radg=c.createRadialGradient(tr.x,tr.y+tr.height,depth+r,tr.x,tr.y+tr.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*
ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(tr.x,tr.y+tr.height);c.lineTo(tr.x+tr.width,tr.y+tr.height);c.arcTo(tr.x+tr.width,tr.y,tr.x,tr.y,tr.width);c.closePath();c.fill();var radg=c.createRadialGradient(bl.x+bl.width,bl.y,depth+r,bl.x+bl.width,bl.y,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(bl.x+bl.width,bl.y);c.lineTo(bl.x,bl.y);c.arcTo(bl.x,bl.y+bl.height,bl.x+bl.width,bl.y+bl.height,bl.width);
c.closePath();c.fill();var radg=c.createRadialGradient(br.x,br.y,depth+r,br.x,br.y,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(br.x,br.y);c.lineTo(br.x+br.width,br.y);c.arcTo(br.x+br.width,br.y+br.height,br.x,br.y+br.height,br.width);c.closePath();c.fill();var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;return img};
Anibody["static"].forceRange=function forceRange(obj,attr,min,max){if(arguments.length<2)throw"No attribute defined as argument";if(isNaN(min))min=0;if(isNaN(max))max=100;if(obj[attr]<min)obj[attr]=min;if(obj[attr]>max)obj[attr]=max};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Alert=function Alert(text){Anibody.Widget.call(this);this.X=0;this.Y=0;this.Width;this.Height;this.ContentWidthQuotient=.6;this.Text=text;this.ImageText=false;this.Rows=[];this.RowLengths=[];this.Rounding=Alert.prototype.DefaultRounding;this.FontHeight=Alert.prototype.DefaultFontHeight;this.BoxPadding=Alert.prototype.DefaultBoxPadding;this.RowSpace=Alert.prototype.DefaultRowSpace;this.FontPadding=this.BoxPadding;this.ContentBox={};this.OkBox={x:0,y:0,width:60,height:40};this.IsMouseOverOk=
false;this.IsMouseOverContent=false;this.IsMouseOverBackground=false;this.Opacity=0;this._ref_mhan=null;this._cbo=false;this.Initialize()};Anibody.ui.Alert.prototype=Object.create(Anibody.Widget.prototype);Anibody.ui.Alert.prototype.constructor=Anibody.ui.Alert;Anibody.ui.Alert.prototype.ContentBoxColor="#999";Anibody.ui.Alert.prototype.BoxBorderColor="black";Anibody.ui.Alert.prototype.BoxColor="#ccc";Anibody.ui.Alert.prototype.BoxFontColor="#fff";Anibody.ui.Alert.prototype.OutsideColor="rgba(0,0,0,0.8)";
Anibody.ui.Alert.prototype.DefaultRounding=10;Anibody.ui.Alert.prototype.DefaultFontHeight=18;Anibody.ui.Alert.prototype.DefaultBoxPadding=5;Anibody.ui.Alert.prototype.DefaultRowSpace=4;Anibody.ui.Alert.prototype.Initialize=function(){this._createTextImage();this._recalculateSizes()};
Anibody.ui.Alert.prototype._createTextImage=function(){var off=document.createElement("CANVAS");off.width=this.Engine.Canvas.width*this.ContentWidthQuotient;off.height=300;var c=off.getContext("2d");c.font=this.Engine.Context.font;c.setFontHeight(this.FontHeight);var allwords=[];if(typeof this.Text==="string")var texts=[this.Text];else var texts=this.Text;var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var spacelen=
c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<off.width-2*this.FontPadding){rows[rows.length-1]+=allwords[i]+" ";rowlengths[rows.length-
1]+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);this.Rows=rows;this.RowLengths=rowlengths;var maxw=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>maxw)maxw=rowlengths[i];var box={x:this.BoxPadding,y:this.BoxPadding,width:maxw+2*this.BoxPadding,height:this.Rows.length*
this.FontHeight+(this.Rows.length-1)*this.RowSpace+2*this.FontPadding,type:"rect"};var off=document.createElement("CANVAS");off.width=box.width;off.height=box.height;var c=off.getContext("2d");c.setFontHeight(this.FontHeight);c.textAlign="left";c.textBaseline="top";for(var i=0;i<this.Rows.length;i++)c.fillText(this.Rows[i],box.x,box.y+this.FontHeight*i+this.RowSpace*i);this.ImageText=document.createElement("IMG");this.ImageText.width=off.width;this.ImageText.height=box.height;this.ImageText.src=off.toDataURL()};
Anibody.ui.Alert.prototype._recalculateSizes=function(){var margin=this.BoxPadding;var can=this.Engine.Canvas;this.Width=can.width;this.Height=can.height;this.ContentBox.width=this.ImageText.width;this.ContentBox.height=this.ImageText.height+this.OkBox.height+2*margin;this.ContentBox.x=can.width/2-this.ContentBox.width/2;this.ContentBox.y=can.height/2-this.ContentBox.height/2;this.OkBox.x=this.ContentBox.x+this.ContentBox.width/2-this.OkBox.width/2;this.OkBox.y=this.ContentBox.y+this.ContentBox.height-
this.OkBox.height-margin};
Anibody.ui.Alert.prototype.Draw=function(c){c.save();c.globalAlpha=this.Opacity;c.fillStyle=this.OutsideColor;c.fillRect(0,0,c.canvas.width,c.canvas.height);var box=this.ContentBox;c.beginPath();c.variousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.clip();c.fillStyle=this.ContentBoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,0);c.drawImage(this.ImageText,this.ContentBox.x,this.ContentBox.y);c.restore();c.save();var box=this.OkBox;c.setFontHeight(box.height*.5);
c.fillStyle=this.BoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding/3*2);c.fillStyle=this.BoxFontColor;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"OK",0);c.restore();c.save();c.strokeStyle=this.BoxBorderColor;c.lineWidth=5;var box=this.ContentBox;c.strokeVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.restore()};
Anibody.ui.Alert.prototype.ProcessInput=function(){var box=this.ContentBox;var area={"function":function(c){c.moveTo(0,0);c.lineTo(0,c.canvas.height);c.lineTo(c.canvas.width,c.canvas.height);c.lineTo(c.canvas.width,0);c.lineTo(0,0);c.rect(box.x,box.y,box.width,box.height)},type:"function"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverBackground");var area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverContent");box=this.OkBox;area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverOk")};Anibody.ui.Alert.prototype.Update=function(){this._recalculateSizes();if(this.IsMouseOverOk)this.Engine.Input.Mouse.Cursor.Set("pointer")};
Anibody.ui.Alert.prototype._createMouseHandlerObject=function(){var f=function(e){e.Handled=true;if(this.IsMouseOverOk)this.Stop();if(this.IsMouseOverBackground)this.Stop()};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.Alert.prototype.Start=function(cbo){this.Active=true;(new Anibody.util.Flow(this,"Opacity",1,600,{that:this,parameter:true,"function":function(p){}})).Start();this.Register();var mhand=this._createMouseHandlerObject();this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",mhand);this._cbo=cbo};
Anibody.ui.Alert.prototype.Stop=function(){this.Active=false;this.Deregister();this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);this._ref_mhan=null;Anibody.CallObject(this._cbo)};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Button=function Button(x,y,options){Anibody.ABO.call(this);this.Options=options;this.Type="Button";this.X=x||0;this.Y=y||0;this.Width=Anibody.ui.Button.DefaultButtonTemplate.Width;this.Height=Anibody.ui.Button.DefaultButtonTemplate.Height;this._inflated;this.HoverText=Anibody.ui.Button.DefaultButtonTemplate.HoverText;this.HoverImage=false;this.HoverPadding=Anibody.ui.Button.DefaultButtonTemplate.HoverPadding;this.FramesUntilHover=Anibody.ui.Button.DefaultButtonTemplate.FramesUntilHover;
this.HoverPosition={x:0,y:0};this.HoverFontHeight=Anibody.ui.Button.DefaultButtonTemplate.HoverFontHeight;this.HoverFontColor=Anibody.ui.Button.DefaultButtonTemplate.HoverFontColor;this.HoverBackgroundColor=Anibody.ui.Button.DefaultButtonTemplate.HoverBackgroundColor;this.HoverShadeColor=Anibody.ui.Button.DefaultButtonTemplate.HoverShadeColor;this.HoverRowSpace=Anibody.ui.Button.DefaultButtonTemplate.HoverRowSpace;this.OldState=-1;this.State=0;this.CoolDown=Anibody.ui.Button.DefaultButtonTemplate.CoolDown;
this.OnTimeButton=Anibody.ui.Button.DefaultButtonTemplate.OnTimeButton;this.TriggerCallbackObject={that:this,"function":function(){},parameter:false};this.IsMouseOver=false;this._mouseOverFrames=0;this._labelWidth=[0,0,0];this._textStart=[0,0,0];this.Label=[Anibody.ui.Button.DefaultButtonTemplate.Label[0],Anibody.ui.Button.DefaultButtonTemplate.Label[1],Anibody.ui.Button.DefaultButtonTemplate.Label[2]];this.FontHeight=[Anibody.ui.Button.DefaultButtonTemplate.FontHeight[0],Anibody.ui.Button.DefaultButtonTemplate.FontHeight[1],
Anibody.ui.Button.DefaultButtonTemplate.FontHeight[2]];this.FontType=[Anibody.ui.Button.DefaultButtonTemplate.FontType[0],Anibody.ui.Button.DefaultButtonTemplate.FontType[1],Anibody.ui.Button.DefaultButtonTemplate.FontType[2]];this.DisplayType=[Anibody.ui.Button.DefaultButtonTemplate.DisplayType[0],Anibody.ui.Button.DefaultButtonTemplate.DisplayType[1],Anibody.ui.Button.DefaultButtonTemplate.DisplayType[2]];this.Rounding=Anibody.ui.Button.DefaultButtonTemplate.Rounding;this.ColorCode=[Anibody.ui.Button.DefaultButtonTemplate.ColorCode[0],
Anibody.ui.Button.DefaultButtonTemplate.ColorCode[1],Anibody.ui.Button.DefaultButtonTemplate.ColorCode[2]];this.Codename=[Anibody.ui.Button.DefaultButtonTemplate.Codename[0],Anibody.ui.Button.DefaultButtonTemplate.Codename[1],Anibody.ui.Button.DefaultButtonTemplate.Codename[2]];this.Padding=Anibody.ui.Button.DefaultButtonTemplate.Padding;this.TextAlign=Anibody.ui.Button.DefaultButtonTemplate.TextAlign;this.SpriteLoaded=false;this.Images=[];this.ButtonLayout=null;this.CSSMouseCursor=[Anibody.ui.Button.DefaultButtonTemplate.CSSMouseCursor[0],
Anibody.ui.Button.DefaultButtonTemplate.CSSMouseCursor[1],Anibody.ui.Button.DefaultButtonTemplate.CSSMouseCursor[2]];this.FontColor=[];this.FontColor[0]=Anibody.ui.Button.DefaultButtonTemplate.FontColor[0];this.FontColor[1]=Anibody.ui.Button.DefaultButtonTemplate.FontColor[1];this.FontColor[2]=Anibody.ui.Button.DefaultButtonTemplate.FontColor[2];this.Active=true;this.ActivationFunctionObject={"function":function(p){return this.Active},that:this,parameter:{}};this._ref=null;this._ref_reghov=null;this._counter=
0;this._counterBorderColor=Anibody.ui.Button.DefaultButtonTemplate.CounterBorderColor;this._counterBackgroundColor=Anibody.ui.Button.DefaultButtonTemplate.CounterBackgroundColor;this._counterFontColor=Anibody.ui.Button.DefaultButtonTemplate.CounterFontColor;this._urgency=false;this._urgencyBorderColor=Anibody.ui.Button.DefaultButtonTemplate.UrgencyBorderColor;this._urgencyBackgroundColor=Anibody.ui.Button.DefaultButtonTemplate.UrgencyBackgroundColor;this._urgencyFontColor=Anibody.ui.Button.DefaultButtonTemplate.UrgencyFontColor;
this.Initialize()};Anibody.ui.Button.prototype=Object.create(Anibody.ABO.prototype);Anibody.ui.Button.prototype.constructor=Anibody.ui.Button;
Anibody.ui.Button._defaultButtonTemplate={Width:200,Height:60,CoolDown:50,OnTimeButton:false,Label:["","",""],CSSMouseCursor:["pointer","default","wait"],FontHeight:[14,14,14],FontType:["sans-serif","sans-serif","sans-serif"],DisplayType:["color","color","color"],Codename:[false,false,false],Padding:3,TextAlign:"center",Rounding:4,HoverText:"",FramesUntilHover:25,HoverRowSpace:3,HoverPadding:4,HoverFontHeight:14,FontColor:["black","black","black"],HoverBackgroundColor:"#eee",HoverFontColor:"black",
ColorCode:["#cfcfcf","#bdbdbd","#666"],HoverShadeColor:"rgba(0,0,0,0.2)",CounterBorderColor:["red","red","red"],CounterBackgroundColor:["white","white","white"],CounterFontColor:["red","red","red"],UrgencyBorderColor:["white","white","white"],UrgencyBackgroundColor:["red","red","red"],UrgencyFontColor:["white","white","white"]};Anibody.ui.Button.DefaultButtonTemplate=null;
Anibody.ui.Button.prototype.Initialize=function(){Anibody.ui.Button._processOptions(this,this.Options);if(this.X==="center"){var c=this.Engine.Canvas;this.X=(c.width-this.Width)/2}this._inflated={width:this.Width,height:this.Height};this.HoverPosition={x:this.X+this.Width+5,y:this.Y-5};if(this.TriggerCallbackObject)this.AddMouseHandler(5);this.Center={X:this.X+this.Width/2,Y:this.Y+this.Height/2};this.GetLabelWidth(0);if(this.DisplayType[0]==="image"||this.DisplayType[0]==="both")this.Images[0]=this.Engine.MediaManager.GetImage(this.Codename[0]);
if(this.DisplayType[1]==="image"||this.DisplayType[1]==="both")this.Images[1]=this.Engine.MediaManager.GetImage(this.Codename[1]);if(this.DisplayType[2]==="image"||this.DisplayType[2]==="both")this.Images[2]=this.Engine.MediaManager.GetImage(this.Codename[2]);this.SetPadding(this.Padding);if(this.HoverText.length>0)this.SetHoverText(this.HoverText)};
Anibody.ui.Button.prototype.AddMouseHandler=function(prior,name){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.Active&&this.IsMouseOver){e.Handled=true;this.Trigger()}}},prior,name)};Anibody.ui.Button.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref)};
Anibody.ui.Button.prototype._registerHoverImageDrawing=function(){if(this._ref_reghov!=null)return;var f=function(c){if(this.IsMouseOver&&this._mouseOverFrames>=this.FramesUntilHover)if(this.HoverImage){this._findHoverPosition();c.drawImage(this.HoverImage,this.HoverPosition.x,this.HoverPosition.y)}};var fo={that:this,"function":f,parameter:this.Engine.Context};this._ref_reghov=this.Engine.AddForegroundDrawFunctionObject(fo)};
Anibody.ui.Button.prototype._deregisterHoverImageDrawing=function(){if(this._ref_reghov==null)return;this.Engine.RemoveForegroundDrawFunctionObject(this._ref_reghov);this._ref_reghov=null};Anibody.ui.Button.prototype.ProcessInput=function(){var area=this.GetArea(0,this.Rounding);this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver")};
Anibody.ui.Button.prototype.Update=function(){var afo=this.ActivationFunctionObject;this.Active=afo["function"].call(afo.that,afo.parameter);if(!this.Active){this._mouseOverFrames=0;return}if(this.HoverImage)this._registerHoverImageDrawing();var m=this.Engine.Input.Mouse;if(this.IsMouseOver)this._mouseOverFrames++;else this._mouseOverFrames=0;if(m.Left.Down&&this.IsMouseOver&&this.State==0)this.State=1;if(m.Left.Up&&this.State==1)this.State=0;if(this.IsMouseOver)switch(this.State){case 0:this.Engine.Input.Mouse.Cursor.Set(this.CSSMouseCursor[this.State]);
break;case 1:this.Engine.Input.Mouse.Cursor.Set(this.CSSMouseCursor[this.State]);break;case 2:this.Engine.Input.Mouse.Cursor.Set(this.CSSMouseCursor[this.State]);break}if(this.State!=this.OldState)this.GetLabelWidth();this.OldState=this.State};
Anibody.ui.Button.prototype.Draw=function(c){c.save();var cam=this.Engine.Camera.SelectedCamera;if(this.Active)c.globalAlpha=1;else c.globalAlpha=.5;if(this.DisplayType[this.State]=="color"||this.DisplayType[this.State]=="both"){c.fillStyle=this.ColorCode[this.State];c.fillVariousRoundedRect(this.X-cam.X,this.Y-cam.Y,this.Width,this.Height,this.Rounding)}if(this.DisplayType[this.State]=="image"||this.DisplayType[this.State]=="both")if(this.Images[this.State])c.drawRoundedImage(this.Images[this.State],
this.X-cam.X,this.Y-cam.Y,this.Width,this.Height,this.Rounding);if(this.IsMouseOver&&this.Active){c.fillStyle=this.HoverShadeColor;c.fillVariousRoundedRect(this.X-cam.X,this.Y-cam.Y,this.Width,this.Height,this.Rounding)}if(this.ButtonLayout)c.drawRoundedImage(this.ButtonLayout,this.X-cam.X,this.Y-cam.Y,this.Width,this.Height,this.Rounding);c.textBaseline="middle";c.textAlign="left";c.font=this.FontHeight[this.State]+"px "+this.FontType[this.State];var txtx;var txty;if(this.TextAlign==="center"||this.TextAlign===
"middle"){txtx=this.X+this.Width/2-this._labelWidth[this.State]/2-cam.X;txty=this.Y+this.Height/2-cam.Y}if(this.TextAlign==="left"){txtx=this.X+this.Padding-cam.X;txty=this.Y+this.Height/2-cam.Y}c.fillStyle=this.FontColor[this.State];c.fillText(this.Label[this.State],txtx,txty);if(this._counter>0&&!this._urgency){var cr=this.Height*.15;var cx=this.X+this.Width-(cr+this.Height*.05);var cy=this.Y+this.Height-(cr+this.Height*.05);var ratio=1.5;if(this._counter>9)ratio=1.1;c.fillStyle=this._counterBackgroundColor[this.State];
c.fillCircle(cx,cy,cr,true);c.lineWidth=2;c.strokeStyle=this._counterBorderColor[this.State];c.strokeCircle(cx,cy,cr,true);c.fillStyle=this._counterFontColor[this.State];c.setFontHeight(cr*ratio);c.font="bold "+c.font;c.fillSpinnedText(cx,cy,this._counter.toString())}if(this._urgency){var cr=this.Height*.15;var cx=this.X+this.Width-(cr+this.Height*.05);var cy=this.Y+this.Height-(cr+this.Height*.05);var ratio=1.5;c.fillStyle=this._urgencyBackgroundColor[this.State];c.fillCircle(cx,cy,cr,true);c.lineWidth=
2;c.strokeStyle=this._urgencyBorderColor[this.State];c.strokeCircle(cx,cy,cr,true);c.fillStyle=this._urgencyFontColor[this.State];c.setFontHeight(cr*ratio);c.font="bold "+c.font;c.fillSpinnedText(cx,cy,"!")}c.restore()};Anibody.ui.Button.prototype.Set=function(attr,val,val2,val3){if(arguments.length<3)val2=val;if(arguments.length<4)val3=val;this[attr]=[];this[attr][0]=val;this[attr][1]=val2;this[attr][2]=val3;return this[attr]};Anibody.ui.Button.prototype.SetCoolDown=function(cd){this.CoolDown=cd};
Anibody.ui.Button.prototype.Trigger=function(extern){var tco;if(extern)this.State=1;if(this.State==1&&this.TriggerCallbackObject){this._mouseOverFrames=0;tco=this.TriggerCallbackObject;tco.that=tco.that==="self"||typeof tco.that==="undefined"?this:tco.that;tco["function"].call(tco.that,tco.parameter,this);this.IsMouseOver=false;this.State=2;if(!this.OnTimeButton&&this.CoolDown>=0)setTimeout(function(){arguments[0].State=0},this.CoolDown,this)}};
Anibody.ui.Button.prototype.GetLabelWidth=function(state){state=arguments.length<=0?this.State:state;var c=this.Engine.Context;c.save();c.textBaseline="middle";c.font=this.FontHeight[state]+"px "+this.FontType[state];this._labelWidth[state]=c.measureText(this.Label[state]).width;c.restore()};Anibody.ui.Button.prototype.SetTriggerCallbackObject=function(tco,prior,name){if(this._ref!=null)this.RemoveMouseHandler();prior=prior||5;this.TriggerCallbackObject=tco;this.AddMouseHandler(prior,name)};
Anibody.ui.Button.prototype.SetActiveFunctionObject=function(afo){if(afo.that==="self")afo.that=this;this.ActivationFunctionObject=afo};
Anibody.ui.Button.prototype.SetImagesThroughSprite=function(codename,vertical){if(arguments.length<=1)vertical=true;var x=0;var y=0;var width=this.Width;var height=this.Height;var img=this.Engine.MediaManager.GetImage(codename);var url;if(!img)return;this.Images=[];var can=document.createElement("CANVAS");can.width=width;can.height=height;var con=can.getContext("2d");for(var i=0;i<3;i++){con.clearRect(0,0,width,height);con.drawImage(img,x,y,width,height,0,0,width,height);url=can.toDataURL();this.Images.push(document.createElement("IMG"));
this.Images[i].src=url;if(vertical)y+=height;else x+=width}this.DisplayType=["image","image","image"];this.SpriteLoaded=true};
Anibody.ui.Button.prototype.SetPadding=function(padding,widthcorrection){if(arguments.length<=0)padding=0;if(arguments.length<=1)widthcorrection=false;this._labelWidth=[0,0,0];this._textStart=[0,0,0];var c=this.Engine.Context;c.save();var max=0;var tmp;for(var i=0;i<3;i++){c.setFontHeight(this.FontHeight[i]);this._labelWidth[i]=c.measureText(this.Label[i]).width;tmp=2*this.Padding+this._labelWidth[i];if(max<tmp)max=tmp}if(widthcorrection)this.Width=max};
Anibody.ui.Button.prototype.LoadImage=function(codename,state){if(typeof codename==="undefined")return false;if(typeof state!=="undefined")this.Images[state]=this.Engine.MediaManager.GetImage(codename);else{this.Images[0]=this.Engine.MediaManager.GetImage(codename);this.Images[1]=this.Engine.MediaManager.GetImage(codename);this.Images[2]=this.Engine.MediaManager.GetImage(codename)}};
Anibody.ui.Button.prototype.AddTextAsImage=function(texts,startfh){var box={x:0,y:0,width:this.Width,height:this.Height};if(typeof texts==="string")texts=[texts];var c=this.Engine.Context;var padding=5;var rowspace=3;var width=box.width;var allwords=[];var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var neededheight=box.height+1;var fontheight=startfh+1||25;while(neededheight>box.height&&
fontheight>0){fontheight--;c.setFontHeight(fontheight);var spacelen=c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var templen=0;rows.push("");for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}else if(templen+alllengths[i]+spacelen<width-2*padding){rows[rows.length-1]+=allwords[i]+" ";templen+=
alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);neededheight=2*padding+fontheight*rows.length+rowspace*rows.length-1}var vpadding=padding+(box.height-neededheight)/2;var off=document.createElement("CANVAS");off.width=box.width;off.height=box.height;var coff=off.getContext("2d");coff.setFontHeight(fontheight);
coff.textAlign="left";coff.textBaseline="top";coff.fillStyle=this.FontColor[0];coff.strokeStyle="white";var x=padding;var y=vpadding;for(var i=0;i<rows.length;i++){coff.fillText(rows[i],x,y);y+=fontheight+rowspace}var url=off.toDataURL();var img=document.createElement("IMG");img.src=url;if(this.DisplayType[0]==="color")this.DisplayType[0]="both";if(this.DisplayType[1]==="color")this.DisplayType[1]="both";if(this.DisplayType[2]==="color")this.DisplayType[2]="both";this.Label=[" "," "," "];this.Images=
[img,img,img]};Anibody.ui.Button.prototype.SetHoverText=function(texts){if(typeof texts==="string")texts=[texts];this.HoverText=texts;this._createHoverImage()};
Anibody.ui.Button.prototype._createHoverImage=function(fh){var texts=this.HoverText;var color=this.HoverFontColor;var fontheight=fh||this.HoverFontHeight;var allwords=[];var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var width=this.Engine.Canvas.width/3;var padding=this.HoverPadding||4;var rowspace=this.HoverRowSpace||3;var c=this.Engine.Context;c.save();c.setFontHeight(fontheight);var spacelen=
c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<width-2*padding){rows[rows.length-1]+=allwords[i]+" ";rowlengths[rows.length-
1]+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);var max=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>max)max=rowlengths[i];width=Math.ceil(max+2*padding);var height=2*padding+fontheight*rows.length+rowspace*rows.length-1;var off=document.createElement("CANVAS");
off.width=width;off.height=height;c.restore();var c=off.getContext("2d");c.setFontHeight(fontheight);c.strokeStyle="black";c.fillStyle=this.HoverBackgroundColor;c.fillRect(0,0,width,height);c.strokeRect(0,0,width,height);c.textAlign="left";c.textBaseline="top";c.fillStyle=color;var x=padding;var y=padding;for(var i=0;i<rows.length;i++){c.fillText(rows[i],x,y);y+=fontheight+rowspace}var url=off.toDataURL();var img=document.createElement("IMG");img.src=url;this.HoverImage=img};
Anibody.ui.Button.prototype._findHoverPosition=function(){var can=this.Engine.Canvas;var center={x:can.width/2,y:can.height/2};var p1,p2,p3,p4;p1={x:this.X,y:this.Y};p2={x:this.X+this.Width,y:this.Y};p3={x:this.X+this.Width,y:this.Y+this.Height};p4={x:this.X,y:this.Y+this.Height};var cpx=(p1.x+p2.x+p3.x+p4.x)/4;var cpy=(p1.y+p2.y+p3.y+p4.y)/4;cpx-=center.x;cpy-=center.y;var img=this.HoverImage;var off=5;if(cpx>0&&cpy>0){this.HoverPosition.x=p1.x-img.width-off;this.HoverPosition.y=p1.y-img.height-
off}if(cpx>0&&cpy<0){this.HoverPosition.x=p4.x-img.width-off;this.HoverPosition.y=p4.y+off}if(cpx<=0&&cpy>=0){this.HoverPosition.x=p2.x+off;this.HoverPosition.y=p2.y-img.height-off}if(cpx<=0&&cpy<=0){this.HoverPosition.x=p3.x+off;this.HoverPosition.y=p3.y+off}};Anibody.ui.Button.prototype.SetHoverFramesLimit=function(nof){this.HoverFramesLimit=nof};Anibody.ui.Button.prototype.Inflate=function(){this.Width=this._inflated.width;this.Height=this._inflated.height};
Anibody.ui.Button.prototype.Deflate=function(){this._inflated.width=this.Width;this._inflated.height=this.Height;this.Width=0;this.Height=0};
Anibody.ui.Button.prototype.AddInnerButtonLayout=function(depth,stops){var r=this.Rounding;if(typeof r==="undefined")r=0;var w=this.Width;var h=this.Height;if(typeof depth==="undefined")depth=Math.round(h/4);if(typeof stops==="undefined"||stops.length<=0)stops=[{stop:0,color:"rgba(0,0,0,0.5)"},{stop:.5,color:"rgba(0,0,0,0.25)"},{stop:1,color:"rgba(0,0,0,0)"}];var y=0;var tl={x:0,y:0,width:depth+r,height:depth+r};var top={x:depth+r,y:0,width:w-2*(depth+r),height:depth};var tr={x:top.x+top.width,y:0,
width:depth+r,height:depth+r};var left={x:0,y:depth+r,width:depth,height:h-2*(depth+r)};var m={x:depth+r,y:top.y+top.height,width:w-2*(depth+r),height:h-2*top.height};var right={x:w-depth,y:depth+r,width:depth,height:h-2*(depth+r)};var bl={x:0,y:h-depth-r,width:depth+r,height:depth+r};var bottom={x:depth+r,y:h-depth,width:w-2*(depth+r),height:depth};var br={x:bottom.x+bottom.width,y:h-depth-r,width:depth+r,height:depth+r};var ratio=top.height/tl.height;stops=stops.sort(function(a,b){if(a.stop>b.stop)return 1;
else return-1});var can=document.createElement("CANVAS");can.width=w;can.height=h;var c=can.getContext("2d");var lcolor=stops[stops.length-1].color;c.fillStyle=lcolor;c.fillRect(m.x,m.y,m.width,m.height);c.fillRect(left.x+left.width,left.y,depth,depth);c.fillRect(m.x+m.width,left.y,depth,depth);var ling=c.createLinearGradient(top.x,top.y,top.x,top.height);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(top.x,top.y,top.width,top.height);ling=
c.createLinearGradient(bottom.x,bottom.y+bottom.height,bottom.x,bottom.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(bottom.x,bottom.y,bottom.width,bottom.height);ling=c.createLinearGradient(left.x,left.y,left.x+left.width,left.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(left.x,left.y,left.width,left.height);ling=c.createLinearGradient(right.x+right.width,right.y,right.x,
right.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(right.x,right.y,right.width,right.height);var radg=c.createRadialGradient(tl.x+tl.width,tl.y+tl.height,depth+r,tl.x+tl.width,tl.y+tl.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(tl.x+tl.width,tl.y+tl.height);c.lineTo(tl.x,tl.y+tl.height);c.arcTo(tl.x,tl.y,tl.x+tl.width,tl.y,tl.width);c.closePath();
c.fill();var radg=c.createRadialGradient(tr.x,tr.y+tr.height,depth+r,tr.x,tr.y+tr.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(tr.x,tr.y+tr.height);c.lineTo(tr.x+tr.width,tr.y+tr.height);c.arcTo(tr.x+tr.width,tr.y,tr.x,tr.y,tr.width);c.closePath();c.fill();var radg=c.createRadialGradient(bl.x+bl.width,bl.y,depth+r,bl.x+bl.width,bl.y,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);
c.fillStyle=radg;c.beginPath();c.moveTo(bl.x+bl.width,bl.y);c.lineTo(bl.x,bl.y);c.arcTo(bl.x,bl.y+bl.height,bl.x+bl.width,bl.y+bl.height,bl.width);c.closePath();c.fill();var radg=c.createRadialGradient(br.x,br.y,depth+r,br.x,br.y,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);c.fillStyle=radg;c.beginPath();c.moveTo(br.x,br.y);c.lineTo(br.x+br.width,br.y);c.arcTo(br.x+br.width,br.y+br.height,br.x,br.y+br.height,br.width);c.closePath();c.fill();var url=can.toDataURL();
var img=document.createElement("IMG");img.src=url;this.ButtonLayout=img};
Anibody.ui.Button.prototype.AddButtonEffectOnlyLightning=function(depth,stops){if(isNaN(depth))depth=Math.floor(this.Height/8);if(typeof stops==="undefined"||stops.length<=0)stops=[{stop:0,color:"rgba(255,255,255,0.5)"},{stop:.5,color:"rgba(255,255,255,0.25)"},{stop:1,color:"rgba(255,255,255,0)"}];stops=stops.sort(function(a,b){if(a.stop>b.stop)return 1;else return-1});var w=this.Width;var h=this.Height;var r=this.Rounding;var tl={x:0,y:0,width:depth+r,height:depth+r};var top={x:depth+r,y:0,width:w-
(depth+r),height:depth};var left={x:0,y:depth+r,width:depth,height:h-(depth+r)};var ratio=top.height/tl.height;var can=document.createElement("CANVAS");can.width=w;can.height=h;var c=can.getContext("2d");var ling=c.createLinearGradient(top.x,top.y,top.x,top.height);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(top.x,top.y,top.width,top.height);ling=c.createLinearGradient(left.x,left.y,left.x+left.width,left.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,
stops[i].color);c.fillStyle=ling;c.fillRect(left.x,left.y,left.width,left.height);var radg=c.createRadialGradient(tl.x+tl.width,tl.y+tl.height,depth+r,tl.x+tl.width,tl.y+tl.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);radg.addColorStop(stops[stops.length-1].stop,stops[stops.length-1].color);c.fillStyle=radg;c.fillRect(tl.x,tl.y,tl.width,tl.height);var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;this.ButtonLayout=img};
Anibody.ui.Button.prototype.AddButtonEffect=function(depth,stops){if(isNaN(depth))depth=Math.floor(this.Height/8);if(typeof stops==="undefined"||stops.length<=0)stops=[{stop:0,color:"rgba(255,255,255,0.5)"},{stop:.5,color:"rgba(255,255,255,0.25)"},{stop:1,color:"rgba(255,255,255,0)"}];stops=stops.sort(function(a,b){if(a.stop>b.stop)return 1;else return-1});var stops_b=[{stop:0,color:"rgba(0,0,0,0.5)"},{stop:.5,color:"rgba(0,0,0,0.25)"},{stop:1,color:"rgba(0,0,0,0)"}];stops_b=stops_b.sort(function(a,
b){if(a.stop>b.stop)return 1;else return-1});var w=this.Width;var h=this.Height;var r=this.Rounding;var tl={x:0,y:0,width:depth+r,height:depth+r};var top={x:depth+r,y:0,width:w-(depth+r),height:depth};var left={x:0,y:depth+r,width:depth,height:h-(depth+r)};var bottom={x:0,y:h-depth,width:w-(depth+r),height:depth};var right={x:w-depth,y:0,width:depth,height:h-(depth+r)};var br={x:bottom.x+bottom.width,y:h-depth-r,width:depth+r,height:depth+r};var ratio=top.height/tl.height;var can=document.createElement("CANVAS");
can.width=w;can.height=h;var c=can.getContext("2d");var ling=c.createLinearGradient(top.x,top.y,top.x,top.height);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(top.x,top.y,top.width,top.height);ling=c.createLinearGradient(left.x,left.y,left.x+left.width,left.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(left.x,left.y,left.width,left.height);var radg=c.createRadialGradient(tl.x+
tl.width,tl.y+tl.height,depth+r,tl.x+tl.width,tl.y+tl.height,0);for(var i=0;i<stops.length;i++)radg.addColorStop(stops[i].stop*ratio,stops[i].color);radg.addColorStop(stops[stops.length-1].stop,stops[stops.length-1].color);c.fillStyle=radg;c.fillRect(tl.x,tl.y,tl.width,tl.height);c.fillStyle="black";ling=c.createLinearGradient(right.x+right.width,right.y,right.x,right.y);for(var i=0;i<stops_b.length;i++)ling.addColorStop(stops_b[i].stop,stops_b[i].color);c.fillStyle=ling;c.fillRect(right.x,right.y,
right.width,right.height);ling=c.createLinearGradient(bottom.x,bottom.y+bottom.height,bottom.x,bottom.y);for(var i=0;i<stops_b.length;i++)ling.addColorStop(stops_b[i].stop,stops_b[i].color);c.fillStyle=ling;c.fillRect(bottom.x,bottom.y,bottom.width,bottom.height);var radg=c.createRadialGradient(br.x,br.y,depth+r,br.x,br.y,0);for(var i=0;i<stops_b.length;i++)radg.addColorStop(stops_b[i].stop*ratio,stops_b[i].color);radg.addColorStop(stops_b[stops_b.length-1].stop,stops_b[stops_b.length-1].color);c.fillStyle=
radg;c.fillRect(br.x,br.y,br.width,br.height);var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;this.ButtonLayout=img};Anibody.ui.Button.prototype.SetCounter=function(c){if(!isNaN(c)||c>=0)this._counter=c};Anibody.ui.Button.prototype.GetCounter=function(){return this._counter};Anibody.ui.Button.prototype.IncreaseCounter=function(){this._counter++};Anibody.ui.Button.prototype.DecreaseCounter=function(){if(this._counter)this._counter--};
Anibody.ui.Button.prototype.SetUrgency=function(ur){if(typeof ur==="undefined")this._urgency=false;else this._urgency=ur};Anibody.ui.Button.prototype.Circlize=function(){var min=Math.min(this.Width,this.Height);this.Rounding=min/2};Anibody.ui.Button.prototype.ResetTemplate=function(){Anibody.ui.Button.ResetTemplate()};
Anibody.ui.Button._processOptions=function(target,actor,aggressive){if(typeof aggressive==="undefined")aggressive=false;for(var attr in actor)if(aggressive||typeof target[attr]!=="undefined")if(aggressive||target[attr].push)if(actor[attr].push)target[attr]=actor[attr];else target[attr]=[actor[attr],actor[attr],actor[attr]];else target[attr]=actor[attr]};Anibody.ui.Button.prototype.SetTemplateByObject=function(obj){Anibody.ui.Button._processOptions(Anibody.ui.Button.DefaultButtonTemplate,obj)};
Anibody.ui.Button.SetTemplateByObject=function(obj){Anibody.ui.Button._processOptions(Anibody.ui.Button.DefaultButtonTemplate,obj)};
Anibody.ui.Button.ResetTemplate=function(){Anibody.ui.Button.DefaultButtonTemplate={};var d=Anibody.ui.Button.DefaultButtonTemplate;d.Height=Anibody.ui.Button._defaultButtonTemplate.Height;d.Width=Anibody.ui.Button._defaultButtonTemplate.Width;d.CoolDown=Anibody.ui.Button._defaultButtonTemplate.CoolDown;d.Label=[Anibody.ui.Button._defaultButtonTemplate.Label[0],Anibody.ui.Button._defaultButtonTemplate.Label[1],Anibody.ui.Button._defaultButtonTemplate.Label[2]];d.CSSMouseCursor=[Anibody.ui.Button._defaultButtonTemplate.CSSMouseCursor[0],
Anibody.ui.Button._defaultButtonTemplate.CSSMouseCursor[1],Anibody.ui.Button._defaultButtonTemplate.CSSMouseCursor[2]];d.FontHeight=[Anibody.ui.Button._defaultButtonTemplate.FontHeight[0],Anibody.ui.Button._defaultButtonTemplate.FontHeight[1],Anibody.ui.Button._defaultButtonTemplate.FontHeight[2]];d.FontType=[Anibody.ui.Button._defaultButtonTemplate.FontType[0],Anibody.ui.Button._defaultButtonTemplate.FontType[1],Anibody.ui.Button._defaultButtonTemplate.FontType[2]];d.DisplayType=[Anibody.ui.Button._defaultButtonTemplate.DisplayType[0],
Anibody.ui.Button._defaultButtonTemplate.DisplayType[1],Anibody.ui.Button._defaultButtonTemplate.DisplayType[2]];d.Codename=[Anibody.ui.Button._defaultButtonTemplate.Codename[0],Anibody.ui.Button._defaultButtonTemplate.Codename[1],Anibody.ui.Button._defaultButtonTemplate.Codename[2]];d.Rounding=Anibody.ui.Button._defaultButtonTemplate.Rounding;d.Padding=Anibody.ui.Button._defaultButtonTemplate.Padding;d.TextAlign=Anibody.ui.Button._defaultButtonTemplate.TextAlign;d.FramesUntilHover=Anibody.ui.Button._defaultButtonTemplate.FramesUntilHover;
d.HoverRowSpace=Anibody.ui.Button._defaultButtonTemplate.HoverRowSpace;d.HoverPadding=Anibody.ui.Button._defaultButtonTemplate.HoverPadding;d.HoverFontHeight=Anibody.ui.Button._defaultButtonTemplate.HoverFontHeight;d.FontColor=[Anibody.ui.Button._defaultButtonTemplate.FontColor[0],Anibody.ui.Button._defaultButtonTemplate.FontColor[1],Anibody.ui.Button._defaultButtonTemplate.FontColor[2]];d.HoverBackgroundColor=Anibody.ui.Button._defaultButtonTemplate.HoverBackgroundColor;d.HoverFontColor=Anibody.ui.Button._defaultButtonTemplate.HoverFontColor;
d.HoverText=Anibody.ui.Button._defaultButtonTemplate.HoverText;d.ColorCode=[Anibody.ui.Button._defaultButtonTemplate.ColorCode[0],Anibody.ui.Button._defaultButtonTemplate.ColorCode[1],Anibody.ui.Button._defaultButtonTemplate.ColorCode[2]];d.HoverShadeColor=Anibody.ui.Button._defaultButtonTemplate.HoverShadeColor;d.CounterBorderColor=[Anibody.ui.Button._defaultButtonTemplate.CounterBorderColor[0],Anibody.ui.Button._defaultButtonTemplate.CounterBorderColor[1],Anibody.ui.Button._defaultButtonTemplate.CounterBorderColor[2]];
d.CounterBackgroundColor=[Anibody.ui.Button._defaultButtonTemplate.CounterBackgroundColor[0],Anibody.ui.Button._defaultButtonTemplate.CounterBackgroundColor[1],Anibody.ui.Button._defaultButtonTemplate.CounterBackgroundColor[2]];d.CounterFontColor=[Anibody.ui.Button._defaultButtonTemplate.CounterFontColor[0],Anibody.ui.Button._defaultButtonTemplate.CounterFontColor[1],Anibody.ui.Button._defaultButtonTemplate.CounterFontColor[2]];d.UrgencyBorderColor=[Anibody.ui.Button._defaultButtonTemplate.UrgencyBorderColor[0],
Anibody.ui.Button._defaultButtonTemplate.UrgencyBorderColor[1],Anibody.ui.Button._defaultButtonTemplate.UrgencyBorderColor[2]];d.UrgencyBackgroundColor=[Anibody.ui.Button._defaultButtonTemplate.UrgencyBackgroundColor[0],Anibody.ui.Button._defaultButtonTemplate.UrgencyBackgroundColor[1],Anibody.ui.Button._defaultButtonTemplate.UrgencyBackgroundColor[2]];d.UrgencyFontColor=[Anibody.ui.Button._defaultButtonTemplate.UrgencyFontColor[0],Anibody.ui.Button._defaultButtonTemplate.UrgencyFontColor[1],Anibody.ui.Button._defaultButtonTemplate.UrgencyFontColor[2]]};
Anibody.ui.Button.GetTemplate=function(){return Anibody.ui.Button.DefaultButtonTemplate};Anibody.ui.Button.SetTemplateAttribute=function(attr,val){if(typeof Anibody.ui.Button.DefaultButtonTemplate[attr]!=="undefined"){Anibody.ui.Button.DefaultButtonTemplate[attr]=val;return true}else return false};Anibody.ui.Button.ResetTemplate();Anibody.SetPackage("Anibody","ui");
Anibody.ui.ColorPicker=function ColorPicker(x,y,width,cpcbo){Anibody.Widget.call(this);this.ColorPickedCallbackObject=cpcbo;this.X=x;this.Y=y;this.Width=width;this.Height=width;this.BasicColor="black";this.PickedColor="black";this.IsMouseOverPicker=false;this.IsMouseOverBox=false;this.IsMouseOverStrip=false;this.IsMouseOverPreview=false;this.Padding=10;this.Box={x:x+this.Padding,y:y+this.Padding,width:this.Height*.7,height:this.Height*.7-this.Padding};this.Strip={x:this.Box.x+this.Box.width+this.Padding,
y:y+this.Padding,width:width-this.Box.width-3*this.Padding,height:this.Height-2*this.Padding};this.Preview={x:x+this.Padding,y:y+this.Padding+this.Height*.7,width:this.Box.width,height:this.Height*.3-this.Padding*2};this.StripGradient=false;this.WhiteGradient=false;this.BlackGradient=false;this.Opacity=0;this._ref;this.Initialize()};Anibody.ui.ColorPicker.prototype=Object.create(Anibody.Widget.prototype);Anibody.ui.ColorPicker.prototype.constructor=Anibody.ui.ColorPicker;
Anibody.ui.ColorPicker.prototype.Initialize=function(){var c=this.Engine.Context;this.StripGradient=c.createLinearGradient(this.Strip.x,this.Strip.y,this.Strip.x,this.Strip.y+this.Strip.height-1);this.StripGradient.addColorStop(0,"rgba(255, 0, 0, 1)");this.StripGradient.addColorStop(.17,"rgba(255, 255, 0, 1)");this.StripGradient.addColorStop(.34,"rgba(0, 255, 0, 1)");this.StripGradient.addColorStop(.51,"rgba(0, 255, 255, 1)");this.StripGradient.addColorStop(.68,"rgba(0, 0, 255, 1)");this.StripGradient.addColorStop(.85,
"rgba(255, 0, 255, 1)");this.StripGradient.addColorStop(1,"rgba(255, 0, 0, 1)");this.WhiteGradient=c.createLinearGradient(this.Box.x+1,this.Box.y,this.Box.x+this.Box.width-2,this.Box.y);this.WhiteGradient.addColorStop(0,"rgba(255,255,255,1)");this.WhiteGradient.addColorStop(1,"rgba(255,255,255,0)");this.BlackGradient=c.createLinearGradient(this.Box.x,this.Box.y+1,this.Box.x,this.Box.y+this.Box.height-2);this.BlackGradient.addColorStop(0,"rgba(0,0,0,0)");this.BlackGradient.addColorStop(1,"rgba(0,0,0,1)")};
Anibody.ui.ColorPicker.prototype.Draw=function(c,noborder){if(this.Opacity==0)return;c.save();if(typeof noborder==="undefined")noborder=false;c.strokeRect(this.X,this.Y,this.Width,this.Height);c.fillStyle="#999";c.fillRect(this.X,this.Y,this.Width,this.Height);c.fillStyle=this.BasicColor;c.fillRect(this.Box.x,this.Box.y,this.Box.width,this.Box.height);c.fillStyle=this.WhiteGradient;c.fillRect(this.Box.x,this.Box.y,this.Box.width,this.Box.height);c.fillStyle=this.BlackGradient;c.fillRect(this.Box.x,
this.Box.y,this.Box.width,this.Box.height);if(!noborder){c.strokeStyle="black";c.strokeRect(this.Box.x,this.Box.y,this.Box.width,this.Box.height)}c.fillStyle=this.StripGradient;c.fillRect(this.Strip.x,this.Strip.y,this.Strip.width,this.Strip.height);if(!noborder){c.strokeStyle="black";c.strokeRect(this.Strip.x,this.Strip.y,this.Strip.width,this.Strip.height)}var pr=this.Preview;c.fillStyle=this.PickedColor;c.fillRect(pr.x,pr.y,pr.width,pr.height);c.font="bold "+pr.height*2/3+"px sans-serif";c.fillStyle=
"white";c.fillSpinnedText(pr.x+pr.width/2,pr.y+pr.height/2,"OK",0);c.strokeStyle="black";c.lineWidth=pr.height/25;c.strokeSpinnedText(pr.x+pr.width/2,pr.y+pr.height/2,"OK",0);c.strokeStyle="black";c.lineWidth=1;c.strokeRect(pr.x,pr.y,pr.width,pr.height);c.restore()};
Anibody.ui.ColorPicker.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(!this.IsMouseOverPicker)this.Hide();var mpos=this.Engine.Input.Mouse.Position.Relative;var x,y;x=mpos.X;y=mpos.Y;if(this.IsMouseOverStrip){e.Handled=true;this.ClickOnStrip(x,y)}if(this.IsMouseOverBox){e.Handled=true;this.ClickOnBox(x,y)}if(this.IsMouseOverPreview){e.Handled=true;this.ClickOnPreview()}}},1001)};
Anibody.ui.ColorPicker.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref)};Anibody.ui.ColorPicker.prototype.Update=function(){if(this.Opacity==0)return;if(this.IsMouseOverBox||this.IsMouseOverStrip)this.Engine.Input.Mouse.Cursor.Set("crosshair");if(this.IsMouseOverPreview)this.Engine.Input.Mouse.Cursor.Set("pointer")};
Anibody.ui.ColorPicker.prototype.ProcessInput=function(){if(this.Opacity==0)return;var area=this.GetArea();area.background=true;this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverPicker");area={x:this.Preview.x,y:this.Preview.y,width:this.Preview.width,height:this.Preview.height,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverPreview");area={x:this.Box.x+1,y:this.Box.y+1,width:this.Box.width-2,height:this.Box.height-2,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverBox");area={x:this.Strip.x+1,y:this.Strip.y+1,width:this.Strip.width-2,height:this.Strip.height-2,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverStrip")};Anibody.ui.ColorPicker.prototype.Show=function(){this.Register();(new Anibody.util.Flow(this,"Opacity",1,1E3,{that:this,"function":function(){this.AddMouseHandler()}})).Start()};Anibody.ui.ColorPicker.prototype.Hide=function(){this.Opacity=0;this.RemoveMouseHandler();this.Deregister()};
Anibody.ui.ColorPicker.prototype.ClickOnStrip=function(x,y){var c=this.Engine.Context;this.Draw(c,true);var imageData=c.getImageData(x,y,1,1).data;var rgbCode="rgb("+imageData[0]+","+imageData[1]+","+imageData[2]+")";this.PickedColor=rgbCode;this.BasicColor=rgbCode};Anibody.ui.ColorPicker.prototype.ClickOnBox=function(x,y){var c=this.Engine.Context;this.Draw(c,true);var imageData=c.getImageData(x,y,1,1).data;var rgbCode="rgb("+imageData[0]+","+imageData[1]+","+imageData[2]+")";this.PickedColor=rgbCode};
Anibody.ui.ColorPicker.prototype.ClickOnPreview=function(){var cb=this.ColorPickedCallbackObject;this.Hide();if(cb)cb["function"].call(cb.that,this.PickedColor,cb.parameter)};Anibody.ui.ColorPicker.prototype.SetColorPickedCallbackObject=function(cbo){this.ColorPickedCallbackObject=cbo};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Confirm=function Confirm(text,cbo){Anibody.ABO.call(this);this.ContentWidthQuotient=.6;this.Text=text;this.ImageText=false;this.Rows=[];this.RowLengths=[];this.ConfirmCallback=cbo;this.Rounding=Anibody.ui.Confirm.prototype.DefaultRounding;this.FontHeight=Anibody.ui.Confirm.prototype.DefaultFontHeight;this.BoxPadding=Anibody.ui.Confirm.prototype.DefaultBoxPadding;this.RowSpace=Anibody.ui.Confirm.prototype.DefaultRowSpace;this.FontPadding=this.BoxPadding;this.ContentBox={};this.YesBox={x:0,
y:0,width:60,height:40};this.NoBox={x:0,y:0,width:60,height:40};this.IsMouseOverYes=false;this.IsMouseOverNo=false;this.IsMouseOverContent=false;this.IsMouseOverBackground=false;this.Opacity=0;this._ref_ip=null;this._ref_draw=null;this._ref_upd=null;this._ref_mhan=null;this.Initialize()};Anibody.ui.Confirm.prototype=Object.create(Anibody.ABO.prototype);Anibody.ui.Confirm.prototype.constructor=Anibody.ui.Confirm;Anibody.ui.Confirm.prototype.ContentBoxColor="#999";
Anibody.ui.Confirm.prototype.BoxBorderColor="black";Anibody.ui.Confirm.prototype.BoxColor="#ccc";Anibody.ui.Confirm.prototype.BoxFontColor="#fff";Anibody.ui.Confirm.prototype.OutsideColor="rgba(0,0,0,0.8)";Anibody.ui.Confirm.prototype.DefaultRounding=10;Anibody.ui.Confirm.prototype.DefaultFontHeight=18;Anibody.ui.Confirm.prototype.DefaultBoxPadding=5;Anibody.ui.Confirm.prototype.DefaultRowSpace=4;Anibody.ui.Confirm.prototype.Initialize=function(){this._createTextImage();this._recalculateSizes()};
Anibody.ui.Confirm.prototype._createTextImage=function(){var off=document.createElement("CANVAS");off.width=this.Engine.Canvas.width*this.ContentWidthQuotient;off.height=300;var c=off.getContext("2d");c.font=this.Engine.Context.font;c.setFontHeight(this.FontHeight);var allwords=[];if(typeof this.Text==="string")var texts=[this.Text];else var texts=this.Text;var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var spacelen=
c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<off.width-2*this.FontPadding){rows[rows.length-1]+=allwords[i]+" ";rowlengths[rows.length-
1]+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);this.Rows=rows;this.RowLengths=rowlengths;var maxw=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>maxw)maxw=rowlengths[i];var box={x:this.BoxPadding,y:this.BoxPadding,width:maxw+2*this.BoxPadding,height:this.Rows.length*
this.FontHeight+(this.Rows.length-1)*this.RowSpace+2*this.FontPadding,type:"rect"};var off=document.createElement("CANVAS");off.width=box.width;off.height=box.height;var c=off.getContext("2d");c.setFontHeight(this.FontHeight);c.textAlign="left";c.textBaseline="top";for(var i=0;i<this.Rows.length;i++)c.fillText(this.Rows[i],box.x,box.y+this.FontHeight*i+this.RowSpace*i);this.ImageText=document.createElement("IMG");this.ImageText.width=off.width;this.ImageText.height=box.height;this.ImageText.src=off.toDataURL()};
Anibody.ui.Confirm.prototype._recalculateSizes=function(){var margin=this.BoxPadding;var can=this.Engine.Canvas;this.Width=can.width;this.Height=can.height;this.ContentBox.width=this.ImageText.width;this.ContentBox.height=this.ImageText.height+this.YesBox.height+2*margin;this.ContentBox.x=can.width/2-this.ContentBox.width/2;this.ContentBox.y=can.height/2-this.ContentBox.height/2;this.YesBox.x=this.ContentBox.x+this.ContentBox.width/3-this.YesBox.width/2;this.YesBox.y=this.ContentBox.y+this.ContentBox.height-
this.YesBox.height-margin;this.NoBox.x=this.ContentBox.x+this.ContentBox.width*2/3-this.NoBox.width/2;this.NoBox.y=this.ContentBox.y+this.ContentBox.height-this.NoBox.height-margin};
Anibody.ui.Confirm.prototype._createForegroundDrawFunctionObject=function(){var f=function(c){c.save();c.globalAlpha=this.Opacity;c.fillStyle=this.OutsideColor;c.fillRect(0,0,c.canvas.width,c.canvas.height);var box=this.ContentBox;c.beginPath();c.variousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.clip();c.fillStyle=this.ContentBoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,0);c.drawImage(this.ImageText,this.ContentBox.x,this.ContentBox.y);c.restore();c.save();
var box=this.YesBox;c.setFontHeight(box.height*.5);c.fillStyle=this.BoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding/3*2);c.fillStyle=this.BoxFontColor;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"Ja",0);var box=this.NoBox;c.fillStyle=this.BoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding/3*2);c.fillStyle=this.BoxFontColor;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"Nein",0);c.restore();c.save();c.strokeStyle=this.BoxBorderColor;
c.lineWidth=5;var box=this.ContentBox;c.strokeVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.restore()};return{that:this,"function":f,parameter:this.Engine.Context}};
Anibody.ui.Confirm.prototype._createProcessInputFunctionObject=function(){var f=function(en){var box=this.ContentBox;var area={"function":function(c){c.moveTo(0,0);c.lineTo(0,c.canvas.height);c.lineTo(c.canvas.width,c.canvas.height);c.lineTo(c.canvas.width,0);c.lineTo(0,0);c.rect(box.x,box.y,box.width,box.height)},type:"function"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverBackground");var area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverContent");box=this.YesBox;area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverYes");box=this.NoBox;area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverNo")};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.Confirm.prototype._createUpdateFunctionObject=function(){var f=function(en){this._recalculateSizes();if(this.IsMouseOverYes||this.IsMouseOverNo)this.Engine.Input.Mouse.Cursor.Set("pointer")};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.Confirm.prototype._createMouseHandlerObject=function(){var f=function(e){e.Handled=true;if(this.IsMouseOverYes){this.Stop();Anibody.CallObject(this.ConfirmCallback)}if(this.IsMouseOverBackground||this.IsMouseOverNo)this.Stop()};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.Confirm.prototype.Start=function(){this.Active=true;(new Anibody.util.Flow(this,"Opacity",1,600,{that:this,parameter:true,"function":function(p){}})).Start();var ipfo=this._createProcessInputFunctionObject();this._ref_ip=this.Engine.AddProcessInputFunctionObject(ipfo);var fdfo=this._createForegroundDrawFunctionObject();this._ref_draw=this.Engine.AddForegroundDrawFunctionObject(fdfo);var upd=this._createUpdateFunctionObject();this._ref_upd=this.Engine.AddUpdateFunctionObject(upd);var mhand=
this._createMouseHandlerObject();this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",mhand)};
Anibody.ui.Confirm.prototype.Stop=function(){this.Active=false;this.Engine.RemoveForegroundDrawFunctionObject(this._ref_draw);this._ref_draw=null;this.Engine.RemoveUpdateFunctionObject(this._ref_upd);this._ref_upd=null;this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);this._ref_mhan=null;this.Engine.RemoveProcessInputFunctionObject(this._ref_ip);this._ref_ip=null};Anibody.SetPackage("Anibody","ui");
Anibody.ui.InputField=function InputField(x,y,width,height,padding){Anibody.ABO.call(this);this.Active=true;this.X=x;this.Y=y;this.Width=width;this.VariableWidth=false;this.Height=typeof height!=="undefined"&&height?height:20;this.padding=typeof padding!=="undefined"&&padding?padding:2;this.Selected=false;this.FontHeight=this.Height-2*this.padding;this.Font=this.FontHeight+"px sans-serif";this.BindKey="";this.Bound=false;this.Text="";this.MarkedText="";this.CharLimiter=function(char){return true};
this.LimitationFailCallbackObject={that:this,"function":function(char,para){return},parameter:{}};this.shading=Math.ceil(this.padding/2);this.IsMouseOver=false;this.State=0;this.OldState=-1;this.FillStyle=[Anibody.ui.InputField.prototype.DefaultUnselectedColor,Anibody.ui.InputField.prototype.DefaultSelectedColor];this.CSSMouseCursor=["text","default","wait"];this.CursorPos=this.Text.length;this.CursorPosChanged=true;this.CursorWidth=0;this.CursorVisible=true;this.off=0;this.step=parseInt(this.Width/
20);this.cmin=2*this.step;this.cmax=this.Width-2*this.step;this.AlternativeActive=false;this._ref_keyd=null;this._ref_mhan=null;this.Initialize()};Anibody.ui.InputField.prototype=Object.create(Anibody.ABO.prototype);Anibody.ui.InputField.prototype.constructor=Anibody.ui.InputField;Anibody.ui.InputField.prototype.DefaultUnselectedColor="#eee";Anibody.ui.InputField.prototype.DefaultSelectedColor="#fff";
Anibody.ui.InputField.prototype.Initialize=function(){var ms=800;var changef=function(that){that.CursorVisible=!that.CursorVisible};window.setInterval(changef,ms,this);var onkeydownfunc=function(e){var that=e.data.object;if(that.Selected){if(e.key)that.AddLetter(e.key);else that.AddLetter(String.getKeyByEvent(e));if(e.which==8){e.preventDefault();e.stopPropagation();return false}}};$(document).on("keydown",{object:this},onkeydownfunc);if(window.top!=window.self)this.ParentKeyDownEvent=$(window.parent.document).on("keydown",
{object:this},onkeydownfunc)};
Anibody.ui.InputField.prototype.Update=function(){var m=this.Engine.Input.Mouse;var k=this.Engine.Input.Keys;if(m.Left.FramesUp==1&&this.IsMouseOver){this.Selected=true;if(this.Engine.IsTouchDevice){var text=window.prompt("Your input:",this.Text);this.Text=text;this.Selected=false}}if(k.Esc.FramesPressed==1)this.Selected=false;if(this.Selected&&k.Left.FramesPressed==1||this.Selected&&k.Left.FramesPressed>10&&k.Left.FramesPressed%3==0)if(this.CursorPos>0){this.CursorPos--;this.CursorPosChanged=true}if(this.Selected&&
k.Right.FramesPressed==1||this.Selected&&k.Right.FramesPressed>10&&k.Right.FramesPressed%3==0)if(this.CursorPos<this.Text.length){this.CursorPos++;this.CursorPosChanged=true}if(this.IsMouseOver&&this.Selected&&m.Left.FramesDown==1)this.ChangeCursorPosAccordingTo(m.Position);if(k.Backspace.FramesPressed==1||k.Backspace.FramesPressed>10&&k.Backspace.FramesPressed%3==0)this.RemoveLetter();if(this.IsMouseOver)this.Engine.Input.Mouse.Cursor.Set(this.CSSMouseCursor[this.State]);if(this.Selected)this._checkText()};
Anibody.ui.InputField.prototype.ProcessInput=function(){this.Engine.Input.MouseHandler.AddHoverRequest(this.GetArea(0,0),this,"IsMouseOver")};
Anibody.ui.InputField.prototype.Draw=function(c){c.save();var cam=this.Engine.Camera.SelectedCamera;c.fillStyle=this.Selected?this.FillStyle[1]:this.FillStyle[0];c.beginPath();c.rect(this.X-cam.X,this.Y-cam.Y,this.Width,this.Height);c.fill();c.closePath();c.clip();c.globalCompositeOperation="source-atop";c.textBaseline="middle";c.font=this.Font;var txtx=this.X+this.padding-cam.X-this.off;var txty=this.Y+this.Height/2-cam.Y;c.fillStyle="black";c.fillText(this.Text,txtx,txty);c.globalCompositeOperation=
"source-over";c.beginPath();c.moveTo(this.X-cam.X,this.Y+this.Height-cam.Y);c.lineTo(this.X-cam.X,this.Y-cam.Y);c.lineTo(this.X+this.Width-cam.X,this.Y-cam.Y);c.strokeStyle=this.shading+"px grey";c.stroke();c.closePath();if(this.Selected&&this.CursorVisible){this.CursorWidth=c.measureText(this.Text.substr(0,this.CursorPos)).width;c.beginPath();c.moveTo(txtx+this.CursorWidth,this.Y+this.padding-cam.Y);c.lineTo(txtx+this.CursorWidth,this.Y+this.padding+this.FontHeight-cam.Y);c.strokeStyle="black";c.stroke();
c.closePath()}c.restore()};Anibody.ui.InputField.prototype.BindToStorageEntry=function(key){if(typeof key==="string"&&key.length>0){var txt=this.Engine.Storage.ReadFromStorage(key);if(txt.code)txt=this.Engine.Storage.WriteToStorage(key,"");this.Bound=true;this.BindKey=key;this.Text=txt}};
Anibody.ui.InputField.prototype.ChangeCursorPosAccordingTo=function(mpos){this.CursorPosChanged=true;var tpos=mpos.Camera;if(this.Text.length<=0){this.CursorPos=0;return}var clickx=tpos.X-(this.X+this.padding);var c=document.createElement("CANVAS").getContext("2d");c.font=this.Font;var textWidth=c.measureText(this.Text).width-this.off;if(clickx>=textWidth){this.CursorPos=this.Text.length;return}var width=0-this.off;var i=0;while(width<clickx&&i<this.Text.length){i++;width=c.measureText(this.Text.substr(0,
i)).width-this.off}this.CursorPos=i;if(this.CursorPos>0)this.MarkedText=this.Text.substr(this.CursorPos-1,1);else this.MarkedText="n/a"};Anibody.ui.InputField.prototype.SetCursorPosToEnd=function(){this.CursorPosChanged=true;this.CursorPos=this.Text.length};
Anibody.ui.InputField.prototype.AddLetter=function(add){if(!add||add.length>1)return;if(!this.CharLimiter(add)){var lfc=this.LimitationFailCallbackObject;lfc["function"].call(lfc.that,add,lfc.parameter);return}this.Text=this.Text.substr(0,this.CursorPos)+add+this.Text.substr(++this.CursorPos-1);if(this.Bound)this.Engine.Storage.WriteToStorage(this.BindKey,this.Text)};
Anibody.ui.InputField.prototype.RemoveLetter=function(){if(this.Text.length>0){var a,b;if(this.CursorPos>0)a=this.Text.substr(0,this.CursorPos-1);else a="";b=this.Text.substr(this.CursorPos);this.Text=a+b;if(this.CursorPos>0)this.CursorPos--}if(this.Bound)this.Engine.Storage.WriteToStorage(this.BindKey,this.Text)};
Anibody.ui.InputField.prototype._checkText=function(){if(this.CursorWidth-this.off>=this.cmax)this.off+=this.step;if(this.CursorWidth-this.off<=this.cmin)this.off-=this.step;if(this.off<0)this.off=0};Anibody.ui.InputField.prototype.AddCharLimiter=function(lim,limFailCbo){if(typeof lim==="function")this.CharLimiter=lim;if(typeof limFailCbo!=="undefined")this.LimitationFailCallbackObject=limFailCbo};Anibody.SetPackage("Anibody","ui");
Anibody.ui.MultipleChoice=function MultipleChoice(text,labels,cbos){Anibody.Widget.call(this);this.X=0;this.Y=0;this.Width;this.Height;this.ContentWidthQuotient=.7;this.Text=text;this.ImageText=false;this.Rows=[];this.RowLengths=[];this.CallbackObjects=[];for(var i=0;i<cbos.length;i++)this.CallbackObjects[i]={that:this,parameter:cbos[i],"function":function(cbo){Anibody.CallObject(cbo);this.Stop()}};this.Labels=labels;this.MustDecide=true;this.OnIllegalStopCBO=function(){var txt="Sie m{ue}ssen eine Entscheidung treffen!".decodeURI();
(new Anibody.ui.Toaster("error","Fehler",txt,4E3)).Open()}.getCallbackObject(this);this.Rounding=Anibody.ui.MultipleChoice.prototype.DefaultRounding;this.FontHeight=Anibody.ui.MultipleChoice.prototype.DefaultFontHeight;this.BoxPadding=Anibody.ui.MultipleChoice.prototype.DefaultBoxPadding;this.RowSpace=Anibody.ui.MultipleChoice.prototype.DefaultRowSpace;this.FontPadding=this.BoxPadding;this.ContentBox={};this.Buttons=[];this.IsMouseOverContent=false;this.IsMouseOverBackground=false;this.Opacity=0;
this._ref_mhan=null;this.Initialize()};Anibody.ui.MultipleChoice.prototype=Object.create(Anibody.Widget.prototype);Anibody.ui.MultipleChoice.prototype.constructor=Anibody.ui.MultipleChoice;Anibody.ui.MultipleChoice.prototype.ContentBoxColor="#999";Anibody.ui.MultipleChoice.prototype.BoxBorderColor="black";Anibody.ui.MultipleChoice.prototype.BoxColor="#ccc";Anibody.ui.MultipleChoice.prototype.BoxFontColor="#fff";Anibody.ui.MultipleChoice.prototype.OutsideColor="rgba(0,0,0,0.8)";
Anibody.ui.MultipleChoice.prototype.DefaultRounding=10;Anibody.ui.MultipleChoice.prototype.DefaultFontHeight=18;Anibody.ui.MultipleChoice.prototype.DefaultBoxPadding=5;Anibody.ui.MultipleChoice.prototype.DefaultRowSpace=4;Anibody.ui.MultipleChoice.prototype.Initialize=function(){this._createTextImage();this._initSizes();this._recalculateSizes()};
Anibody.ui.MultipleChoice.prototype._createTextImage=function(){var off=document.createElement("CANVAS");off.width=this.Engine.Canvas.width*this.ContentWidthQuotient;off.height=300;var c=off.getContext("2d");c.font=this.Engine.Context.font;c.setFontHeight(this.FontHeight);var allwords=[];if(typeof this.Text==="string")var texts=[this.Text];else var texts=this.Text;var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-
1)allwords.push("\\n")}var spacelen=c.measureText(" ").width;var alllengths=[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<off.width-2*this.FontPadding){rows[rows.length-
1]+=allwords[i]+" ";rowlengths[rows.length-1]+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);this.Rows=rows;this.RowLengths=rowlengths;var maxw=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>maxw)maxw=rowlengths[i];var box={x:this.BoxPadding,y:this.BoxPadding,
width:maxw+2*this.BoxPadding,height:this.Rows.length*this.FontHeight+(this.Rows.length-1)*this.RowSpace+2*this.FontPadding,type:"rect"};var off=document.createElement("CANVAS");off.width=box.width;off.height=box.height;var c=off.getContext("2d");c.setFontHeight(this.FontHeight);c.textAlign="left";c.textBaseline="top";for(var i=0;i<this.Rows.length;i++)c.fillText(this.Rows[i],box.x,box.y+this.FontHeight*i+this.RowSpace*i);this.ImageText=document.createElement("IMG");this.ImageText.width=off.width;
this.ImageText.height=box.height;this.ImageText.src=off.toDataURL()};
Anibody.ui.MultipleChoice.prototype._initSizes=function(){var margin=this.BoxPadding;var can=this.Engine.Canvas;var c=this.Engine.Context;this.Width=can.width;this.Height=can.height;var boxh=this.FontHeight*2;var fh=this.FontHeight;this.ContentBox.width=this.ImageText.width;this.ContentBox.height=this.ImageText.height+this.Labels.length*boxh+(this.Labels.length-1)*this.RowSpace+2*margin;c.save();c.setFontHeight(fh);var txtw;var bpad;for(var i=0;i<this.Labels.length;i++){txtw=c.measureText(this.Labels[i]).width;
bpad=(this.ContentBox.width-txtw)/2;this.Buttons[i]=new Anibody.ui.Button(margin,margin+this.ImageText.height+i*boxh+i*this.RowSpace,{Width:this.ContentBox.width-2*margin,Height:boxh,DisplayType:"color",TextColor:"white",FontHeight:fh,Label:this.Labels[i],Padding:bpad,TriggerCallbackObject:this.CallbackObjects[i],HoverText:this.Labels[i]})}c.restore()};
Anibody.ui.MultipleChoice.prototype._recalculateSizes=function(){var margin=this.BoxPadding;var can=this.Engine.Canvas;this.Width=can.width;this.Height=can.height;var boxh=this.FontHeight*2;this.ContentBox.width=this.ImageText.width;this.ContentBox.height=this.ImageText.height+this.Labels.length*boxh+(this.Labels.length-1)*this.RowSpace+2*margin;this.ContentBox.x=this.Width/2-this.ContentBox.width/2;this.ContentBox.y=this.Height/2-this.ContentBox.height/2;for(var i=0;i<this.Labels.length;i++){this.Buttons[i].X=
this.ContentBox.x+margin;this.Buttons[i].Y=this.ContentBox.y+margin+this.ImageText.height+i*boxh+i*this.RowSpace}};
Anibody.ui.MultipleChoice.prototype.Draw=function(c){c.save();c.globalAlpha=this.Opacity;c.fillStyle=this.OutsideColor;c.fillRect(0,0,c.canvas.width,c.canvas.height);var box=this.ContentBox;c.beginPath();c.variousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.clip();c.fillStyle=this.ContentBoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,0);c.drawImage(this.ImageText,this.ContentBox.x,this.ContentBox.y);c.restore();for(var i=0;i<this.Buttons.length;i++)this.Buttons[i].Draw(c);
c.save();c.strokeStyle=this.BoxBorderColor;c.lineWidth=5;var box=this.ContentBox;c.strokeVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.restore()};
Anibody.ui.MultipleChoice.prototype.ProcessInput=function(){var box=this.ContentBox;var area={"function":function(c){c.moveTo(0,0);c.lineTo(0,c.canvas.height);c.lineTo(c.canvas.width,c.canvas.height);c.lineTo(c.canvas.width,0);c.lineTo(0,0);c.rect(box.x,box.y,box.width,box.height)},type:"function"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverBackground");var area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverContent");for(var i=0;i<this.Buttons.length;i++)this.Buttons[i].ProcessInput()};Anibody.ui.MultipleChoice.prototype.Update=function(){this._recalculateSizes();for(var i=0;i<this.Buttons.length;i++)this.Buttons[i].Update()};Anibody.ui.MultipleChoice.prototype._createMouseHandlerObject=function(){var f=function(e){if(this.IsMouseOverBackground){if(this.MustDecide)this.IllegalStop();else this.Stop();e.Handled=true}};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.MultipleChoice.prototype.Start=function(){this.Active=true;(new Anibody.util.Flow(this,"Opacity",1,600,{that:this,parameter:true,"function":function(p){}})).Start();this.Register();var mhand=this._createMouseHandlerObject();this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",mhand)};Anibody.ui.MultipleChoice.prototype.Stop=function(){this.Active=false;this.Deregister();this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);this._ref_mhan=null};
Anibody.ui.MultipleChoice.prototype.IllegalStop=function(){Anibody.CallObject(this.OnIllegalStopCBO)};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Prompt=function Prompt(m,cbo,numpad){Anibody.Widget.call(this);if(typeof numpad==="undefined")numpad=false;this._numPad=numpad;this.Message=m||"Input:";this.CallbackObject=cbo||{that:this,parameter:{},"function":function(input,p){console.log("Prompt: "+input)}};this.Input="";var can=this.Engine.Canvas;this.X=0;this.Y=0;this.Width=can.width;this.Height=can.height;this.Opacity=1;this.FontHeight=16;this.FontPadding=4;this.RowSpace=3;this.Rows=[this.Message];this.RowLengths=[];this.BoxPadding=
10;this.InputField=false;this.BackgroundColor=Anibody.ui.Prompt.prototype.DefaultBackgroundColor;this.BorderColor=Anibody.ui.Prompt.prototype.DefaultBorderColor;this.FontColor=Anibody.ui.Prompt.prototype.DefaultFontColor;this.ButtonColor=Anibody.ui.Prompt.prototype.DefaultButtonColor;this.ButtonFontColor=Anibody.ui.Prompt.prototype.DefaultButtonFontColor;this.OutsideColor=Anibody.ui.Prompt.prototype.DefaultOutsideColor;this.Box={x:this.Width/4,y:this.Height/3,width:this.Width/2,height:this.Height/
3,rounding:8,type:"rrect"};this.MessageBox={x:this.Box.x+this.BoxPadding,y:this.Box.y+this.BoxPadding,width:this.Box.width-2*this.BoxPadding,height:this.Rows.length*this.FontHeight+(this.Rows.length-1)*this.RowSpace+2*this.FontPadding,type:"rect"};this.InputBox={height:this.FontHeight+2*this.FontPadding};this.NumButtonWidth=40;this.NumButtonHeight=40;this.NumFontHeight=this.NumButtonWidth<this.NumButtonHeight?this.NumButtonWidth:this.NumButtonHeight;this.NumFontHeight*=.8;this.NumPad={height:this.NumButtonHeight*
4+3*this.RowSpace};this.Numbers=[];this.Delete={};this.ButtonBox={height:30+2*this.BoxPadding};this.OKButton={};this.CancelButton={};this.IsMouseOverBox=false;this.IsMouseOverInputBox=false;this.IsMouseOverOK=false;this.IsMouseOverCancel=false;this.IsMouseOverBackground=false;this.IsMouseOverNumber=[false,false,false,false,false,false,false,false,false,false];this._ref_mhan=null;this.Initialize()};Anibody.ui.Prompt.prototype=Object.create(Anibody.Widget.prototype);
Anibody.ui.Prompt.prototype.constructor=Anibody.ui.Prompt;Anibody.ui.Prompt.prototype.DefaultBackgroundColor="#ccc";Anibody.ui.Prompt.prototype.DefaultBorderColor="#000";Anibody.ui.Prompt.prototype.DefaultFontColor="#222";Anibody.ui.Prompt.prototype.DefaultButtonColor="#aaa";Anibody.ui.Prompt.prototype.DefaultButtonFontColor="#111";Anibody.ui.Prompt.prototype.DefaultOutsideColor="rgba(0,0,0,0.6)";
Anibody.ui.Prompt.prototype.Initialize=function(){this._calculateRows();this._recalculateBoxValues();if(this._numPad)this.DeleteImage=this._getDeleteImage(this.NumButtonWidth,this.NumButtonHeight);this.InputField=new Anibody.ui.InputField(this.InputBox.x,this.InputBox.y,this.InputBox.width,this.InputBox.height)};
Anibody.ui.Prompt.prototype._calculateRows=function(){var off=document.createElement("CANVAS");off.width=this.MessageBox.width;off.height=this.MessageBox.height;var c=off.getContext("2d");c.font=this.Engine.Context.font;c.setFontHeight(this.FontHeight);var allwords=[];var texts=[this.Message];var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++)allwords.push(temp[j]);if(i<texts.length-1)allwords.push("\\n")}var spacelen=c.measureText(" ").width;var alllengths=
[];for(var i=0;i<allwords.length;i++)if(allwords[i]!=="\\n")alllengths.push(c.measureText(allwords[i]).width);else alllengths.push(0);var rows=[];var rowlengths=[];rows.push("");rowlengths.push(0);for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");rowlengths.push(0+alllengths[i]+spacelen)}else if(rowlengths[rows.length-1]+alllengths[i]+spacelen<this.MessageBox.width-2*this.FontPadding){rows[rows.length-1]+=allwords[i]+" ";rowlengths[rows.length-1]+=alllengths[i]+
spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rowlengths[rows.length-1]-=spacelen;rows.push(allwords[i]+" ");rowlengths.push(alllengths[i]+spacelen)}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);this.Rows=rows;this.RowLengths=rowlengths;var maxw=0;for(var i=0;i<rows.length;i++)if(rowlengths[i]>maxw)maxw=rowlengths[i];this.Box={x:0,y:0,width:maxw+2*this.BoxPadding,height:-1,rounding:8,type:"rrect"};this.MessageBox={x:this.BoxPadding,
y:this.BoxPadding,width:this.Box.width-2*this.BoxPadding,height:this.Rows.length*this.FontHeight+(this.Rows.length-1)*this.RowSpace+2*this.FontPadding,type:"rect"}};
Anibody.ui.Prompt.prototype._recalculateBoxValues=function(){this.InputBox={x:this.MessageBox.x,y:this.MessageBox.y+this.MessageBox.height+this.BoxPadding,width:this.MessageBox.width,height:this.FontHeight+2*this.FontPadding,type:"rect"};this.NumPad={x:this.InputBox.x,y:this.InputBox.y+this.BoxPadding,width:this.MessageBox.width,height:0,type:"rect"};if(this._numPad){this.NumPad={x:this.InputBox.x,y:this.InputBox.y+this.InputBox.height+this.BoxPadding,width:this.MessageBox.width,height:this.NumButtonHeight*
4+3*this.RowSpace,type:"rect"};var rowy=this.NumPad.y;this.Numbers=[];this.Numbers[7]={x:this.NumPad.x,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[8]={x:this.NumPad.x+this.NumButtonWidth+this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[9]={x:this.NumPad.x+2*this.NumButtonWidth+2*this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};rowy=this.NumPad.y+this.NumButtonHeight+
this.RowSpace;this.Numbers[4]={x:this.NumPad.x,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[5]={x:this.NumPad.x+this.NumButtonWidth+this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[6]={x:this.NumPad.x+2*this.NumButtonWidth+2*this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};rowy=this.NumPad.y+2*this.NumButtonHeight+2*this.RowSpace;this.Numbers[1]={x:this.NumPad.x,y:rowy,
width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[2]={x:this.NumPad.x+this.NumButtonWidth+this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Numbers[3]={x:this.NumPad.x+2*this.NumButtonWidth+2*this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"};this.Delete={x:this.NumPad.x+3*this.NumButtonWidth+3*this.RowSpace,y:rowy,width:this.NumButtonWidth*2,height:this.NumButtonHeight,type:"rect"};rowy=
this.NumPad.y+3*this.NumButtonHeight+3*this.RowSpace;this.Numbers[0]={x:this.NumPad.x,y:rowy,width:(this.NumButtonWidth*3+this.RowSpace)/2,height:this.NumButtonHeight,type:"rect"};this.Numbers[10]={x:this.Numbers[0].x+this.Numbers[0].width+this.RowSpace,y:rowy,width:(this.NumButtonWidth*3+this.RowSpace)/2,height:this.NumButtonHeight,type:"rect"};this.Numbers[11]={x:this.Numbers[10].x+this.Numbers[10].width+this.RowSpace,y:rowy,width:this.NumButtonWidth,height:this.NumButtonHeight,type:"rect"}}this.ButtonBox=
{x:this.NumPad.x,y:this.NumPad.y+this.NumPad.height+this.BoxPadding,width:this.MessageBox.width,height:30+this.BoxPadding,type:"rect",background:true};var buttonWidth=this.ButtonBox.width/3+10;this.OKButton={x:this.ButtonBox.x+this.ButtonBox.width/4-buttonWidth/2,y:this.ButtonBox.y+2+this.BoxPadding,width:buttonWidth,height:this.ButtonBox.height-4,type:"rrect",rounding:4};this.CancelButton={x:this.ButtonBox.x+this.ButtonBox.width/4*3-buttonWidth/2,y:this.ButtonBox.y+2+this.BoxPadding,width:buttonWidth,
height:this.ButtonBox.height-4,type:"rrect",rounding:4};var comph=this.Box.height+this.MessageBox.height+this.InputBox.height+this.NumPad.height+this.ButtonBox.height;if(this._numPad)comph+=6*this.BoxPadding;else comph+=4*this.BoxPadding;this.Box.height=comph;var dx=(this.Width-this.Box.width)/2;var dy=(this.Height-this.Box.height)/2;this.Move(dx,dy)};
Anibody.ui.Prompt.prototype.Move=function(dx,dy){this.Box.x+=dx;this.Box.y+=dy;this.MessageBox.x+=dx;this.MessageBox.y+=dy;this.InputBox.x+=dx;this.InputBox.y+=dy;this.NumPad.x+=dx;this.NumPad.y+=dy;for(var i=0;this._numPad&&i<this.Numbers.length;i++){this.Numbers[i].x+=dx;this.Numbers[i].y+=dy}this.Delete.x+=dx;this.Delete.y+=dy;this.ButtonBox.x+=dx;this.ButtonBox.y+=dy;this.OKButton.x+=dx;this.OKButton.y+=dy;this.CancelButton.x+=dx;this.CancelButton.y+=dy};
Anibody.ui.Prompt.prototype.Start=function(){this.InputField.Selected=true;this.Register();var mhand=this._createMouseHandlerObject();this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",mhand)};Anibody.ui.Prompt.prototype.Stop=function(){this.InputField.Selected=false;this.Deregister();this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);this._ref_mhan=null};
Anibody.ui.Prompt.prototype._createMouseHandlerObject=function(){var f=function(e){e.Handled=true;if(this.IsMouseOverOK)this.ClickOnOK();if(this.IsMouseOverCancel||this.IsMouseOverBackground)this.ClickOnCancel();for(var i=0;i<this.Numbers.length;i++)if(this.IsMouseOverNumber[i]){var txt=i.toString();if(i==10)txt=",";if(i==11)txt="-";this.InputField.AddLetter(txt)}if(this.IsMouseOverDelete)this.InputField.RemoveLetter()};return{that:this,"function":f,parameter:this.Engine}};
Anibody.ui.Prompt.prototype.Draw=function(c){c.save();c.globalAlpha=this.Opacity;c.fillStyle=this.OutsideColor;c.fillRect(0,0,c.canvas.width,c.canvas.height);c.setFontHeight(this.FontHeight);var box=this.Box;c.fillStyle=this.BackgroundColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,box.rounding);c.strokeStyle=this.BorderColor;c.strokeVariousRoundedRect(box.x,box.y,box.width,box.height,box.rounding);box=this.MessageBox;c.textAlign="left";c.textBaseline="top";c.fillStyle=this.FontColor;
var rowspace=0;for(var i=0;i<this.Rows.length;i++){c.fillText(this.Rows[i],this.MessageBox.x,this.MessageBox.y+i*this.FontHeight+rowspace);rowspace+=this.RowSpace}if(this.InputField)this.InputField.Draw(c);c.restore();c.save();if(this._numPad){c.setFontHeight(this.NumFontHeight);var txt;for(var i=0;i<this.Numbers.length;i++){box=this.Numbers[i];c.fillStyle=this.ButtonColor;c.fillRect(box.x,box.y,box.width,box.height);c.fillStyle=this.ButtonFontColor;txt=i.toString();if(i==10)txt=",";if(i==11)txt=
"-";c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,txt,0)}box=this.Delete;c.fillStyle=this.ButtonColor;c.fillRect(box.x,box.y,box.width,box.height);c.fillStyle=this.ButtonFontColor;c.fillArrow2(box.x+box.width*.9,box.y+box.height/2,box.x+box.width*.1,box.y+box.height/2,box.height/2);c.setFontHeight(this.FontHeight)}box=this.OKButton;c.fillStyle=this.ButtonColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,box.rounding);box=this.CancelButton;c.fillVariousRoundedRect(box.x,box.y,
box.width,box.height,box.rounding);box=this.OKButton;c.fillStyle=this.ButtonFontColor;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"OK",0);box=this.CancelButton;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"Abbrechen",0);c.restore()};
Anibody.ui.Prompt.prototype.ProcessInput=function(){var key=this.Engine.Input.Keys;if(key.Enter.FramesPressed==2)this.ClickOnOK();if(key.Esc.FramesPressed==2)this.ClickOnCancel();var self=this;var area={type:"function","function":function(c){c.moveTo(0,0);c.lineTo(0,c.canvas.height);c.lineTo(c.canvas.width,c.canvas.height);c.lineTo(c.canvas.width,0);c.lineTo(0,0);c.variousRoundedRect(self.Box.x,self.Box.y,self.Box.width,self.Box.height,self.Box.rounding)}};this.Engine.Input.MouseHandler.AddHoverRequest(area,
this,"IsMouseOverBackground");this.Engine.Input.MouseHandler.AddHoverRequest(this.Box,this,"IsMouseOverBox");this.Engine.Input.MouseHandler.AddHoverRequest(this.Delete,this,"IsMouseOverDelete");this.Engine.Input.MouseHandler.AddHoverRequest(this.CancelButton,this,"IsMouseOverCancel");this.Engine.Input.MouseHandler.AddHoverRequest(this.OKButton,this,"IsMouseOverOK");for(var i=0;i<this.Numbers.length;i++)this.Engine.Input.MouseHandler.AddHoverRequest(this.Numbers[i],this.IsMouseOverNumber,i.toString());
if(this.InputField)this.InputField.ProcessInput()};Anibody.ui.Prompt.prototype.Update=function(){var overpad=false;for(var i=0;i<this.Numbers.length;i++)overpad=overpad||this.IsMouseOverNumber[i];if(this.IsMouseOverOK||this.IsMouseOverCancel||overpad||this.IsMouseOverDelete)this.Engine.Input.Mouse.Cursor.Set("pointer");if(this.InputField)this.InputField.Update();this.Input=this._getInput()};Anibody.ui.Prompt.prototype._getInput=function(){return this.InputField.Text};
Anibody.ui.Prompt.prototype._setInput=function(txt){this.InputField.Text=txt};Anibody.ui.Prompt.prototype.AddCharLimiter=function(lim,limFailCbo){this.InputField.AddCharLimiter(lim,limFailCbo)};Anibody.ui.Prompt.prototype.ClickOnOK=function(){var cbo=this.CallbackObject;if(cbo)cbo["function"].call(cbo.that,this.Input,cbo.parameter);this.Stop()};Anibody.ui.Prompt.prototype.ClickOnCancel=function(){this.Stop()};
Anibody.ui.Prompt.prototype._getDeleteImage=function(width,height){var can=document.createElement("canvas");can.width=width;can.height=height;var c=can.getContext("2d");c.beginPath();c.arrow(width*.9,height*.5,width*.3,width*.8,180,.3,1,false);c.fill();var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;return img};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Slider=function Slider(x,y,width,height){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=width;this.Height=height;this.OnValueChangeCBO=false;this.Handle={x:x,width:10,height:height};this._oldValue;this.Value=0;this.ValueLimits=[.2,2];this.DecimalDigits=1;this._dragging=false;this.IsMouseOverSliderHandle=false;this.IsMouseOver=false;this._ref=null;this._ref_mh=null;this._boundAttr=null;this._boundObj=null;this._noValueChange=false;this.Color=Anibody.ui.Slider.prototype.DefaultColor;
this.Initialize()};Anibody.ui.Slider.prototype=Object.create(Anibody.ABO.prototype);Anibody.ui.Slider.prototype.constructor=Anibody.ui.Slider;Anibody.ui.Slider.prototype.DefaultColor="rgba(100,100,120,1)";Anibody.ui.Slider.prototype.Initialize=function(){this.AddProcessInputFunctionObject();this.AddMouseHandler()};
Anibody.ui.Slider.prototype.AddProcessInputFunctionObject=function(){this._ref=this.Engine.AddProcessInputFunctionObject({parameter:this.Engine,that:this,"function":function(engine){var mouse=engine.Input.Mouse;if(this.IsMouseOverSliderHandle&&mouse.Left.Down)this._dragging=true;if(mouse.Left.Up)this._dragging=false}},2)};Anibody.ui.Slider.prototype.RemoveProcessInputFunctionObject=function(){this.Engine.RemoveProcessInputFunctionObject(this._ref)};
Anibody.ui.Slider.prototype.AddMouseHandler=function(){this._ref_mh=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOver&&!this.IsMouseOverSliderHandle){e.Handled=true;var x=e.Mouse.Position.Camera.X-this.X;var quotient=Math.round(x/this.Width*100)/100;var value=quotient*(this.ValueLimits[1]-this.ValueLimits[0])+this.ValueLimits[0];this.SetValue(value)}}},4)};
Anibody.ui.Slider.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mh)};
Anibody.ui.Slider.prototype.Update=function(){var m=this.Engine.Input.Mouse.Position;if(this._dragging){var md=m.Delta;this.Handle.x+=md.X;if(this.Handle.x<this.X)this.Handle.x=this.X;if(this.Handle.x>this.X+this.Width)this.Handle.x=this.X+this.Width;var quotient=(this.Handle.x-this.X)/this.Width;this.Value=(this.ValueLimits[1]-this.ValueLimits[0])*quotient+this.ValueLimits[0];if(this.DecimalDigits>0)this.Value=Math.round(this.Value*Math.pow(10,this.DecimalDigits))/Math.pow(10,this.DecimalDigits);
else this.Value=Math.round(this.Value);if(this.OnValueChangeCBO){if(this._noValueChange)this.ResetValue();var o=this.OnValueChangeCBO;o["function"].call(o.that,this.Value)}}if(this.IsMouseOverSliderHandle)if(this._noValueChange)this.Engine.Input.Mouse.Cursor.not_allowed();else this.Engine.Input.Mouse.Cursor.pointer();this._oldValue=this.Value;if(this._boundObj!==null&&this._boundAttr!=null)this._boundObj[this._boundAttr]=this.Value};
Anibody.ui.Slider.prototype.ProcessInput=function(){var area={x:this.X,y:this.Y-this.Handle.height/2,width:this.Width,height:this.Handle.height,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver");var area={x:this.Handle.x-this.Handle.width/2,y:this.Y-this.Handle.height/2,width:this.Handle.width,height:this.Handle.height,rounding:2,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverSliderHandle")};
Anibody.ui.Slider.prototype.Draw=function(c){c.save();c.fillStyle=this.Color;c.beginPath();c.moveTo(this.X,this.Y);c.lineTo(this.X+this.Width,this.Y);c.closePath();c.stroke();var x=this.Handle.x-this.Handle.width/2;var y=this.Y-this.Handle.height/2;c.fillVariousRoundedRect(x,y,this.Handle.width,this.Handle.height,2);c.strokeVariousRoundedRect(x,y,this.Handle.width,this.Handle.height,2);c.restore()};Anibody.ui.Slider.prototype.GetValue=function(){return this.Value};
Anibody.ui.Slider.prototype.SetValue=function(v){if(v<this.ValueLimits[0]||v>this.ValueLimits[1])return false;this.Value=v;if(this.DecimalDigits>0)this.Value=Math.round(this.Value*Math.pow(10,this.DecimalDigits))/Math.pow(10,this.DecimalDigits);else this.Value=Math.round(this.Value);var quotient=(this.Value-this.ValueLimits[0])/(this.ValueLimits[1]-this.ValueLimits[0]);this.Handle.x=quotient*this.Width+this.X;if(this.OnValueChangeCBO){var o=this.OnValueChangeCBO;o["function"].call(o.that,this.Value)}return true};
Anibody.ui.Slider.prototype.SetLimits=function(low,high){this.ValueLimits=[low,high];this.Value=low;this.Handle.x=this.X;if(this.OnValueChangeCBO){var o=this.OnValueChangeCBO;o["function"].call(o.that,this.Value)}};Anibody.ui.Slider.prototype.ResetValue=function(){this.SetValue(this._oldValue)};Anibody.ui.Slider.prototype.BindAttribute=function(obj,attr){if(!obj||!obj[attr])return;this._boundAttr=attr;this._boundObj=obj};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Switch=function Switch(x,y,width,height,cbo,on){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=width;this.Height=height;this._innerRectDepth=Math.ceil(Math.min(width,height)*.1);if(typeof on!=="undefined"&&on)this.ON=true;else this.ON=false;if(typeof cbo==="undefined"||!cbo)cbo={that:this,"function":function(){}};this.CallbackObject=cbo;this.Cover={x:this.X,y:this.Y,width:this.Width*.6,height:this.Height};this.CoverLayer=false;this.CoverX={Off:this.X,On:this.X+this.Width-this.Cover.width};
this.BackgroundColor=Switch.prototype.DefaultBackgroundColor;this.CoverColor=Switch.prototype.DefaultCoverColor;this.IsMouseOver=false;this.TextOn="An";this.TextOff="Aus";this.FontHeight=this.Height*.5;this.ColorOn=Switch.prototype.DefaultColorOn;this.ColorOff=Switch.prototype.DefaultColorOff;this.SwitchFontColor=Switch.prototype.DefaultFontColor;this.LabelFontColor=Switch.prototype.DefaultLabelFontColor;this.Label="";this.LabelPos="top";this._ref=null;this.Initialize()};
Anibody.ui.Switch.prototype=Object.create(Anibody.ABO.prototype);Anibody.ui.Switch.prototype.constructor=Anibody.ui.Switch;Anibody.ui.Switch.prototype.DefaultBackgroundColor="grey";Anibody.ui.Switch.prototype.DefaultCoverColor=false;Anibody.ui.Switch.prototype.DefaultLabelFontColor="black";Anibody.ui.Switch.prototype.DefaultFontColor="white";Anibody.ui.Switch.prototype.DefaultColorOn="green";Anibody.ui.Switch.prototype.DefaultColorOff="red";Anibody.ui.Switch.prototype.DefaultRounding=4;
Anibody.ui.Switch.prototype.Initialize=function(){this.AddMouseHandler();if(!this.CoverColor)this.CoverColor=this._getRGBA(this.BackgroundColor,1,.3);if(this.ON)this.Cover.x=this.CoverX.On;else this.Cover.x=this.CoverX.Off;this._createCoverLayer()};
Anibody.ui.Switch.prototype.Switch=function(cbo){this.ON=!this.ON;var target;var ms=300;if(this.ON)target=this.CoverX.On;else target=this.CoverX.Off;(new Anibody.util.Flow(this.Cover,"x",target,ms)).Start();if(typeof cbo==="undefined")cbo=this.CallbackObject;window.setTimeout(function(cbo){Anibody.CallObject(cbo)},ms/2,cbo)};Anibody.ui.Switch.prototype.SetOn=function(state){this.ON=state;var target;if(this.ON)target=this.CoverX.On;else target=this.CoverX.Off;this.Cover.x=target};
Anibody.ui.Switch.prototype.SetCallbackObject=function(cbo){this.CallbackObject=cbo};
Anibody.ui.Switch.prototype.Draw=function(c){c.save();var ir=this._innerRectDepth;c.fillStyle=this.BackgroundColor;c.fillRect(this.X,this.Y,this.Width,this.Height);c.fillStyle=this.ColorOn;c.fillRect(this.X+ir,this.Y+ir,this.Width/2-ir,this.Height-2*ir);c.fillStyle=this.ColorOff;c.fillRect(this.X+this.Width/2,this.Y+ir,this.Width/2-ir,this.Height-2*ir);c.fillStyle=this.SwitchFontColor;c.setFontHeight(this.FontHeight);c.textBaseline="middle";c.textAlign="left";c.fillText(this.TextOn,this.X+2*ir,this.Y+
this.Height/2);c.textAlign="right";c.fillText(this.TextOff,this.X+this.Width-2*ir,this.Y+this.Height/2);c.fillStyle=this.CoverColor;c.fillRect(this.Cover.x,this.Cover.y,this.Cover.width,this.Cover.height);if(this.CoverLayer)c.drawImage(this.CoverLayer,this.Cover.x,this.Cover.y);if(this.IsMouseOver){var x1=this.Cover.x+this.Cover.width*.2;var x2=this.Cover.x+this.Cover.width*.8;var y=this.Y+this.Height/2;c.fillStyle="white";c.beginPath();if(this.ON)c.arrow2(x2,y,x1,y,this.Cover.height*.5,.5);else c.arrow2(x1,
y,x2,y,this.Cover.height*.5,.5);c.fill();c.fillStyle="rgba(0,0,0,0.2)";c.fillRect(this.Cover.x,this.Cover.y,this.Cover.width,this.Cover.height)}if(this.Label.length>0){var fh=16;c.setFontHeight(fh);var tw=c.measureText(this.Label).width;var tx,ty;switch(this.LabelPos){case "top":{c.textAlign="center";tx=this.X+this.Width/2;ty=this.Y-ir-fh/2;break}}c.fillStyle=this.LabelFontColor;c.fillText(this.Label,tx,ty)}c.restore()};Anibody.ui.Switch.prototype.Update=function(){if(this.IsMouseOver)this.Engine.Input.Mouse.Cursor.Set("pointer")};
Anibody.ui.Switch.prototype.ProcessInput=function(){this.Engine.Input.MouseHandler.AddHoverRequest(this.GetArea(0,this.Rounding),this,"IsMouseOver")};Anibody.ui.Switch.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOver){e.Handled=true;this.Switch()}}},5)};
Anibody.ui.Switch.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref);this._ref=null};
Anibody.ui.Switch.prototype._createCoverLayer=function(depth,stops){if(isNaN(depth))depth=this._innerRectDepth;if(typeof stops==="undefined"||stops.length<=0)stops=[{stop:0,color:"rgba(255,255,255,0.5)"},{stop:.5,color:"rgba(255,255,255,0.25)"},{stop:1,color:"rgba(255,255,255,0)"}];stops=stops.sort(function(a,b){if(a.stop>b.stop)return 1;else return-1});var stops_b=[{stop:0,color:"rgba(0,0,0,0.5)"},{stop:.5,color:"rgba(0,0,0,0.25)"},{stop:1,color:"rgba(0,0,0,0)"}];stops_b=stops_b.sort(function(a,
b){if(a.stop>b.stop)return 1;else return-1});var w=this.Cover.width;var h=this.Cover.height;var top={x:0,y:0,width:w,height:depth};var bottom={x:0,y:h-depth,width:w,height:depth};var can=document.createElement("CANVAS");can.width=w;can.height=h;var c=can.getContext("2d");var ling=c.createLinearGradient(top.x,top.y,top.x,top.height);for(var i=0;i<stops.length;i++)ling.addColorStop(stops[i].stop,stops[i].color);c.fillStyle=ling;c.fillRect(top.x,top.y,top.width,top.height);ling=c.createLinearGradient(bottom.x,
bottom.y+bottom.height,bottom.x,bottom.y);for(var i=0;i<stops.length;i++)ling.addColorStop(stops_b[i].stop,stops_b[i].color);c.fillStyle=ling;c.fillRect(bottom.x,bottom.y,bottom.width,bottom.height);var url=can.toDataURL();var img=document.createElement("IMG");img.src=url;this.CoverLayer=img};
Anibody.ui.Switch.prototype._getRGBA=function(color,alpha,inc_quot){var rgbaCode;if(typeof color!=="string")return false;if(typeof alpha==="undefined"||alpha<0&&alpha>1)alpha=1;if(typeof inc_quot==="undefined"&&isNaN(inc_quot))inc_quot=0;var can=document.createElement("CANVAS");can.width=1;can.height=1;var c=can.getContext("2d");c.fillStyle=color;c.fillRect(0,0,1,1);var imageData=c.getImageData(0,0,1,1).data;imageData[0]+=255*inc_quot;if(imageData[0]>255)imageData[0]=255;if(imageData[0]<0)imageData[0]=
0;imageData[1]+=255*inc_quot;if(imageData[1]>255)imageData[1]=255;if(imageData[1]<0)imageData[1]=0;imageData[2]+=255*inc_quot;if(imageData[2]>255)imageData[2]=255;if(imageData[2]<0)imageData[2]=0;rgbaCode="rgba("+imageData[0]+","+imageData[1]+","+imageData[2]+","+alpha+")";return rgbaCode};Anibody.ui.Switch.prototype.SetLabel=function(text,pos){if(typeof text==="string")this.Label=text;if(pos==="left"||pos==="top"||pos==="right"||pos==="bottom")this.LabelPos=pos};Anibody.SetPackage("Anibody","ui");
Anibody.ui.Toaster=function Toaster(type,title,txt,ms){Anibody.Widget.call(this);this.X=0;this.Y=0;this.Width=0;this.Height=0;this.Rounding=0;this._blur=5;this.PositionQutient=.55;this.Title=title;if(typeof txt==="string")this.Text=[txt];else this.Text=txt;this.Padding=Anibody.ui.Toaster.prototype.DefaultPadding;this.RowSpace=Anibody.ui.Toaster.prototype.DefaultRowSpace;this.FontHeight=Anibody.ui.Toaster.prototype.DefaultFontHeight;this.Rows=false;this.Image=false;this.BackgroundImage=false;this.IsMouseOver=
false;this.IsMouseOverClose=false;this.Xbox={x:0,y:0,width:this.FontHeight,height:this.FontHeight};this.BackgroundColor=Anibody.ui.Toaster.prototype.DefaultDefaultBackgroundColor;this.FontColor=Anibody.ui.Toaster.prototype.DefaultDefaultFontColor;this.Type=type;switch(type){case "warning":this.BackgroundColor=Anibody.ui.Toaster.prototype.DefaultWarningBackgroundColor;this.FontColor=Anibody.ui.Toaster.prototype.DefaultWarningFontColor;break;case "success":this.BackgroundColor=Anibody.ui.Toaster.prototype.DefaultSuccessBackgroundColor;
this.FontColor=Anibody.ui.Toaster.prototype.DefaultSuccessFontColor;break;case "error":this.BackgroundColor=Anibody.ui.Toaster.prototype.DefaultErrorBackgroundColor;this.FontColor=Anibody.ui.Toaster.prototype.DefaultErrorFontColor;break;default:console.log("toaster type = "+type);this.Type="default";break}this.Milliseconds=ms||4E3;this._refMH=null;this._isBlocking=false;this._isOverwriting=true;this._filter=false;if(document.createElement("CANVAS").getContext("2d").filter)this._filter=true;this.Initialize()};
Anibody.ui.Toaster.prototype=Object.create(Anibody.Widget.prototype);Anibody.ui.Toaster.prototype.constructor=Anibody.ui.Toaster;Anibody.ui.Toaster.BlockMode=false;Anibody.ui.Toaster.CurrentInstance=null;Anibody.ui.Toaster.prototype.DefaultDefaultBackgroundColor="black";Anibody.ui.Toaster.prototype.DefaultDefaultFontColor="white";Anibody.ui.Toaster.prototype.DefaultWarningBackgroundColor="orange";Anibody.ui.Toaster.prototype.DefaultWarningFontColor="white";
Anibody.ui.Toaster.prototype.DefaultSuccessBackgroundColor="green";Anibody.ui.Toaster.prototype.DefaultSuccessFontColor="white";Anibody.ui.Toaster.prototype.DefaultErrorBackgroundColor="red";Anibody.ui.Toaster.prototype.DefaultErrorFontColor="white";Anibody.ui.Toaster.prototype.DefaultFontHeight=15;Anibody.ui.Toaster.prototype.DefaultPadding=5;Anibody.ui.Toaster.prototype.DefaultRowSpace=3;
Anibody.ui.Toaster.prototype.Initialize=function(){this._calculateValues();this._getBackgroundImage();this._createImage();this._adjustPosition()};
Anibody.ui.Toaster.prototype.Open=function(){if(Anibody.ui.Toaster.BlockMode)return;if(this._isBlocking)Anibody.ui.Toaster.BlockMode=true;this.CloseCurrentInstance();Anibody.ui.Toaster.CurrentInstance=this;var can=this.Engine.Canvas;(new Anibody.util.Flow(this,"Y",can.height-this.Height,600,{that:this,parameter:true,"function":function(){var f=function(t){t.FlowClose()};window.setTimeout(f,this.Milliseconds,this)}})).Start();this.AddMouseHandler(12);this.Register()};
Anibody.ui.Toaster.prototype.FlowClose=function(){var can=this.Engine.Canvas;(new Anibody.util.Flow(this,"Y",can.height,600,{that:this,parameter:true,"function":function(){this.Close()}})).Start()};Anibody.ui.Toaster.prototype.Close=function(){this.Deregister();this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._refMH);this._refMH=null;Anibody.ui.Toaster.CurrentInstance=null;Anibody.ui.Toaster.BlockMode=false};
Anibody.ui.Toaster.prototype.AddMouseHandler=function(prior){this._refMH=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOver)e.Handled=true;if(this.IsMouseOverClose){this.Close();e.Handled=true}}},prior)};
Anibody.ui.Toaster.prototype.ProcessInput=function(){var area={x:this.X,y:this.Y,width:this.Width,height:this.Height,type:"rect",background:true};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver");area={x:this.X+this.Width-this.RowSpace-this.FontHeight,y:this.Y+this.RowSpace,width:this.FontHeight,height:this.FontHeight,type:"rect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverClose")};
Anibody.ui.Toaster.prototype.Update=function(){this.Xbox.x=this.X+this.Width-this.RowSpace-this.FontHeight;this.Xbox.y=this.Y+this.RowSpace;if(this.IsMouseOverClose)this.Engine.Input.Mouse.Cursor.Set("pointer")};Anibody.ui.Toaster.prototype.Draw=function(c){c.save();c.drawImage(this.BackgroundImage,this.X,this.Y);c.drawImage(this.Image,this.X,this.Y);c.restore()};
Anibody.ui.Toaster.prototype._calculateValues=function(){var can=this.Engine.Canvas;var c=this.Engine.Context;this.Width=Math.round(can.width/2.6);c.setFontHeight(this.FontHeight);var allwords=[];var alllengths=[];var spacelen=c.measureText(" ").width;var temp;for(var i=0;i<this.Text.length;i++){temp=this.Text[i].split(" ");for(var j=0;j<temp.length;j++){allwords.push(temp[j]);alllengths.push(c.measureText(temp[j]).width)}if(i<this.Text.length-1){allwords.push("\\n");alllengths.push(0)}}this.Rows=
[];var templen=0;this.Rows.push("");for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;this.Rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}else if(templen+alllengths[i]+spacelen<this.Width-2*this.Padding){this.Rows[this.Rows.length-1]+=allwords[i]+" ";templen+=alllengths[i]+spacelen}else{this.Rows[this.Rows.length-1]=this.Rows[this.Rows.length-1].substr(0,this.Rows[this.Rows.length-1].length-1);this.Rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}this.Rows[this.Rows.length-
1]=this.Rows[this.Rows.length-1].substr(0,this.Rows[this.Rows.length-1].length-1);this.Height=2*this.Padding+this.FontHeight*this.Rows.length+this.RowSpace*this.Rows.length-1;this.Height+=2*this.RowSpace+this.FontHeight};
Anibody.ui.Toaster.prototype._createImage=function(){var off=document.createElement("CANVAS");off.width=this.Width+2*this._blur;off.height=this.Height+this._blur;var coff=off.getContext("2d");coff.setFontHeight(this.FontHeight);coff.fillStyle=this.BackgroundColor;coff.fillRect(this._blur,this._blur,this.Width,this.Height);coff.textAlign="left";coff.textBaseline="top";coff.fillStyle=this.FontColor;coff.strokeStyle=this.FontColor;var x=this.Padding+this._blur;var y=this.RowSpace+this._blur;coff.fillText(this.Title,
x,y);coff.lineWidth=2;coff.drawCross(this.Width+this._blur-this.FontHeight/2-this.RowSpace,this.RowSpace+this._blur+this.FontHeight/2,this.FontHeight);coff.lineWidth=1;y=2*this.RowSpace+this.FontHeight+this._blur;coff.beginPath();coff.moveTo(x,y);coff.lineTo(x+this.Width-2*this.Padding,y);coff.stroke();coff.closePath();y=this.Padding+3*this.RowSpace+this.FontHeight;for(var i=0;i<this.Rows.length;i++){coff.fillText(this.Rows[i],x,y);y+=this.FontHeight+this.RowSpace}var url=off.toDataURL();this.Image=
document.createElement("IMG");this.Image.crossOrigin="";this.Image.src=url};Anibody.ui.Toaster.prototype._adjustPosition=function(){var can=this.Engine.Canvas;this.X=can.width*this.PositionQutient;this.Y=can.height};Anibody.ui.Toaster.prototype.SetBlocking=function(blocking){this._isBlocking=blocking};Anibody.ui.Toaster.prototype.SetOverwriting=function(ow){this._isOverwriting=ow};
Anibody.ui.Toaster.prototype.CloseCurrentInstance=function(){if(this._isOverwriting&&Anibody.ui.Toaster.CurrentInstance!==null)Anibody.ui.Toaster.CurrentInstance.Close()};
Anibody.ui.Toaster.prototype._getBackgroundImage=function(){var can=document.createElement("CANVAS");can.width=this.Width+2*this._blur;can.height=this.Height+this._blur;var c=can.getContext("2d");c.lineWidth=this._blur;c.filter="blur("+this._blur/2+"px)";c.strokeStyle=getRGBA(this.BackgroundColor,.6);c.strokeRect(this._blur,this._blur,can.width-this._blur*2,can.height);var url=can.toDataURL();this.BackgroundImage=document.createElement("IMG");this.BackgroundImage.src=url};
Anibody.ui.Toaster.prototype.Types={Default:"default",Warning:"warning",Error:"error",Success:"success"};Anibody.SetPackage("Anibody","util");
Anibody.util.MultiFlow=function MultiFlow(object,attr,targetvalue,duration,callbackobject,aftereveryframeobject){this.Object=object;this.AttributeString=attr;this.TargetValue=targetvalue;this.Duration=duration;this.CallbackObject=callbackobject;this.AfterEveryFrameObject=aftereveryframeobject;this.FPS=25;this.Frames=0;this.StartValue=[];this.Difference=[];this.Step=[];this.ref=null;this.TargetIsSmaller=[];this.TargetReached=[]};
Anibody.util.MultiFlow.prototype.Start=function(){var framesWhenReady=this.FPS*(this.Duration/1E3);var obj,attr;for(var i=0;i<this.Object.length;i++){obj=this.Object[i];attr=this.AttributeString[i];this.StartValue[i]=obj[attr];this.Difference[i]=this.TargetValue[i]-this.StartValue[i];if(this.Difference[i]<0)this.TargetIsSmaller[i]=true;else this.TargetIsSmaller[i]=false;this.Step[i]=this.Difference[i]/framesWhenReady;this.TargetReached[i]=false}var f=function(self){var obj,attr;var aef=self.AfterEveryFrameObject;
var cbo=self.CallbackObject;for(var i=0;i<self.Object.length;i++){obj=self.Object[i];attr=self.AttributeString[i];obj[attr]+=self.Step[i];if(aef)aef["function"].call(aef.that,aef.parameter);if(self.TargetIsSmaller[i]){if(obj[attr]<=self.TargetValue[i]){obj[attr]=self.TargetValue[i];self.TargetReached[i]=true}}else if(obj[attr]>=self.TargetValue[i]){obj[attr]=self.TargetValue[i];self.TargetReached[i]=true}}if(self._allReached()){clearInterval(self.ref);if(typeof cbo!=="undefined"&&typeof cbo["function"]===
"function")cbo["function"].call(cbo.that,cbo.parameter)}};this.ref=setInterval(f,1E3/this.FPS,this)};Anibody.util.MultiFlow.prototype._allReached=function(){for(var i=0;i<this.Object.length;i++)if(!this.TargetReached[i])return false;return true};
Anibody.util.Flow=function Flow(object,attr,targetvalue,duration,callbackobject,aftereveryframeobject){this.Object=object;this.AttributeString=attr;this.TargetValue=targetvalue;this.Duration=duration;this.CallbackObject=callbackobject;this.AfterEveryFrameObject=aftereveryframeobject;this.FPS=25;this.Frames=0;this.StartValue;this.Difference;this.ref=null;this.TargetIsSmaller=false};
Anibody.util.Flow.prototype.Start=function(){this.StartValue=this.Object[this.AttributeString];this.Difference=this.TargetValue-this.StartValue;if(this.Difference<0)this.TargetIsSmaller=true;var framesWhenReady=this.FPS*(this.Duration/1E3);this.Step=this.Difference/framesWhenReady;var f=function(obj,key,step,self){obj[key]+=step;var aef=self.AfterEveryFrameObject;if(aef)aef["function"].call(aef.that,aef.parameter);if(self.TargetIsSmaller){if(obj[key]<=self.TargetValue){obj[key]=self.TargetValue;clearInterval(self.ref);
var cbo=self.CallbackObject;if(typeof cbo!=="undefined"&&typeof cbo["function"]==="function")cbo["function"].call(cbo.that,cbo.parameter)}}else if(obj[key]>=self.TargetValue){obj[key]=self.TargetValue;clearInterval(self.ref);var cbo=self.CallbackObject;if(typeof cbo!=="undefined"&&typeof cbo["function"]==="function")cbo["function"].call(cbo.that,cbo.parameter)}};this.ref=setInterval(f,1E3/this.FPS,this.Object,this.AttributeString,this.Step,this)};Anibody.SetPackage("Anibody","util");
Anibody.util.PriorityQueue=function PriorityQueue(nop){this.heap=[];this._desc=true;this.HighestPriority=0;this.NoPriorityThenZero=nop?nop:false;this.Sorted=false;this._refnums=0};Object.defineProperty(Anibody.util.PriorityQueue.prototype,"length",{get:function(){return this.heap.length}});
Anibody.util.PriorityQueue.prototype.Enqueue=function(data,priority,name){if(priority&&priority>this.HighestPriority)this.HighestPriority=priority;if(this.NoPriorityThenZero)priority=priority?priority:0;else priority=priority||typeof priority=="number"?priority:++this.HighestPriority;this.Sorted=false;var obj={data:data,priority:priority,origin:"enqueued",refnum:this._refnums++,name:name};this.heap.push(obj);return obj.refnum};
Anibody.util.PriorityQueue.prototype.DeleteByReferenceNumber=function(ref){var arr=[];var found=0;for(var i=0;i<this.heap.length;i++)if(this.heap[i].refnum!==ref)arr.push(this.heap[i]);else found++;this.heap=arr;return found};Anibody.util.PriorityQueue.prototype.DeleteByName=function(name){var arr=[];var found=0;for(var i=0;i<this.heap.length;i++)if(this.heap[i].name!==name)arr.push(this.heap[i]);else found++;this.heap=arr;return found};
Anibody.util.PriorityQueue.prototype.ElementIsEnqueued=function(data){for(var i=0;i<this.heap.length;i++)if(this.heap[i]==data)return true;return false};Anibody.util.PriorityQueue.prototype.Dequeue=function(){if(this.heap.length>0)return this.heap.shift().data;else return false};Anibody.util.PriorityQueue.prototype.isEmpty=function(){if(this.heap.length<=0)return true;else return false};
Anibody.util.PriorityQueue.prototype.Sort=function(desc){if(arguments.length<=0||desc)this._desc=true;else this._desc=false;this._quicksort(0,this.heap.length-1);this.Sorted=true};Anibody.util.PriorityQueue.prototype._comp=function(a,b){if(this._desc)return a.priority>b.priority;else return a.priority<b.priority};Anibody.util.PriorityQueue.prototype._swap=function(i,j){var temp=this.heap[i];this.heap[i]=this.heap[j];this.heap[j]=temp};
Anibody.util.PriorityQueue.prototype._quicksort=function(left,right){if(left<right){var pivot=this.heap[left+Math.floor((right-right)/2)],left_new=left,right_new=right;do{while(this._comp(this.heap[left_new],pivot))left_new+=1;while(this._comp(pivot,this.heap[right_new]))right_new-=1;if(left_new<=right_new){this._swap(left_new,right_new);left_new+=1;right_new-=1}}while(left_new<=right_new);this._quicksort(left,right_new);this._quicksort(left_new,right)}};
Anibody.util.PriorityQueue.prototype.FactorArray=function(){var arr=[];if(!this.Sorted)this.Sort(this._desc);for(var i=0;i<this.heap.length;i++)arr.push(this.heap[i].data);return arr};Anibody.util.PriorityQueue.prototype.Merge=function(b){this.Sorted=false;for(var i=0;i<b.heap.length;i++){b.heap[i].origin="merged";this.heap.push(b.heap[i])}if(this.HighestPriority<b.HighestPriority)this.HighestPriority=b.HighestPriority};
Anibody.util.PriorityQueue.prototype.DeleteMergedElements=function(){var temp=[];var hp=0;for(var i=0;i<this.heap.length;i++)if(this.heap[i].origin!="merged"){if(hp<this.heap[i].priority)hp=this.heap[i].priority;temp.push(this.heap[i])}this.heap=temp;this.HighestPriority=hp};Anibody.util.PriorityQueue.prototype.Flush=function(){this.heap=[];this.HighestPriority=0;this.Sorted=false};
Anibody.util.Timer=function Timer(ref,f,fps,framestotal){this.ref=ref;this.Active=false;this.internal=null;if(fps<=0)fps=1;this.Milli=1E3/fps;this.Counter=0;this.Total=framestotal;if(!this.Total||arguments.length>3)this.HasLimit=true;else this.HasLimit=false;this.Function=function(that){that.Counter++;if(that.HasLimit&&that.Counter>that.Total){that.Stop();return}f.call(that.ref,that.ref)}};
Anibody.util.Timer.prototype.Start=function(){this.Reset();this.internal=window.setInterval(this.Function,this.Milli,this);this.Active=true};Anibody.util.Timer.prototype.Reset=function(){this.Counter=0};Anibody.util.Timer.prototype.Stop=function(){this.Reset();window.clearInterval(this.internal);this.Active=false};Anibody.util.Timer.prototype.Continue=function(){this.internal=window.setInterval(this.Function,this.Milli,this);this.Active=true};
Anibody.util.Timer.prototype.Pause=function(){window.clearInterval(this.internal);this.Active=false};Anibody.util.Timer.prototype.SetTotal=function(t){this.Total=t};Anibody.util.IntervalHandler=function IntervalHandler(){Anibody.EngineObject.call(this);this.Frames=0;this.IntervalFunctions=[]};Anibody.util.IntervalHandler.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.util.IntervalHandler.prototype.constructor=Anibody.util.IntervalHandler;
Anibody.util.IntervalHandler.prototype.Update=function(){this.Frames++;var intf=this.IntervalFunctions;var d;for(var i=0;i<intf.length;i++){intf[i].that=intf[i].that?intf[i].that:this.Engine;if(this.Frames%intf[i].every==0)Anibody.CallObject(intf[i])}};Anibody.util.IntervalHandler.prototype.AddIntervalFunction=function(intf,every){if(typeof every==="undefined")every=1;intf.every=typeof intf.every!=="undefined"?intf.every:1;this.IntervalFunctions.push(intf);return this.IntervalFunctions.length-1};
Anibody.util.IntervalHandler.prototype.RemoveIntervalFunction=function(ref){this.IntervalFunctions["delete"](ref)};
Anibody.util.Counter=function Counter(range,ms,cbo,endcbo){if(cbo&&cbo.that==="self")cbo.that=this;if(endcbo&&endcbo.that==="self")endcbo.that=this;this.StartV=range[0];this.EndV=range[1];this.CurrentV=range[0];this.Milliseconds=ms;this.Callbackobject=cbo;if(typeof endcbo==="object")this.EndCallbackobject=endcbo;else this.EndCallbackobject={"function":function(){this.Stop()},that:this};this._intRef=null;if(this.StartV<this.EndV)this._increasing=true;else this._increasing=false;this.Loop=false};
Anibody.util.Counter.prototype.Start=function(){var f=function(that){var cbo={"function":that.Callbackobject["function"],that:that.Callbackobject.that};if(that.Callbackobject.useApply)cbo.parameter=[that.CurrentV].concat(that.Callbackobject.parameter);else cbo.parameter=[that.CurrentV,that.Callbackobject.parameter];cbo.useApply=true;Anibody.CallObject(cbo,true);if(that._increasing){that.CurrentV++;if(that.CurrentV>that.EndV){Anibody.CallObject(that.EndCallbackObject);if(that.Loop)that.CurrentV=that.StartV;
else that.Stop()}}else{that.CurrentV--;if(that.CurrentV<that.EndV){Anibody.CallObject(that.EndCallbackObject);if(that.Loop)that.CurrentV=that.StartV;else that.Stop}}};f(this);this._intRef=window.setInterval(f,this.Milliseconds,this)};Anibody.util.Counter.prototype.Stop=function(){window.clearInterval(this._intRef);this._intRef=null};Anibody.util.Counter.prototype.SetLoop=function(state){this.Loop=state};Anibody.util.Counter.prototype.Reset=function(){this.Stop();this.CurrentV=this.StartV;this.Start()};
Anibody.SetPackage("Anibody","util");Anibody.util.MediaManager=function MediaManager(){Anibody.ABO.call(this);this.Pictures=new Map;this.Sounds=new Map;this.Strings=new Map;this.Pack=[];this.SortedPack=false;this.Unloaded=[];this.Progress=0;this.ProgressStep=0;this.Loading=false};Anibody.util.MediaManager.prototype=Object.create(Anibody.ABO.prototype);Anibody.util.MediaManager.prototype.constructor=Anibody.util.MediaManager;Anibody.util.MediaManager.prototype.DefaultBarColor="green";
Anibody.util.MediaManager.prototype.DefaultBarBorderColor="black";Anibody.util.MediaManager.prototype.DefaultFontColor="black";Anibody.util.MediaManager.prototype.Flush=function(){};
Anibody.util.MediaManager.prototype.Draw=function(c){c.save();if(this.Loading){var center={x:this.Engine.Canvas.width/2,y:this.Engine.Canvas.height/2};var bar={x:center.x/2,width:center.x,y:center.y-center.y/20,height:center.y/10};var r=5;var cent=bar.width/100;c.fillStyle="white";c.fillRect(0,0,c.canvas.width,c.canvas.height);c.fillStyle=Anibody.util.MediaManager.prototype.DefaultBarColor;c.fillVariousRoundedRect(bar.x,bar.y,this.Progress*cent,bar.height,r);c.strokeStyle=Anibody.util.MediaManager.prototype.DefaultBarBorderColor;
c.strokeVariousRoundedRect(bar.x,bar.y,bar.width,bar.height,r);c.textAlign="left";c.textBaseline="top";c.fillStyle=Anibody.util.MediaManager.prototype.DefaultFontColor;c.fillText("Loading: {0}%".format(parseInt(this.Progress)),bar.x,bar.y+bar.height+10)}c.restore()};Anibody.util.MediaManager.prototype.GetPicture=function(codename){try{if(typeof codename==="string")return this.Pictures.get(codename).Data;else return codename}catch(e){return false}};Anibody.util.MediaManager.prototype.GetImage=function(codename){return this.GetPicture(codename)};
Anibody.util.MediaManager.prototype.GetSound=function(codename){try{return this.Pictures.get(codename).Data}catch(e){return false}};
Anibody.util.MediaManager.prototype.LoadMedia=function(pack,co){var aom=pack.length;this.Progress=0;this.ProgressStep=100/aom;this.Loading=true;this.Unloaded=pack;var of;of=function(){var co=this.Parameters.co;var mm=this.Parameters.mm;var pack=mm.Unloaded;if(!pack||pack.length<=0){mm.Loading=false;mm.Progress=100;Anibody.CallObject(co);return true}var of=this.Parameters.of;var curpct=pack.pop();mm.Progress+=mm.ProgressStep;if(curpct instanceof Anibody.util.Picture){mm.Pictures.set(curpct.Codename,
curpct);curpct.Load(of,{co:co,of:of,mm:mm});return}if(curpct instanceof Anibody.util.Sound){mm.Sounds.set(curpct.Codename,curpct);curpct.Load(of,{co:co,of:of,mm:mm});return}};if(!pack||pack.length<=0){this.Loading=false;this.Progress=100;Anibody.CallObject(co);return true}var curpct=pack.pop();this.Progress+=this.ProgressStep;if(curpct instanceof Anibody.util.Picture){this.Pictures.set(curpct.Codename,curpct);curpct.Load(of,{co:co,of:of,mm:this});return}if(curpct instanceof Anibody.util.Sound){this.Sounds.set(curpct.Codename,
curpct);curpct.Load(of,{co:co,of:of,mm:this});return}};Anibody.util.MediaManager.prototype.SetMediaPack=function(pack,co){this.Pack=pack;this.SortPack();this.Require("always",co,true)};Anibody.util.MediaManager.prototype.ExtendMediaPack=function(pack,co){this.Pack=this.Pack.concat(pack);this.SortPack();this.Require("always",co,true)};Anibody.util.MediaManager.prototype.SortPack=function(){this.Pack=this.Pack.sort(function(a,b){return a<b?1:-1});this.SortedPack=true};
Anibody.util.MediaManager.prototype.Require=function(group,co,loadMediaWithNoGroupToo){var req=[],unreq=[],m;if(!co)co=function(){}.getCallbackObject(this.Engine,"default");for(var i=0;i<this.Pack.length;i++){m=this.Pack[i];if(m.IsGroupOf(group)||loadMediaWithNoGroupToo&&m.HasNoGroup)req.push(m);else unreq.push(m)}this.Pack=unreq;this.LoadMedia(req,co)};
Anibody.util.Media=function Media(path,codename,group){if(typeof path=="object"){codename=path.codename;group=path.group;path=path.path}this.Path=path;this.Codename=codename;this.HasNoGroup=group?false:true;this.Group=[];if(typeof group=="object")this.Group=this.Group.concat(group);else this.Group=[group||"always"];this.Data;this.DataLoaded=false};Anibody.util.Media.prototype.IsGroupOf=function(group){for(var i=0;i<this.Group.length;i++)if(this.Group[i]==group)return true;return false};
Anibody.util.Media.prototype.AddGroup=function(alias){this.Group.push(alias)};Anibody.util.Picture=function Picture(){Anibody.util.Media.apply(this,arguments)};Anibody.util.Picture.prototype=Object.create(Anibody.util.Media.prototype);Anibody.util.Picture.prototype.constructor=Anibody.util.Picture;Anibody.util.Picture.prototype.Load=function(onload,paras){this.Data=document.createElement("IMG");this.Data.onload=onload;this.Data.Parameters=paras;this.Data.src=this.Path;this.DataLoaded=true};
Anibody.util.Picture.prototype.GetDataURL=function(){var offcan=document.createElement("CANVAS");offcan.width=this.Data.width;offcan.height=this.Data.height;var c=offcan.getContext("2d");c.drawPicture(this.Data,0,0);return offcan.toDataURL()};Anibody.util.Sound=function Sound(){Anibody.util.Media.apply(this,arguments)};Anibody.util.Sound.prototype=Object.create(Anibody.util.Media.prototype);Anibody.util.Sound.prototype.constructor=Anibody.util.Sound;
Anibody.util.Sound.prototype.Load=function(onload,paras){this.Data=document.createElement("AUDIO");this.Data.oncanplay=onload;this.Data.preload=true;this.Data.Parameters=paras;this.Data.src=this.Path;this.DataLoaded=true};Anibody.SetPackage("Anibody","util");
Anibody.util.Storage=function Storage(){if(Anibody.util.Storage.Instance!==null)return Anibody.util.Storage.Instance;Anibody.EngineObject.call(this);this.Pre="AniBody_"+this.Engine.Info.Project;this.BrowserAllowsLocalStorage=false;this._isNotSync=false;this.Object=null;this.ObjectString="";this.Initialize()};Anibody.util.Storage.prototype=Object.create(Anibody.EngineObject.prototype);Anibody.util.Storage.prototype.constructor=Anibody.util.Storage;Anibody.util.Storage.Instance=null;
Anibody.util.Storage.GetInstance=function(){if(Anibody.util.Storage.Instance!==null)return Anibody.util.Storage.Instance;else return new Anibody.util.Storage};
Anibody.util.Storage.prototype.Initialize=function(){if(this._isLocalStorageAvailable())this.BrowserAllowsLocalStorage=true;else this.BrowserAllowsLocalStorage=false;if(this.BrowserAllowsLocalStorage){var str=localStorage[this.Pre];if(!str)this.ObjectString="{}";else this.ObjectString=str}if(this.ObjectString.length<3)this.Object={};else{var str=this.ObjectString;this.Object=JSON.parse(str)}this._isNotSync=false;window.addEventListener("beforeunload",function(e){var st=Anibody.util.Storage.GetInstance();
if(st._isNotSync)st._syncBrowser()});window.addEventListener("unload",function(event){var st=Anibody.util.Storage.GetInstance();if(st._isNotSync)st._syncBrowser()},this);if(Anibody.util.Storage.Instance===null)Anibody.util.Storage.Instance=this};Anibody.util.Storage.prototype._isLocalStorageAvailable=function(){var test=this.Pre+"test"+Date.now();try{localStorage.setItem(test,test);localStorage.removeItem(test);return true}catch(e){return false}};
Anibody.util.Storage.prototype.Read=function(name){var res=this.Object[name];var e;if(res)return res;else{e={code:404,msg:"Storage has no attribute called "+name};this.Engine.HandleError(e);return e}};Anibody.util.Storage.prototype.Write=function(key,val){this.Object[key]=val;this.ObjectString=JSON.stringify(this.Object);this._isNotSync=true;this._syncBrowser();return val};
Anibody.util.Storage.prototype.Delete=function(key){if(arguments.length===0){this.Object={};this.ObjectString="{}"}else try{this.Object[key]="undefined";this._isNotSync=true;this._syncBrowser()}catch(e){e={code:403,msg:"Storage has no attribute called "+key};this.HandleError(e)}};Anibody.util.Storage.prototype._syncBrowser=function(){if(this.BrowserAllowsLocalStorage){localStorage[this.Pre]=this.ObjectString;this._isNotSync=false}};Anibody.SetPackage("Anibody","util");
Anibody.util.Task=function Task(name,desc){this.Name=name||"task";this.Description=desc||"";this.Steps=[];this._stepsDone=[];this._createImages=false;this.CurrentImage=false;this.DoneCallback={that:this,parameter:"default","function":function(p){console.log(this.Name+" done: "+p)}};this.FailedCallback={that:this,parameter:"default","function":function(p){console.log(this.Name+" failed: "+p)}}};
Anibody.util.Task.prototype.IsDone=function(){var done=true;for(var i=0;done&&i<this.Steps.length;i++)if(this.Steps[i].Done||this.Steps[i].Optional)done=true;else done=false;return done};Anibody.util.Task.prototype.SetCallbackWhenDone=function(cbo){this.DoneCallback=cbo};Anibody.util.Task.prototype.SetCallbackWhenFailed=function(cbo){this.FailedCallback=cbo};
Anibody.util.Task.prototype.GetProgress=function(){var steps=0;var stepsDone=0;for(var i=0;i<this.Steps.length;i++)if(!this.Steps[i].Optional){steps++;if(this.Steps[i].Done)stepsDone++}var progress=0;if(steps!==0)progress=stepsDone/steps;return progress};Anibody.util.Task.prototype.HasFailed=function(){for(var i=0;i<this.Steps.length;i++)if(this.Steps[i].Failed&&!this.Steps[i].Optional)return true;return false};
Anibody.util.Task.prototype._check=function(){if(this.IsDone()){var cbo=this.DoneCallback;cbo["function"].call(cbo.that,cbo.parameter);return}if(this.HasFailed()){var cbo=this.FailedCallback;cbo["function"].call(cbo.that,cbo.parameter);return}};
Anibody.util.Task.prototype.AddStep=function(step){var recognized=0;step.Task=this;for(var i=1;i<arguments.length;i++)if(arguments[i]instanceof Step){step.RequiredSteps.push(arguments[i]);recognized++}this.Steps.push(step);if(this._createImages)this._createsImage();return{NumRequiredSteps:arguments.length-1,NumRecognizedSteps:recognized}};
Anibody.util.Task.prototype.createStep=function(id,desc,req_not_met_text,canfail,failtext){if(this.GetStepById(id)){console.log(id+" already exists");return false}var step=new Step(id,desc,req_not_met_text,canfail,failtext);step.Task=this;return step};Anibody.util.Task.prototype.GetStepById=function(id){for(var i=0;i<this.Steps.length;i++)if(this.Steps[i].Id===id)return this.Steps[i];return false};
Anibody.util.Task.prototype.DoStep=function(id){var step=this.GetStepById(id);if(!step)return{step:false,successful:false};var req=step.GetRequiredUndoneSteps();if(req.length===0)step.Done=true;else if(step.CanFail)step.Failed=true;this._check();if(this._createImages)this._createsImage();return{step:step,requiredSteps:req,successful:step.Done,failed:step.Failed}};
Anibody.util.Task.prototype._createsImage=function(){var fontColor="black";var padding=5;var rowspace=3;var width=400;var fh=14;var can=document.createElement("CANVAS");can.width=width;can.height=200;var c=can.getContext("2d");c.setFontHeight(fh);var checkedBallot=decodeURI("%E2%98%91");var uncheckedBallot=decodeURI("%E2%98%90");var cross=decodeURI("%F0%9F%97%99");var texts=[];for(var i=0;i<this.Steps.length;i++)if(this.Steps[i].Done)texts[i]=checkedBallot+" "+this.Steps[i].Description;else if(this.Steps[i].Failed)texts[i]=
cross+" "+this.Steps[i].Description;else texts[i]=uncheckedBallot+" "+this.Steps[i].Description;var allwords=[];var alllengths=[];var spacelen=c.measureText(" ").width;var temp;for(var i=0;i<texts.length;i++){temp=texts[i].split(" ");for(var j=0;j<temp.length;j++){allwords.push(temp[j]);alllengths.push(c.measureText(temp[j]).width)}if(i<texts.length-1){allwords.push("\\n");alllengths.push(0)}}var rows=[];var templen=0;rows.push("");for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+
" ");templen=0+alllengths[i]+spacelen}else if(templen+alllengths[i]+spacelen<width-2*padding){rows[rows.length-1]+=allwords[i]+" ";templen+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);var realHeight=2*padding+fh*rows.length+rowspace*(rows.length-1);can=document.createElement("CANVAS");can.width=width;
can.height=realHeight;c=can.getContext("2d");c.setFontHeight(fh);c.textAlign="left";c.textBaseline="top";c.fillStyle=fontColor;var x=padding;var y=padding;for(var i=0;i<rows.length;i++){c.fillText(rows[i],x,y);y+=fh+rowspace}var url=can.toDataURL();this.CurrentImage=document.createElement("IMG");this.CurrentImage.src=url;var fileName="test.png";var saveImg=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";return function(data,fileName){var url=data;
a.href=url;a.download=fileName;a.click();window.URL.revokeObjectURL(url)}}()};Anibody.util.Step=function Step(id,desc,req_not_met_text,canfail,failtext){if(typeof canfail==="undefined")canfail=false;this.Done=false;this.Failed=false;this.FailText=failtext;this.CanFail=canfail;this.Id=id;this.Task=null;this.Description=desc;this.RequiredSteps=[];this.RequirementNotMetText=req_not_met_text;this.Optional=false};
Anibody.util.Step.prototype.GetRequiredUndoneSteps=function(){var req=[];for(var i=0;i<this.RequiredSteps.length;i++)if(!this.RequiredSteps[i].Done)req.push(this.RequiredSteps[i]);return req};Anibody.SetPackage("Anibody","visual");
Anibody.visual.ABOPresenter=function ABOPresenter(abo){Anibody.Widget.call(this);this.X=0;this.Y=0;this.Width;this.Height;if(abo instanceof Anibody.ABO){this.ABO=abo;this._ready=true}else this._ready=false;this.ContentBox={x:0,y:0,width:0,height:0};this.Rounding=Anibody.visual.ABOPresenter.prototype.DefaultRounding;this.OKBox={x:0,y:0,width:120,height:40};this.IsMouseOverOK=false;this.IsMouseOverContent=false;this.StartFunction=false;this.StopFunction=false;this.Opacity=0;this._ref_mhan=null;this.Initialize()};
Anibody.visual.ABOPresenter.prototype=Object.create(Anibody.Widget.prototype);Anibody.visual.ABOPresenter.prototype.constructor=Anibody.visual.ABOPresenter;Anibody.visual.ABOPresenter.prototype.ContentBoxColor="#999";Anibody.visual.ABOPresenter.prototype.BoxBorderColor="black";Anibody.visual.ABOPresenter.prototype.OKBoxColor="#ccc";Anibody.visual.ABOPresenter.prototype.OKBoxFontColor="#fff";Anibody.visual.ABOPresenter.prototype.OutsideColor="rgba(0,0,0,0.8)";
Anibody.visual.ABOPresenter.prototype.DefaultRounding=10;Anibody.visual.ABOPresenter.prototype.DefaultFontHeight=18;Anibody.visual.ABOPresenter.prototype.Initialize=function(){if(!this._ready)return;this._recalculateSizes()};
Anibody.visual.ABOPresenter.prototype._recalculateSizes=function(){var margin=5;var can=this.Engine.Canvas;this.Width=can.width;this.Height=can.height;this.ContentBox.width=this.ABO.Width;this.ContentBox.height=this.ABO.Height+this.OKBox.height+2*margin;this.ContentBox.x=can.width/2-this.ContentBox.width/2;this.ABO.X=this.ContentBox.x;this.ContentBox.y=can.height/2-this.ContentBox.height/2;this.ABO.Y=this.ContentBox.y;this.OKBox.x=this.ContentBox.x+this.ContentBox.width/2-this.OKBox.width/2;this.OKBox.y=
this.ContentBox.y+this.ContentBox.height-this.OKBox.height-margin};
Anibody.visual.ABOPresenter.prototype.Draw=function(c){c.save();c.globalAlpha=this.Opacity;c.fillStyle=this.OutsideColor;c.fillRect(0,0,c.canvas.width,c.canvas.height);var box=this.ContentBox;c.beginPath();c.variousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.clip();c.fillStyle=this.ContentBoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,box.height,0);this.ABO.Draw(c);c.restore();c.save();var box=this.OKBox;c.fillStyle=this.OKBoxColor;c.fillVariousRoundedRect(box.x,box.y,box.width,
box.height,this.Rounding/3*2);c.setFontHeight(box.height*.5);c.fillStyle=this.OKBoxFontColor;c.fillSpinnedText(box.x+box.width/2,box.y+box.height/2,"Verstanden",0);c.restore();c.save();c.strokeStyle=this.BoxBorderColor;c.lineWidth=5;var box=this.ContentBox;c.strokeVariousRoundedRect(box.x,box.y,box.width,box.height,this.Rounding);c.restore()};
Anibody.visual.ABOPresenter.prototype.ProcessInput=function(){this.ABO.ProcessInput();var box=this.ContentBox;var area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect",background:true};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverContent");box=this.OKBox;area={x:box.x,y:box.y,width:box.width,height:box.height,rounding:0,type:"rrect"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverOK")};
Anibody.visual.ABOPresenter.prototype.Update=function(){this.ABO.Update();this._recalculateSizes();if(this.IsMouseOverOK)this.Engine.Input.Mouse.Cursor.Set("pointer")};Anibody.visual.ABOPresenter.prototype._createMouseHandlerObject=function(){var f=function(e){e.Handled=true;if(this.IsMouseOverOK)this.Stop();if(!this.IsMouseOverContent)this.Stop()};return{that:this,"function":f,parameter:this.Engine}};
Anibody.visual.ABOPresenter.prototype.Start=function(abostartfunc,abostopfunc){this.Active=true;var found=false;var abo=this.ABO;if(typeof abostartfunc!=="undefined"){this.StartFunction=abostartfunc;Anibody.CallObject(abostartfunc);found=true}if(!found&&this.StartFunction)Anibody.CallObject(this.StartFunction);if(typeof abostopfunc!=="undefined")this.StopFunction=abostopfunc;(new Anibody.util.Flow(this,"Opacity",1,600,{that:this,parameter:true,"function":function(p){}})).Start();this.Register();var mhand=
this._createMouseHandlerObject();this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",mhand)};Anibody.visual.ABOPresenter.prototype.Stop=function(){this.Active=false;if(this.StopFunction)Anibody.CallObject(this.StopFunction);this.Deregister();this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);this._ref_mhan=null};Anibody.visual.ABOPresenter.prototype.SetStartFunction=function(startcbo){this.StartFunction=startcbo};
Anibody.visual.ABOPresenter.prototype.SetStopFunction=function(stopcbo){this.StopFunction=stopcbo};
Anibody.visual.Animation=function Animation(x,y,codename,numpics,jumpms,reverseAfter){Anibody.ABO.call(this);this.Type="Animation";if(typeof reverseAfter==="undefined")reverseAfter=false;this.Direction="left";this.ReverseAfter=reverseAfter;this._countingUp=true;this.Active=false;this.X=x;this.Y=y;this.FullImage;this.Width=0;this.Height=0;this.Images=[];this.ImageIndex=0;this.NumberOfPictures=numpics;this.MS=jumpms;this.Scale=1;this.Codename=codename;this.Active=false;this.Infinite=true;this.Iterations=
0;this.CallbackObject={that:this,"function":function(p){},parameter:"default"};this.MaxIterations=false;this._ref=null;this.Initialize()};Anibody.visual.Animation.prototype=Object.create(Anibody.ABO.prototype);Anibody.visual.Animation.prototype.constructor=Anibody.visual.Animation;Object.defineProperty(Anibody.visual.Animation.prototype,"Image",{get:function(){return this.Images[this.ImageIndex=0]}});
Anibody.visual.Animation.prototype.Initialize=function(){this.FullImage=this.Engine.MediaManager.GetImage(this.Codename);if(this.FullImage)if(this.Direction=="left"){this.Height=this.FullImage.height;this.Width=this.FullImage.width/this.NumberOfPictures;var can=document.createElement("CANVAS");can.width=this.Width;can.height=this.Height;var c=can.getContext("2d");var url;for(var i=0;i<this.NumberOfPictures;i++){c.clearRect(0,0,can.width,can.height);c.drawImage(this.FullImage,can.width*i,0,can.width,
can.height,0,0,can.width,can.height);url=can.toDataURL();this.Images[i]=document.createElement("IMG");this.Images[i].src=url}}};Anibody.visual.Animation.prototype.Draw=function(c){if(!this.FullImage||!this.Active)return;c.drawImage(this.Images[this.ImageIndex],this.X,this.Y,this.Width,this.Height)};Anibody.visual.Animation.prototype.Update=function(){if(!this.FullImage)this.Initialize();if(!this.Infinite&&this.Iterations>=this.MaxIterations)this.Stop()};
Anibody.visual.Animation.prototype.Start=function(){this.Active=true;this.ImageIndex=0;this.SetIntervalFunction()};Anibody.visual.Animation.prototype.Stop=function(){this.Active=false;this.ClearIntervalFunction();Anibody.CallObject(this.CallbackObject)};Anibody.visual.Animation.prototype.SetCallbackObject=function(cbo){this.CallbackObject=cbo};
Anibody.visual.Animation.prototype.SetIntervalFunction=function(){var f=function(that){if(that._countingUp)that.ImageIndex++;else that.ImageIndex--;if(that.ImageIndex>=that.NumberOfPictures-1)if(that.ReverseAfter)that._countingUp=false;else{that.Iterations++;that.ImageIndex=0}if(that.ImageIndex<=0&&!that._countingUp){that.Iterations++;that.ImageIndex=0;that._countingUp=true}};this._ref=window.setInterval(f,this.MS,this)};Anibody.visual.Animation.prototype.ClearIntervalFunction=function(){window.clearInterval(this._ref)};
Anibody.visual.Animation.prototype.SetMaxIterations=function(i){this.MaxIterations=i;this.Infinite=false};Anibody.visual.ImageObject=function ImageObject(codename,x,y){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Codename=codename;this.Image=false;this.Width=0;this.Height=0;if(arguments.length>3)this.Scale=arguments[3];else this.Scale=1;this.Initialize()};Anibody.visual.ImageObject.prototype=Object.create(Anibody.ABO.prototype);Anibody.visual.ImageObject.prototype.constructor=Anibody.visual.ImageObject;
Anibody.visual.ImageObject.prototype.Initialize=function(){if(typeof this.Codename==="string")this.Image=this.Engine.MediaManager.GetImage(this.Codename);else this.Image=this.Codename;this.Width=this.Image.width;this.Height=this.Image.height};
Anibody.visual.ImageObject.prototype.Draw=function(c){var cam=this.Engine.Camera.SelectedCamera;if(this.Image)c.drawImage(this.Image,this.X-cam.X,this.Y-cam.Y,this.Image.width*this.Scale,this.Image.height*this.Scale);else c.fillRect(this.X-cam.X,this.Y-cam.Y,this.Image.width*this.Scale,this.Image.height*this.Scale)};Anibody.visual.ImageObject.prototype.Update=function(){if(this.Width===0||this.Height===0){this.Width=this.Image.width;this.Height=this.Image.height}};
Anibody.visual.ImageObject.prototype.FlowScale=function(to){};Anibody.visual.ImageObject.prototype.FlowMove=function(tox,toy){};Anibody.visual.ABText=function ABText(txt,x,y,fh){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=false;this.Height=false;this.Text=txt;this.TextWidth=0;this.FontHeight=fh||20;this.Underline=false;this.TextAlign="left";this.TextBaseline="top";this.Color=ABText.prototype.DefaultFontColor;this.Initialize()};Anibody.visual.ABText.prototype=Object.create(Anibody.ABO.prototype);
Anibody.visual.ABText.prototype.constructor=Anibody.visual.ABText;Anibody.visual.ABText.prototype.DefaultFontColor="black";Anibody.visual.ABText.prototype.Initialize=function(){this.Resize()};Anibody.visual.ABText.prototype.Resize=function(){this.Height=this.FontHeight;var c=this.Engine.Context;c.save();c.setFontHeight(this.FontHeight);this.TextWidth=c.measureText(this.Text).width;this.Width=this.TextWidth;c.restore()};
Anibody.visual.ABText.prototype.Draw=function(c){c.save();c.setFontHeight(this.FontHeight);c.textAlign=this.TextAlign;c.textBaseline=this.TextBaseline;c.fillStyle=this.Color;c.fillText(this.Text,this.X,this.Y);if(this.Underline){var offx=0;var offy=0;if(this.TextBaseline==="middle")offy-=this.Height/2;if(this.TextBaseline==="bottom")offy-=this.Height;if(this.TextAlign==="center")offx=0-this.Width/2;if(this.TextAlign==="right")offx=0-this.Width;c.lineWidth=this.FontHeight/15;c.strokeStyle=this.Color;
c.beginPath();c.moveTo(this.X+offx,this.Y+this.Height+offy);c.lineTo(this.X+this.Width+offx,this.Y+this.Height+offy);c.stroke();c.closePath()}c.restore()};Anibody.visual.ABText.prototype.SetText=function(txt){this.Text=txt;this.Resize()};Anibody.visual.ABText.prototype.FlowResize=function(to,ms,cbo){(new Anibody.util.Flow(this,"FontHeight",to,ms,cbo,function(){this.Resize()}.getCallbackObject(this))).Start()};
Anibody.visual.ABText.prototype.FlowMove=function(tox,toy,ms,cbo){(new Anibody.util.MultiFlow([this,this],["X","Y"],[tox,toy],ms,cbo)).Start()};Anibody.SetPackage("Anibody","visual");
Anibody.visual.CoordinateSystem=function CoordinateSystem(x,y,w,h,opt){Anibody.ABO.call(this);this.X=x;this.Y=y;this.Width=w;this.Height=h;this.Options=opt;this.Nullpoint={x:20,y:this.Height-20};this.Mouse={x:0,y:0};this.SI={x:0,y:0};this.IsMouseOver=false;this.OnClickCBO={"function":function(){},parameter:{},that:this};this.PixelPerScale=15;this._drawLimit={Xpos:500,Xneg:500,Ypos:500,Yneg:500};this._markLimit={Xpos:25,Xneg:25,Ypos:20,Yneg:20};this._drawAxis=true;this._drawScaleMarks=true;this._drawScaleLines=
true;this.BorderColor="#000000";this.BorderThickness=1;this.ScaleMarkLength=[6,12,14];this.ScaleMarkThickness=[1,1.25,1.5];this.ScaleMarkColor=["#666","#444","#222"];this.ScaleLineColor="rgba(73,73,73,0.3)";this.OldFramesDown=0;this.Initialize()};Anibody.visual.CoordinateSystem.prototype=Object.create(Anibody.ABO.prototype);Anibody.visual.CoordinateSystem.prototype.constructor=Anibody.visual.CoordinateSystem;
Anibody.visual.CoordinateSystem.prototype.Initialize=function(){this.AddMouseHandler();var opt=this.Options;if(opt!="undefined")for(var key in opt)if(this[key]!="undefined")this[key]=opt[key]};Anibody.visual.CoordinateSystem.prototype.AddMouseHandler=function(){this._ref=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{parameter:this.Engine,that:this,"function":function(e,engine){if(this.IsMouseOver){e.Handled=true;var c=this.OnClickCBO;c["function"].call(c.that,c.parameter)}}},10)};
Anibody.visual.CoordinateSystem.prototype.RemoveMouseHandler=function(){this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref)};
Anibody.visual.CoordinateSystem.prototype.Draw=function(c){c.save();if(this.BorderThickness>0){c.strokeStyle=this.BorderColor;c.lineWidth=this.BorderThickness;c.strokeRect(this.X,this.Y,this.Width,this.Height)}this.Clip(c);var curnp={x:this.X+this.Nullpoint.x,y:this.Y+this.Nullpoint.y};if(this._drawAxis){c.beginPath();c.moveTo(curnp.x,curnp.y-this._drawLimit.Ypos);c.lineTo(curnp.x,curnp.y+this._drawLimit.Yneg);c.stroke();c.closePath();c.beginPath();c.moveTo(curnp.x-this._drawLimit.Xneg,curnp.y);c.lineTo(curnp.x+
this._drawLimit.Xpos,curnp.y);c.stroke();c.closePath()}if(this._drawScaleMarks){var linestart;var marknr;for(var i=1;i<=this._markLimit.Xpos;i++){marknr=0;if(i%5==0){marknr=1;if(i%10==0)marknr=2}c.lineWidth=this.ScaleMarkThickness[marknr];c.strokeStyle=this.ScaleMarkColor[marknr];linestart=curnp.x+i*this.PixelPerScale;c.beginPath();c.moveTo(linestart,curnp.y);c.lineTo(linestart,curnp.y-this.ScaleMarkLength[marknr]);c.stroke();c.closePath()}for(var i=1;i<=this._markLimit.Xneg;i++){marknr=0;if(i%5==
0){marknr=1;if(i%10==0)marknr=2}c.lineWidth=this.ScaleMarkThickness[marknr];c.strokeStyle=this.ScaleMarkColor[marknr];linestart=curnp.x-i*this.PixelPerScale;c.beginPath();c.moveTo(linestart,curnp.y);c.lineTo(linestart,curnp.y-this.ScaleMarkLength[marknr]);c.stroke();c.closePath()}for(var i=1;i<=this._markLimit.Ypos;i++){marknr=0;if(i%5==0){marknr=1;if(i%10==0)marknr=2}c.lineWidth=this.ScaleMarkThickness[marknr];c.strokeStyle=this.ScaleMarkColor[marknr];linestart=curnp.y-i*this.PixelPerScale;c.beginPath();
c.moveTo(curnp.x,linestart);c.lineTo(curnp.x+this.ScaleMarkLength[marknr],linestart);c.stroke();c.closePath()}for(var i=1;i<=this._markLimit.Yneg;i++){marknr=0;if(i%5==0){marknr=1;if(i%10==0)marknr=2}c.lineWidth=this.ScaleMarkThickness[marknr];c.strokeStyle=this.ScaleMarkColor[marknr];linestart=curnp.y+i*this.PixelPerScale;c.beginPath();c.moveTo(curnp.x,linestart);c.lineTo(curnp.x+this.ScaleMarkLength[marknr],linestart);c.stroke();c.closePath()}}if(this._drawScaleLines){var linestart;var marknr;var istart=
this._drawAxis?1:0;for(var i=istart;i<=this._markLimit.Xpos;i++){linestart=curnp.x+i*this.PixelPerScale;c.lineWidth=1;c.strokeStyle=this.ScaleLineColor;c.beginPath();c.moveTo(linestart,curnp.y-this._drawLimit.Ypos);c.lineTo(linestart,curnp.y+this._drawLimit.Yneg);c.stroke();c.closePath()}for(var i=1;i<=this._markLimit.Xneg;i++){c.lineWidth=1;c.strokeStyle=this.ScaleLineColor;linestart=curnp.x-i*this.PixelPerScale;c.beginPath();c.moveTo(linestart,curnp.y-this._drawLimit.Ypos);c.lineTo(linestart,curnp.y+
this._drawLimit.Yneg);c.stroke();c.closePath()}for(var i=istart;i<=this._markLimit.Ypos;i++){c.lineWidth=1;c.strokeStyle=this.ScaleLineColor;linestart=curnp.y-i*this.PixelPerScale;c.beginPath();c.moveTo(curnp.x-this._drawLimit.Xneg,linestart);c.lineTo(curnp.x+this._drawLimit.Xpos,linestart);c.stroke();c.closePath()}for(var i=1;i<=this._markLimit.Yneg;i++){c.lineWidth=1;c.strokeStyle=this.ScaleLineColor;linestart=curnp.y+i*this.PixelPerScale;c.beginPath();c.moveTo(curnp.x-this._drawLimit.Xneg,linestart);
c.lineTo(curnp.x+this._drawLimit.Xpos,linestart);c.stroke();c.closePath()}}c.restore()};Anibody.visual.CoordinateSystem.prototype.Update=function(){var mpos=this.Engine.Input.Mouse.Position.Relative;var np=this.Nullpoint;var ppmm=this.PixelPerScale;this.Mouse.x=mpos.X-(np.x+this.X);this.Mouse.y=-1*(mpos.Y-(np.y+this.Y));this.SI.x=Math.round(this.Mouse.x/ppmm*100)/100;this.SI.y=Math.round(this.Mouse.y/ppmm*100)/100};
Anibody.visual.CoordinateSystem.prototype.ProcessInput=function(){var area=this.GetArea();this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOver")};Anibody.visual.CoordinateSystem.prototype.Move=function(dx,dy){this.Nullpoint.x+=dx;this.Nullpoint.y+=dy;this.UpdateLimit()};Anibody.visual.CoordinateSystem.prototype.Center=function(){this.Nullpoint={x:this.Width/2,y:this.Height/2};this.UpdateLimit()};Anibody.visual.CoordinateSystem.prototype.GetSI=function(){return{x:this.SI.x,y:this.SI.y}};
Anibody.visual.CoordinateSystem.prototype.GetCoords=function(){return{x:this.Mouse.x,y:this.Mouse.y}};
Anibody.visual.CoordinateSystem.prototype.UpdateLimit=function(){var dis1D=function(v1,v2){return Math.sqrt(Math.pow(v2-v1,2))};var ppmm=this.PixelPerScale;var np=this.Nullpoint;var xnegnp,xposnp,ynegnp,yposnp;xnegnp=dis1D(this.X,this.X+np.x);var xneg=Math.floor(xnegnp/ppmm);yposnp=dis1D(this.Y,this.Y+np.y);var ypos=Math.floor(yposnp/ppmm);xposnp=dis1D(this.X+np.x,this.X+this.Width);var xpos=Math.floor(xposnp/ppmm);ynegnp=dis1D(this.Y+np.y,this.Y+this.Height);var yneg=Math.floor(ynegnp/ppmm);this._drawLimit=
{Xpos:xposnp,Xneg:xnegnp,Ypos:yposnp,Yneg:ynegnp};this._markLimit={Xpos:xpos,Xneg:xneg,Ypos:ypos,Yneg:yneg}};Anibody.visual.CoordinateSystem.prototype.Clip=function(c){c.beginPath();c.rect(this.X,this.Y,this.Width,this.Height);c.closePath();c.clip()};Anibody.visual.CoordinateSystem.prototype.SetOnClick=function(that,f,para){if(arguments.length>1)this.OnClickCBO={that:that,"function":f,parameter:para||true};else this.OnClickCBO=that};
Anibody.visual.CoordinateSystem.prototype.SetNullpoint=function(x,y){this.Nullpoint.x=x;this.Nullpoint.y=y;this.UpdateLimit()};Anibody.SetPackage("Anibody","visual");
Anibody.visual.Highlighting=function Highlighting(area,flow_ms,ms,cbo){Anibody.Widget.call(this);this.X=area.x;this.Y=area.y;this.Width=area.width||area.radius*2;this.Height=area.height||area.radius*2;this.Rounding=area.rounding||0;this.Roundings=area.roundings||[area.rounding,area.rounding,area.rounding,area.rounding];this.Radius=area.radius||0;this.CallbackAreaFunction=area["function"];this.Type=area.type||"vrrect";this.Title="";this.TitleFontHeight=26;this.Opacity=0;this.IsMouseOverCanvas=false;
this.Padding=Anibody.visual.Highlighting.prototype.DefaultPadding;this.RowSpace=Anibody.visual.Highlighting.prototype.DefaultRowSpace;this.FontHeight=Anibody.visual.Highlighting.prototype.DefaultFontHeight;this.TextImage=false;this.TextImageBox={x:0,y:0,width:0,height:0};this._text;this.CallbackObject=cbo||{that:this,"function":function(){return},parameter:"default"};this.FlowMilliseconds=flow_ms;this.Milliseconds=ms+this.FlowMilliseconds;this._ref_mhan=null;this._ref_timeout=null;this._ref_pifo=
null;this._instructionMode=false};Anibody.visual.Highlighting.prototype=Object.create(Anibody.Widget.prototype);Anibody.visual.Highlighting.prototype.constructor=Anibody.visual.Highlighting;Anibody.visual.Highlighting.prototype.OutsideColor="rgba(0,0,0,0.8)";Anibody.visual.Highlighting.prototype.TitleColor="white";Anibody.visual.Highlighting.prototype.TextBoxBackgroundColor="black";Anibody.visual.Highlighting.prototype.TextBoxFontColor="white";
Anibody.visual.Highlighting.prototype.DefaultPadding=8;Anibody.visual.Highlighting.prototype.DefaultRowSpace=5;Anibody.visual.Highlighting.prototype.DefaultFontHeight=14;
Anibody.visual.Highlighting.prototype.Start=function(cbo){this.Register();(new Anibody.util.Flow(this,"Opacity",1,this.FlowMilliseconds,{that:this,"function":function(){}})).Start();if(typeof cbo==="object")this.CallbackObject=cbo;var closef=function(high){window.clearTimeout(high._ref_timeout);high.Stop()};this._ref_mhan=this.Engine.Input.MouseHandler.AddMouseHandler("leftclick",{that:this,"function":function(){closef(this)}});if(!this._instructionMode)this._ref_timeout=window.setTimeout(closef,
this.Milliseconds,this)};Anibody.visual.Highlighting.prototype.Stop=function(){this.Deregister();this.Opacity=0;this.Engine.Input.MouseHandler.RemoveMouseHandler("leftclick",this._ref_mhan);Anibody.CallObject(this.CallbackObject)};Anibody.visual.Highlighting.prototype.ProcessInput=function(){var area={"function":function(c){c.rect(0,0,c.canvas.width,c.canvas.height)},type:"function"};this.Engine.Input.MouseHandler.AddHoverRequest(area,this,"IsMouseOverCanvas")};
Anibody.visual.Highlighting.prototype.Draw=function(c){var can=this.Engine.Canvas;c.save();c.globalAlpha=this.Opacity;c.beginPath();c.fillStyle=this.OutsideColor;c.moveTo(0,0);c.lineTo(0,can.height);c.lineTo(can.width,can.height);c.lineTo(can.width,0);c.lineTo(0,0);var found=false;if(!found&&this.Type==="rect"){c.rect(this.X,this.Y,this.Width,this.Height);found=true}if(!found&&this.Type==="rrect"){c.variousRoundedRect(this.X,this.Y,this.Width,this.Height,this.Rounding);found=true}if(!found&&this.Type===
"vrrect"){var r=this.Roundings;c.variousRoundedRect(this.X,this.Y,this.Width,this.Height,r[0]||0,r[1]||0,r[2]||0,r[3]||0);found=true}if(!found&&this.Type==="circle"){c.circle(this.X,this.Y,this.Radius,true);found=true}if(!found&&this.Type==="function"){Anibody.CallObject(this.CallbackAreaFunction);found=true}c.fill();if(this.TextImage){var b=this.TextImageBox;c.drawImage(this.TextImage,b.x,b.y)}c.fillStyle=this.TitleColor;c.setFontHeight(this.TitleFontHeight);c.textAlign="left";c.textBaseline="top";
c.fillText(this.Title,10,10);c.restore()};
Anibody.visual.Highlighting.prototype.SetText=function(texts,position,relpoint){this._text=texts;if(typeof texts==="string")texts=[texts];var can=this.Engine.Canvas;var c=this.Engine.Context;var padding=this.Padding;var rowspace=this.RowSpace;var fontheight=this.FontHeight;this.TextImageBox.width=Math.round(can.width/3);var width=this.TextImageBox.width;c.setFontHeight(fontheight);var allwords=[];var alllengths=[];var spacelen=c.measureText(" ").width;var rows=[];var temp;for(var i=0;i<texts.length;i++){temp=
texts[i].split(" ");for(var j=0;j<temp.length;j++){allwords.push(temp[j]);alllengths.push(c.measureText(temp[j]).width)}if(i<texts.length-1){allwords.push("\\n");alllengths.push(0)}}rows=[];var templen=0;rows.push("");for(var i=0;i<allwords.length;i++)if(allwords[i]==="\\n"){i++;rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}else if(templen+alllengths[i]+spacelen<width-2*padding){rows[rows.length-1]+=allwords[i]+" ";templen+=alllengths[i]+spacelen}else{rows[rows.length-1]=rows[rows.length-
1].substr(0,rows[rows.length-1].length-1);rows.push(allwords[i]+" ");templen=0+alllengths[i]+spacelen}rows[rows.length-1]=rows[rows.length-1].substr(0,rows[rows.length-1].length-1);this.TextImageBox.height=2*padding+fontheight*rows.length+rowspace*rows.length-1;var off=document.createElement("CANVAS");off.width=this.TextImageBox.width;off.height=this.TextImageBox.height;var coff=off.getContext("2d");coff.setFontHeight(fontheight);coff.fillStyle=this.TextBoxBackgroundColor;coff.fillRect(0,0,off.width,
off.height);coff.textAlign="left";coff.textBaseline="top";coff.fillStyle=this.TextBoxFontColor;coff.strokeStyle=this.TextBoxFontColor;var x=padding;var y=padding;for(var i=0;i<rows.length;i++){coff.fillText(rows[i],x,y);y+=fontheight+rowspace}var url=off.toDataURL();this.TextImage=document.createElement("IMG");this.TextImage.src=url;this._calculateBestTextPosition(position,relpoint)};Anibody.visual.Highlighting.prototype.AddText=function(texts,position,relpoint){this.SetText(texts,position,relpoint)};
Anibody.visual.Highlighting.prototype._calculateBestTextPosition=function(p,rel){var can=this.Engine.Canvas;var center={x:can.width/2,y:can.height/2};var p1,p2,p3,p4;if(this.Type==="circle"){p1={x:this.X-this.Radius,y:this.Y-this.Radius};p2={x:this.X+this.Radius,y:this.Y-this.Radius};p3={x:this.X+this.Radius,y:this.Y+this.Radius};p4={x:this.X-this.Radius,y:this.Y+this.Radius}}else{p1={x:this.X,y:this.Y};p2={x:this.X+this.Width,y:this.Y};p3={x:this.X+this.Width,y:this.Y+this.Height};p4={x:this.X,y:this.Y+
this.Height}}if(p)switch(rel){case 1:{this.TextImageBox.x=p1.x+p.x;this.TextImageBox.y=p1.y+p.y;return}case 2:{this.TextImageBox.x=p2.x+p.x;this.TextImageBox.y=p2.y+p.y;return}case 3:{this.TextImageBox.x=p3.x+p.x;this.TextImageBox.y=p3.y+p.y;return}case 4:{this.TextImageBox.x=p4.x+p.x;this.TextImageBox.y=p4.y+p.y;return}default:{this.TextImageBox.x=p3.x+p.x;this.TextImageBox.y=p3.y+p.y;return}}var cpx=(p1.x+p2.x+p3.x+p4.x)/4;var cpy=(p1.y+p2.y+p3.y+p4.y)/4;cpx-=center.x;cpy-=center.y;if(cpx>0&&cpy>
0){this.TextImageBox.x=p1.x-this.TextImageBox.width-10;this.TextImageBox.y=p1.y-this.TextImageBox.height-10}if(cpx>0&&cpy<0){this.TextImageBox.x=p4.x-this.TextImageBox.width-10;this.TextImageBox.y=p4.y+10}if(cpx<=0&&cpy>=0){this.TextImageBox.x=p2.x+10;this.TextImageBox.y=p2.y-this.TextImageBox.height-10}if(cpx<=0&&cpy<=0){this.TextImageBox.x=p3.x+10;this.TextImageBox.y=p3.y+10}if(this.TextImageBox.x<0)this.TextImageBox.x=0;if(this.TextImageBox.y<0)this.TextImageBox.y=0;if(this.TextImageBox.x+this.TextImageBox.width>
can.width)this.TextImageBox.x=can.width-this.TextImageBox.width;if(this.TextImageBox.y+this.TextImageBox.height>can.height)this.TextImageBox.y=can.height-this.TextImageBox.height};Anibody.visual.Highlighting.prototype.AddTitle=function(text,fh){this.Title=text;this.TitleFontHeight=fh||26};Anibody.visual.Highlighting.prototype.IncreaseArea=function(inc){if(this.Type==="circle")this.Radius+=inc;else{this.Width+=2*inc;this.Height+=2*inc;this.X-=inc;this.Y-=inc}};
Anibody.visual.Highlighting.prototype.RoundingArea=function(r){this.Rounding=r;this.Type="rrect"};Anibody.visual.Highlighting.prototype.MoveArea=function(dx,dy){this.X+=dx;this.Y+=dy};Anibody.visual.Highlighting.prototype.AddCallbackObject=function(cbo){this.CallbackObject=cbo};Anibody.visual.Highlighting.prototype.SetInstructionMode=function(bool,title){this._instructionMode=bool;if(bool&&typeof title!=="undefined")this.AddTitle(title)};Anibody.SetPackage("Anibody","visual");
Anibody.visual.Spline=function Spline(){Anibody.ABO.call(this);this.Canvas={width:this.Engine.Canvas.width,height:this.Engine.Canvas.height};this.Points=[];this._pointsStack=[];this.FirstControlPoints=false;this.SecondControlPoints=false;this.Color="black";this.LineWidth=3;this._useDashedLine=false;this._dashedLineValues=[0,0];this._close=false;this.DrawPoints=false;this.FilteredImage=false;this.Initialize()};Anibody.visual.Spline.prototype=Object.create(Anibody.ABO.prototype);
Anibody.visual.Spline.prototype.constructor=Anibody.visual.Spline;Anibody.visual.Spline.prototype.Initialize=function(){};Anibody.visual.Spline.prototype.AddPoint=function(porx,y){var p;if(typeof porx==="number")p={x:porx,y:y};else p=porx;this.Points.push(p);this._pointsStack.push(p);this._updatePoints()};Anibody.visual.Spline.prototype.RemoveLastPoint=function(){if(this.Points.length===0)return;var rem=this._pointsStack.pop();var ind=this.Points.getIndex(rem);this.Points["delete"](ind);this._updatePoints()};
Anibody.visual.Spline.prototype.Draw=function(c){c.save();var p1,cp1,cp2,p2;if(this.Points.length>=2){c.lineJoin="round";if(this._useDashedLine)c.setLineDash(this._dashedLineValues);c.strokeStyle=this.Color;c.lineWidth=this.LineWidth;c.lineCap="butt";for(var i=0;i<this.Points.length-1;i++){p1=this.Points[i];cp1=this.FirstControlPoints[i];cp2=this.SecondControlPoints[i];p2=this.Points[i+1];c.beginPath();c.moveTo(p1.x,p1.y);c.bezierCurveTo(cp1.x,cp1.y,cp2.x,cp2.y,p2.x,p2.y);c.stroke()}if(this._close){var endi=
this.Points.length-1;p1=this.Points[endi];cp1=this.FirstControlPoints[endi];cp2=this.SecondControlPoints[endi];p2=this.Points[0];c.beginPath();c.moveTo(p1.x,p1.y);c.bezierCurveTo(cp1.x,cp1.y,cp2.x,cp2.y,p2.x,p2.y);c.stroke()}}if(this.DrawPoints){c.strokeStyle="black";c.lineWidth=1.5;for(var i=0;i<this.Points.length;i++)c.drawCross(this.Points[i].x,this.Points[i].y,6)}c.restore()};Anibody.visual.Spline.prototype.Update=function(){};
Anibody.visual.Spline.prototype.SetDash=function(active,length,space){if(typeof active!=="boolean")active=false;if(isNaN(length))length=10;if(isNaN(space))space=6;this._useDashedLine=active;this._dashedLineValues=[length,space]};
Anibody.visual.Spline.prototype._createImage=function(){var can=document.createElement("CANVAS");can.width=this.Canvas.width;can.height=this.Canvas.height;var c=can.getContext("2d");var p1,cp1,cp2,p2;c.lineCap="round";c.strokeStyle=getRGBA(this.Color,1,.75);c.lineWidth=8;c.filter="blur(4px)";if(this.Points.length>=2){c.lineJoin="round";if(this._useDashedLine)c.setLineDash(this._dashedLineValues);for(var i=0;i<this.Points.length-1;i++){p1=this.Points[i];cp1=this.FirstControlPoints[i];cp2=this.SecondControlPoints[i];
p2=this.Points[i+1];c.beginPath();c.moveTo(p1.x,p1.y);c.bezierCurveTo(cp1.x,cp1.y,cp2.x,cp2.y,p2.x,p2.y);c.stroke()}}var url=can.toDataURL();this.FilteredImage=document.createElement("IMG");this.FilteredImage.src=url};Anibody.visual.Spline.prototype.SetColor=function(color){this.Color=color};
Anibody.visual.Spline.prototype.CircularSort=function(base,sortGap){if(typeof resultGap!=="string")resultGap="right";for(var i=0;i<this.Points.length;i++){this.Points[i]._angleRadian=this._getAngle(base,this.Points[i],sortGap);this.Points[i]._angleDegree=this.Points[i]._angle*180/Math.PI}this.Points.sort(function(a,b){return a._angleRadian>b._angleRadian?1:-1});this._updatePoints()};Anibody.visual.Spline.prototype._updatePoints=function(){this._calculateCurveControlPoints()};
Anibody.visual.Spline.prototype._getAngle=function(base,p,resultGap){var dx,dy,val;if(typeof resultGap!=="string")resultGap="right";if(resultGap==="top"||resultGap==="bottom"){if(resultGap==="top"){dx=base.x-p.x;dy=base.y-p.y}if(resultGap==="bottom"){dx=p.x-base.x;dy=p.y-base.y}val=Math.atan2(dx,dy)}if(resultGap==="left"||resultGap==="right"){if(resultGap==="left"){dx=base.x-p.x;dy=base.y-p.y}if(resultGap==="right"){dx=p.x-base.x;dy=p.y-base.y}val=Math.atan2(dy,dx)}var atan2_correction=function(atan2){return atan2<
0?Math.PI+(Math.PI+atan2):atan2};return atan2_correction(val)};Anibody.visual.Spline.prototype._getDistance=function(base,p){var dx=p.x-base.x;var dy=p.y-base.y;return Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2))};
Anibody.visual.Spline.prototype._calculateCurveControlPoints=function(){if(this.Points.length<=1)return;var firstControlPoints=[];var secondControlPoints=[];if(this.Points.length===2){firstControlPoints.push({x:this.Points[1].x,y:this.Points[1].y});secondControlPoints.push({x:this.Points[1].x,y:this.Points[1].y});this.FirstControlPoints=firstControlPoints;this.SecondControlPoints=secondControlPoints;return}var knots=[];for(var i=0;i<this.Points.length;i++)knots.push({x:this.Points[i].x,y:this.Points[i].y});
if(this._close)knots.push({x:this.Points[0].x,y:this.Points[0].y});var n=knots.length-1;var rhs=[];for(var i=1;i<n-1;i++)rhs[i]=4*knots[i].x+2*knots[i+1].x;rhs[0]=knots[0].x+2*knots[1].x;rhs[n-1]=(8*knots[n-1].x+knots[n].x)/2;var x=this._getFirstControlPoints(rhs);for(var i=1;i<n-1;i++)rhs[i]=4*knots[i].y+2*knots[i+1].y;rhs[0]=knots[0].y+2*knots[1].y;rhs[n-1]=(8*knots[n-1].y+knots[n].y)/2;var y=this._getFirstControlPoints(rhs);for(var i=0;i<n;i++){firstControlPoints[i]={x:x[i],y:y[i]};if(i<n-1)secondControlPoints[i]=
{x:2*knots[i+1].x-x[i+1],y:2*knots[i+1].y-y[i+1]};else secondControlPoints[i]={x:(knots[n].x+x[n-1])/2,y:(knots[n].y+y[n-1])/2}}this.FirstControlPoints=firstControlPoints;this.SecondControlPoints=secondControlPoints};Anibody.visual.Spline.prototype._getFirstControlPoints=function(rhs){var n=rhs.length;var x=[];var tmp=[];var b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++){tmp[i]=1/b;b=(i<n-1?4:3.5)-tmp[i];x[i]=(rhs[i]-x[i-1])/b}for(var i=1;i<n;i++)x[n-i-1]-=tmp[n-i]*x[n-i];return x};
Anibody.visual.Spline.prototype.SetCloseSpline=function(state){this._close=state};Anibody.SetPackage("Anibody","visual");Anibody.visual.Spotting=function Spotting(area,ms){Anibody.Widget.call(this);this.Area=area;this.X=0;this.Y=0;this.Width=0;this.Height=0;this.Following=false;this._instance=null;this._attr=null;this.Radius=[];this.MinRadius=0;this.Color=Anibody.visual.Spotting.prototype.DefaultColor;this.Milliseconds=ms;this.NumberCircles=3;this._ref_dfo=null;this.Initialize()};
Anibody.visual.Spotting.prototype=Object.create(Anibody.Widget.prototype);Anibody.visual.Spotting.prototype.constructor=Anibody.visual.Spotting;Anibody.visual.Spotting.prototype.DefaultColor="red";Anibody.visual.Spotting.prototype.Initialize=function(){this._getSpot(this.Area);var startR=Math.max(this.X,this.Y,this.Engine.Canvas.width-this.X,this.Engine.Canvas.height-this.Y);for(var i=0;i<this.NumberCircles;i++)this.Radius[i]=startR+i*40};
Anibody.visual.Spotting.prototype._getSpot=function(a){if(a.type==="circle"){this.X=a.x;this.Y=a.y;this.MinRadius=a.radius}else{this.X=a.x+a.width/2;this.Y=a.y+a.height/2;this.MinRadius=(a.width+a.height)/4}};
Anibody.visual.Spotting.prototype.Start=function(cbo){this.Register();var endf=function(that,cbo){that.Deregister();Anibody.CallObject(cbo)};(new Anibody.util.MultiFlow([this.Radius,this.Radius,this.Radius],["0","1","2"],[this.MinRadius,this.MinRadius,this.MinRadius],this.Milliseconds)).Start();window.setTimeout(endf,this.Milliseconds+100,this,cbo)};
Anibody.visual.Spotting.prototype.Draw=function(c){c.save();c.strokeStyle=this.Color;c.lineWidth=2.5;c.beginPath();for(var i=0;i<this.NumberCircles;i++)c.circle(this.X,this.Y,this.Radius[i],true);c.stroke();c.restore()};Anibody.SetPackage("Anibody","visual");
Anibody.visual.Sprite=function Sprite(codename,canvasX,canvasY,clipWidth,clipHeight){Anibody.ABO.call(this);this.Codename=codename;this.SpriteImage={complete:false};this.ClipCanvas=null;this.ClipContext=null;this.X=canvasX;this.Y=canvasY;this.Width=clipWidth;this.Height=clipHeight;this.Locked=false;this.Clippings=[];this._clippingsCounter=[];this.ActiveClippingIndex=-1;this.Flags={};this._useDefault=false;this.DefaultClipping=null;this._defaultCounter=null;this.ClippingTemplate=null;this.FlagConstraints=
[];this.Initialize()};Anibody.visual.Sprite.prototype=Object.create(Anibody.ABO.prototype);Anibody.visual.Sprite.prototype.constructor=Anibody.visual.Sprite;Anibody.visual.Sprite.prototype.DefaultClippingTemplate={NumberOfClips:1,FPS:10,Origin:{x:0,y:0},PlayMode:"loop",FlagNames:["default"]};
Anibody.visual.Sprite.prototype.Initialize=function(){if(this.Codename instanceof HTMLImageElement)this.SpriteImage=this.Codename;if(this.Engine.MediaManager&&this.Engine.MediaManager.GetPicture&&typeof this.Codename==="string")this.SpriteImage=this.Engine.MediaManager.GetPicture(this.Codename);if(!this.SpriteImage)throw"Could not access the Image for the Sprite";this.ResetTemplate();this.ClipCanvas=document.createElement("CANVAS");this.ClipCanvas.width=this.Width;this.ClipCanvas.height=this.Height;
this.ClipContext=this.ClipCanvas.getContext("2d")};Anibody.visual.Sprite.prototype.GetTemplate=function(){return this.ClippingTemplate};Anibody.visual.Sprite.prototype.SetTemplateAttribute=function(attr,val){this.ClippingTemplate[attr]=val};Anibody.visual.Sprite.prototype.SetDefaultClipping=function(dclip){this.AddClipping(dclip,true)};
Anibody.visual.Sprite.prototype.AddClipping=function(obj,def){if(typeof def==="undefined")def=false;var temp={NumberOfClips:this.ClippingTemplate.NumberOfClips,FPS:this.ClippingTemplate.FPS,Origin:{x:this.ClippingTemplate.Origin.x,y:this.ClippingTemplate.Origin.y},PlayMode:this.ClippingTemplate.PlayMode,FlagNames:this.ClippingTemplate.FlagNames};if(typeof obj==="object"){if(obj.NumberOfClips)temp.NumberOfClips=obj.NumberOfClips;if(obj.FPS)temp.FPS=obj.FPS;if(obj.Origin&&!isNaN(obj.Origin.x))temp.Origin.x=
obj.Origin.x;if(obj.Origin&&!isNaN(obj.Origin.y))temp.Origin.y=obj.Origin.y;if(obj.PlayMode)temp.PlayMode=obj.PlayMode;if(obj.FlagNames)temp.FlagNames=obj.FlagNames}temp._internal=0;if(!def){this.Clippings.push(temp);for(var i=0;i<temp.FlagNames.length;i++)this.Flags[temp.FlagNames[i]]=false}else this.DefaultClipping=temp;var cbo=function(i){this._internal=i}.getCallbackObject(temp);var endcbo,tempc;if(temp.NumberOfClips>1){tempc=new Anibody.util.Counter([0,temp.NumberOfClips-1],1E3/temp.FPS,cbo,
endcbo);if(temp.PlayMode==="loop"){tempc.SetLoop(true);tempc.Start()}}else tempc={};if(!def)this._clippingsCounter.push(tempc);else this._defaultCounter=tempc};Anibody.visual.Sprite.prototype.AddClippings=function(){for(var i=0;i<arguments.length;i++)this.AddClipping(arguments[i])};
Anibody.visual.Sprite.prototype._findActiveClipping=function(){var names=[];var n;for(n in this.Flags)if(typeof this.Flags[n]==="boolean"&&this.Flags[n]===true)names.push(n);var i=-1;this._useDefault=true;for(i=0;this._useDefault&&names.length&&i<this.Clippings.length;i++)if(names.length===this.Clippings[i].FlagNames.length&&this._checkClipping(names,i)){this.ActiveClippingIndex=i;this._useDefault=false}};
Anibody.visual.Sprite.prototype._checkClipping=function(names,i){var correct=true;for(var n=0;n<names.length;n++)if(correct&&!this.Clippings[i].FlagNames.isElement(names[n]))correct=false;return correct};
Anibody.visual.Sprite.prototype.Draw=function(c){if(!this.SpriteImage||!this.SpriteImage.complete)return;var cp=false;if(this._useDefault&&this.DefaultClipping!==null)cp=this.DefaultClipping;else if(this.ActiveClippingIndex>=0&&this.ActiveClippingIndex<this.Clippings.length)cp=this.Clippings[this.ActiveClippingIndex];if(!cp)return;var x=cp.Origin.x+this.Width*cp._internal;this.ClipContext.clearRect(0,0,this.Width,this.Height);c.drawImage(this.SpriteImage,x,cp.Origin.y,this.Width,this.Height,this.X,
this.Y,this.Width,this.Height)};Anibody.visual.Sprite.prototype.Update=function(){if(!this.Locked)this._findActiveClipping()};Anibody.visual.Sprite.prototype.SetFlag=function(flagname,state){this.Flags[flagname]=state;this._checkConstraints(flagname)};Anibody.visual.Sprite.prototype.SetFlags=function(names,states){for(var i=0;i<names.length;i++)if(typeof names[i]==="string")this.SetFlag(names[i],states[i])};
Anibody.visual.Sprite.prototype._checkConstraints=function(target){var c;for(var i=0;i<this.FlagConstraints.length;i++)if(this.FlagConstraints[i].subject===target)this._applyConstraint(this.FlagConstraints[i])};
Anibody.visual.Sprite.prototype._applyConstraint=function(c){if(c.type==="radio"){var tarval;if(this.Flags[c.subject])for(var i=0;i<c.objects.length;i++)this.Flags[c.objects[i]]=false}if(c.type==="opposite"){var tarval=this.Flags[c.subject];for(var i=0;i<c.objects.length;i++)this.Flags[c.objects[i]]=!tarval}};
Anibody.visual.Sprite.prototype.AddRadioConstraint=function(){var c;for(var i=0;i<arguments.length;i++){var group=[];for(var j=0;j<arguments.length;j++)if(arguments[i]!==arguments[j])group.push(arguments[j]);c={type:"radio",subject:arguments[i],objects:group};this.FlagConstraints.push(c)}};
Anibody.visual.Sprite.prototype.AddOppositeConstraint=function(){var c;for(var i=0;i<arguments.length;i++){var group=[];for(var j=0;j<arguments.length;j++)if(arguments[i]!==arguments[j])group.push(arguments[j]);c={type:"opposite",subject:arguments[i],objects:group};this.FlagConstraints.push(c)}};
Anibody.visual.Sprite.prototype.ResetTemplate=function(){this.ClippingTemplate={NumberOfClips:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.NumberOfClips,FPS:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.FPS,Origin:{x:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.Origin.x,y:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.Origin.y},PlayMode:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.PlayMode,FlagNames:Anibody.visual.Sprite.prototype.DefaultClippingTemplate.FlagNames}};
Anibody.visual.Sprite.prototype.SetLocked=function(state){this.Locked=state};Anibody.visual.Sprite.prototype.Lock=function(){this.Locked=true};Anibody.visual.Sprite.prototype.Unlock=function(){this.Locked=false};